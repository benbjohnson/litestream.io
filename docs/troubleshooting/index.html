<!doctype html>
<html lang="en-US">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <link rel="stylesheet" href="/main.211f27ab66d952d637fa741b575d7cfdf53f25b5ea7d6f38193f667a756f6b85f1e0e59a36a863834fb2e4ef66f1928cff1358b23bb8a5956101d4994514962f.css" integrity="sha512-IR8nq2bZUtY3&#43;nQbV118/fU/JbXqfW84GT9menVva4Xx4OWaNqhjg0&#43;y5O9m8ZKM/xNYsju4pZVhAdSZRRSWLw==" crossorigin="anonymous">
<noscript><style>img.lazyload { display: none; }</style></noscript>

<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;1,400;1,600&display=swap" rel="stylesheet">

  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <title>Troubleshooting - Litestream</title>
<meta name="description" content="Common issues and solutions when using Litestream">
<link rel="canonical" href="https://litestream.io/docs/troubleshooting/">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://litestream.io/images/twitter-image.png">
<meta name="twitter:title" content="Troubleshooting">
<meta name="twitter:description" content="Common issues and solutions when using Litestream">
<meta name="twitter:site" content="@litestreamio">
<meta name="twitter:creator" content="@benbjohnson">

<meta name="twitter:site" content="@litestreamio">
<meta name="twitter:creator" content="@benbjohnson">

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position":  1 ,
        "name": "Home",
        "item": "https:\/\/litestream.io\/"
    },{
        "@type": "ListItem",
        "position":  2 ,
        "name": "Docs",
        "item": "https:\/\/litestream.io\/docs\/"
    },{
        "@type": "ListItem",
        "position":  3 ,
        "name": "Troubleshooting",
        "item": "https:\/\/litestream.io\/docs\/troubleshooting\/"
    }]
}
</script>

  <meta name="theme-color" content="#fff">
<link rel="apple-touch-icon" sizes="180x180" href="https://litestream.io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://litestream.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://litestream.io/favicon-16x16.png">
<link rel="manifest" href="https://litestream.io/site.webmanifest">
  
</head>
  <body class="docs single">
    <header class="navbar fixed-top navbar-expand-md navbar-light">
  <div class="container align-items-baseline">
    <input class="menu-btn order-0" type="checkbox" id="menu-btn">

    <label class="menu-icon d-md-none" for="menu-btn"><span class="navicon"></span></label>

    <a class="navbar-brand order-1 order-md-0 mr-auto" href="https://litestream.io/">
      <img class="d-md-inline d-none" src="/images/logo.svg" />
      <span class="d-sm-inline d-md-none">Litestream</span>
    </a>

    <ul class="navbar-nav social-nav order-3 order-md-5">
      <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/litestreamio"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg><span class="ml-2 sr-only">Twitter</span></a>
        </li>
      <li class="nav-item">
          <a class="nav-link" href="https://github.com/benbjohnson/litestream"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="ml-2 sr-only">GitHub</span></a>
        </li>
      </ul>

    <div class="collapse navbar-collapse order-4 order-md-1">
      <ul class="navbar-nav main-nav mr-auto order-5 order-md-2"><li class="nav-item">
            <a class="nav-link" href="https://litestream.io/install">Install</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://litestream.io/guides">Guides</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://litestream.io/reference">Reference</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://github.com/benbjohnson/litestream">GitHub</a>
          </li>
        </ul>
      <div class="break order-6 d-md-none"></div>
    </div>
  </div>
</header>
    <div class="version-banner alert alert-warning text-center mb-0" role="alert" style="border-radius: 0;">
  <div class="container">
    <strong>v0.5.x</strong> - Latest - Actively maintained with new features and bug fixes| <a href="/v0.3/" class="alert-link">View v0.3.13 (Previous)</a></div>
</div>
    <div class="wrap container" role="document">
      <div class="content">
        
	<div class="row flex-xl-nowrap">
		<div class="col-lg-5 col-xl-4 docs-sidebar">
			<nav class="docs-links" aria-label="Main navigation">
				<h3>
    <a href="https://litestream.io/install">Install</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/install/mac/">macOS</a></li>
    <li><a class="docs-link" href="https://litestream.io/install/linux/">Linux</a></li>
    <li><a class="docs-link" href="https://litestream.io/install/source/">Build from Source</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/">General</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/getting-started/">Getting Started</a></li>
    <li><a class="docs-link" href="https://litestream.io/tips/">Tips &amp; Caveats</a></li>
    <li><a class="docs-link" href="https://litestream.io/how-it-works/">How it works</a></li>
    <li><a class="docs-link" href="https://litestream.io/how-it-works/vfs/">Read Replicas with VFS</a></li>
    <li><a class="docs-link" href="https://litestream.io/alternatives/">Alternatives</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/guides/">Infrastructure Guides</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/guides/docker/">Running in a Docker container</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/kubernetes/">Running in a Kubernetes cluster</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/systemd/">Running as a Systemd service</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/windows/">Running as a Windows Service</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/directory-watcher/">Directory Watcher</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/guides/">Replica Guides</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/guides/global-defaults/">Global Replica Defaults</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/s3/">Replicating to Amazon S3</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/aws-sdk-v2/">AWS SDK v2 Migration</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/alibaba-oss/">Replicating to Alibaba Cloud OSS</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/s3-advanced/">S3 Advanced Configuration</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/vfs/">VFS Read Replicas</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/go-library/">Using Litestream as a Go Library</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/vfs-write-mode/">VFS Write Mode</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/vfs-hydration/">VFS Hydration</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/azure/">Replicating to Azure Blob Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/s3-compatible/">Replicating to S3-Compatible Services</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/backblaze/">Replicating to Backblaze B2</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/digitalocean/">Replicating to DigitalOcean Spaces</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/scaleway/">Replicating to Scaleway Object Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/tigris/">Replicating to Tigris (Fly.io)</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/supabase/">Replicating to Supabase Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/gcs/">Replicating to Google Cloud Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/linode/">Replicating to Linode Object Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/sftp/">Replicating to an SFTP Server</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/file/">Replicating to a Local File Path</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/nats/">Replicating to NATS JetStream</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/directory/">Replicating Directories</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/webdav/">Replicating to a WebDAV Server</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/docs/">Help</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/docs/migration/">Migration Guide</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/wal-truncate-threshold/">WAL Truncate Threshold Configuration</a></li>
    <li><a class="docs-link active" href="https://litestream.io/docs/troubleshooting/">Troubleshooting</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/reference/">Reference</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/reference/config/">Configuration File</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/vfs/">VFS Extension</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/metrics/">Prometheus Metrics</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/databases/">Command: databases</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/mcp/">Command: mcp</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/replicate/">Command: replicate</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/ltx/">Command: ltx</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/restore/">Command: restore</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/sync/">Command: sync</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/reset/">Command: reset</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/ipc/">IPC Endpoints</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/version/">Command: version</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/wal/">Command: wal</a></li>
    </ul>
  
			</nav>        
		</div>
		<nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation">
			<div class="page-links">
    <h3>On this page</h3>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#configuration-issues">Configuration Issues</a>
      <ul>
        <li><a href="#invalid-configuration-file">Invalid Configuration File</a></li>
      </ul>
    </li>
    <li><a href="#managing-credentials-securely">Managing Credentials Securely</a>
      <ul>
        <li><a href="#best-practices">Best Practices</a></li>
        <li><a href="#environment-variable-expansion">Environment Variable Expansion</a></li>
        <li><a href="#kubernetes-secrets">Kubernetes Secrets</a></li>
        <li><a href="#docker-secrets">Docker Secrets</a></li>
        <li><a href="#azure-with-managed-identity">Azure with Managed Identity</a></li>
        <li><a href="#credential-security-checklist">Credential Security Checklist</a></li>
        <li><a href="#database-path-issues">Database Path Issues</a></li>
        <li><a href="#mcp-server-wont-start">MCP Server Won&rsquo;t Start</a></li>
      </ul>
    </li>
    <li><a href="#replication-issues">Replication Issues</a>
      <ul>
        <li><a href="#s3-connection-failures">S3 Connection Failures</a></li>
        <li><a href="#s3-signature-errors">S3 Signature Errors</a></li>
        <li><a href="#azure-blob-storage-permission-errors">Azure Blob Storage Permission Errors</a></li>
        <li><a href="#nats-connection-issues">NATS Connection Issues</a></li>
        <li><a href="#s3-compatible-upload-errors">S3-Compatible Upload Errors</a></li>
        <li><a href="#slow-replication">Slow Replication</a></li>
        <li><a href="#file-retention-and-cleanup-issues">File Retention and Cleanup Issues</a></li>
      </ul>
    </li>
    <li><a href="#database-issues">Database Issues</a>
      <ul>
        <li><a href="#wal-mode-problems">WAL Mode Problems</a></li>
        <li><a href="#database-locks">Database Locks</a></li>
        <li><a href="#wal-growth-and-checkpoint-blocking">WAL Growth and Checkpoint Blocking</a></li>
        <li><a href="#corruption-detection">Corruption Detection</a></li>
      </ul>
    </li>
    <li><a href="#performance-issues">Performance Issues</a>
      <ul>
        <li><a href="#high-cpu-usage">High CPU Usage</a></li>
        <li><a href="#memory-issues">Memory Issues</a></li>
      </ul>
    </li>
    <li><a href="#network-and-connectivity">Network and Connectivity</a>
      <ul>
        <li><a href="#intermittent-network-failures">Intermittent Network Failures</a></li>
        <li><a href="#dns-resolution-issues">DNS Resolution Issues</a></li>
      </ul>
    </li>
    <li><a href="#logging-and-debugging">Logging and Debugging</a>
      <ul>
        <li><a href="#enabling-debug-logging">Enabling Debug Logging</a></li>
        <li><a href="#reading-logs">Reading Logs</a></li>
        <li><a href="#important-log-messages">Important Log Messages</a></li>
      </ul>
    </li>
    <li><a href="#ltx-replication-errors">LTX Replication Errors</a>
      <ul>
        <li><a href="#common-error-messages">Common Error Messages</a></li>
        <li><a href="#recovery-options">Recovery Options</a></li>
        <li><a href="#preventing-ltx-errors">Preventing LTX Errors</a></li>
      </ul>
    </li>
    <li><a href="#recovery-and-restore">Recovery and Restore</a>
      <ul>
        <li><a href="#point-in-time-recovery">Point-in-Time Recovery</a></li>
        <li><a href="#backup-validation">Backup Validation</a></li>
      </ul>
    </li>
    <li><a href="#operations-that-invalidate-tracking-state">Operations That Invalidate Tracking State</a>
      <ul>
        <li><a href="#operations-to-avoid">Operations to avoid</a></li>
        <li><a href="#in-place-vacuum">In-place VACUUM</a></li>
        <li><a href="#symptoms-of-corrupted-tracking-state">Symptoms of corrupted tracking state</a></li>
      </ul>
    </li>
    <li><a href="#recovering-from-corrupted-tracking-state">Recovering from Corrupted Tracking State</a>
      <ul>
        <li><a href="#recovery-procedure">Recovery procedure</a></li>
        <li><a href="#verifying-recovery">Verifying recovery</a></li>
        <li><a href="#preventing-future-issues">Preventing future issues</a></li>
      </ul>
    </li>
    <li><a href="#getting-help">Getting Help</a>
      <ul>
        <li><a href="#before-asking-for-help">Before Asking for Help</a></li>
        <li><a href="#where-to-get-help">Where to Get Help</a></li>
        <li><a href="#reporting-issues">Reporting Issues</a></li>
      </ul>
    </li>
    <li><a href="#sqlite-driver-issues-v050">SQLite Driver Issues (v0.5.0+)</a>
      <ul>
        <li><a href="#pragma-configuration-errors">PRAGMA Configuration Errors</a></li>
        <li><a href="#busy-timeout-not-working">Busy Timeout Not Working</a></li>
        <li><a href="#build-errors-with-cgo">Build Errors with CGO</a></li>
        <li><a href="#performance-differences">Performance Differences</a></li>
      </ul>
    </li>
    <li><a href="#common-error-reference">Common Error Reference</a></li>
    <li><a href="#next-steps">Next Steps</a></li>
  </ul>
</nav>
  </div>

		</nav>
		<main class="docs-content col-lg-11 col-xl-9">
		<h1>Troubleshooting</h1>
			<p class="lead">Find solutions to common problems when using Litestream for SQLite replication.</p>
			<h2 id="configuration-issues">Configuration Issues<a href="#configuration-issues" class="anchor" aria-hidden="true">#</a> </h2>
<h3 id="invalid-configuration-file">Invalid Configuration File<a href="#invalid-configuration-file" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Error</strong>: <code>yaml: unmarshal errors</code> or <code>cannot parse config</code></p>
<p><strong>Solution</strong>: Validate your YAML syntax:</p>
<ul>
<li>Check indentation (use spaces, not tabs)</li>
<li>Ensure proper nesting of configuration sections</li>
<li>Validate string values are properly quoted when containing special characters</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># ❌ Invalid - mixed tabs and spaces</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/db.sqlite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://bucket/path</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ✅ Valid - consistent spacing</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/db.sqlite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://bucket/path</span><span class="w">
</span></span></span></code></pre></div><h2 id="managing-credentials-securely">Managing Credentials Securely<a href="#managing-credentials-securely" class="anchor" aria-hidden="true">#</a> </h2>
<p>Properly securing credentials is critical for Litestream deployments. This section
covers best practices for credential management across different deployment scenarios.</p>
<h3 id="best-practices">Best Practices<a href="#best-practices" class="anchor" aria-hidden="true">#</a> </h3>
<ol>
<li><strong>Never commit credentials to version control</strong> — Use <code>.gitignore</code> to exclude
configuration files containing sensitive data</li>
<li><strong>Prefer environment variables</strong> — Litestream supports environment variable
expansion in configuration files</li>
<li><strong>Use secret management systems</strong> — For production, use Kubernetes Secrets,
Docker Secrets, or HashiCorp Vault</li>
<li><strong>Minimize credential exposure</strong> — Provide only the permissions needed for your
use case (principle of least privilege)</li>
<li><strong>Rotate credentials regularly</strong> — Update access keys and secrets periodically</li>
<li><strong>Audit access</strong> — Monitor credential usage through cloud provider logs</li>
</ol>
<h3 id="environment-variable-expansion">Environment Variable Expansion<a href="#environment-variable-expansion" class="anchor" aria-hidden="true">#</a> </h3>
<p>Litestream automatically expands <code>$VAR</code> and <code>${VAR}</code> references in configuration files.
This is the simplest way to pass credentials without embedding them in files:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/mydb.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://mybucket/db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">access-key-id</span><span class="p">:</span><span class="w"> </span><span class="l">${AWS_ACCESS_KEY_ID}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">secret-access-key</span><span class="p">:</span><span class="w"> </span><span class="l">${AWS_SECRET_ACCESS_KEY}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Set environment variables before running Litestream</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>AKIAIOSFODNN7EXAMPLE
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
</span></span><span class="line"><span class="cl">litestream replicate
</span></span></code></pre></div><p>To disable environment variable expansion if it conflicts with your values:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">litestream replicate -no-expand-env
</span></span></code></pre></div><h3 id="kubernetes-secrets">Kubernetes Secrets<a href="#kubernetes-secrets" class="anchor" aria-hidden="true">#</a> </h3>
<p>For Kubernetes deployments, mount credentials as environment variables from Secrets:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">litestream-aws-credentials</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Opaque</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">stringData</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">access-key-id</span><span class="p">:</span><span class="w"> </span><span class="l">AKIAIOSFODNN7EXAMPLE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">secret-access-key</span><span class="p">:</span><span class="w"> </span><span class="l">wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">myapp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">myapp:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">AWS_ACCESS_KEY_ID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">secretKeyRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">litestream-aws-credentials</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">access-key-id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">AWS_SECRET_ACCESS_KEY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">secretKeyRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">litestream-aws-credentials</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">secret-access-key</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">litestream-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/litestream</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">readOnly</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">litestream-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">litestream-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">litestream-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">litestream.yml</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    dbs:
</span></span></span><span class="line"><span class="cl"><span class="sd">      - path: /data/myapp.db
</span></span></span><span class="line"><span class="cl"><span class="sd">        replica:
</span></span></span><span class="line"><span class="cl"><span class="sd">          url: s3://mybucket/myapp
</span></span></span><span class="line"><span class="cl"><span class="sd">          access-key-id: ${AWS_ACCESS_KEY_ID}
</span></span></span><span class="line"><span class="cl"><span class="sd">          secret-access-key: ${AWS_SECRET_ACCESS_KEY}</span><span class="w">    
</span></span></span></code></pre></div><p>For GCS with workload identity (recommended for Kubernetes on GKE):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ServiceAccount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">litestream-sa</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">iam.gke.io/gcp-service-account</span><span class="p">:</span><span class="w"> </span><span class="l">litestream@your-project.iam.gserviceaccount.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">myapp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l">litestream-sa</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">myapp:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">GOOGLE_APPLICATION_CREDENTIALS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">/var/run/secrets/cloud.google.com/service_account/key.json</span><span class="w">
</span></span></span></code></pre></div><h3 id="docker-secrets">Docker Secrets<a href="#docker-secrets" class="anchor" aria-hidden="true">#</a> </h3>
<p>For Docker Swarm deployments, use Docker Secrets:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3.8&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">myapp</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">myapp:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">AWS_ACCESS_KEY_ID_FILE</span><span class="p">:</span><span class="w"> </span><span class="l">/run/secrets/aws_access_key_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">AWS_SECRET_ACCESS_KEY_FILE</span><span class="p">:</span><span class="w"> </span><span class="l">/run/secrets/aws_secret_access_key</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">secrets</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">aws_access_key_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">aws_secret_access_key</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">configs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l">litestream_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/litestream.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">configs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">litestream_config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l">./litestream.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">secrets</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">aws_access_key_id</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">aws_secret_access_key</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div><p>Then read these in your startup script:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nb">export</span> <span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="k">$(</span>cat /run/secrets/aws_access_key_id<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="k">$(</span>cat /run/secrets/aws_secret_access_key<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">exec</span> litestream replicate
</span></span></code></pre></div><h3 id="azure-with-managed-identity">Azure with Managed Identity<a href="#azure-with-managed-identity" class="anchor" aria-hidden="true">#</a> </h3>
<p>For Azure deployments, use managed identity instead of shared keys:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># Pod with Azure managed identity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">aad.banzaicloud.com/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">AzureIdentity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">litestream-identity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">  </span><span class="c"># Managed Service Identity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">resourceID</span><span class="p">:</span><span class="w"> </span><span class="l">/subscriptions/{subscription}/resourcegroups/{resourcegroup}/providers/Microsoft.ManagedIdentity/userAssignedIdentities/litestream</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">clientID</span><span class="p">:</span><span class="w"> </span>{<span class="l">client-id}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">myapp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">aadpodidbinding</span><span class="p">:</span><span class="w"> </span><span class="l">litestream-identity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">myapp:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">litestream-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/litestream</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">readOnly</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">litestream-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">litestream-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">litestream-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">litestream.yml</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    dbs:
</span></span></span><span class="line"><span class="cl"><span class="sd">      - path: /data/myapp.db
</span></span></span><span class="line"><span class="cl"><span class="sd">        replica:
</span></span></span><span class="line"><span class="cl"><span class="sd">          url: abs://account@myaccount.blob.core.windows.net/container/db
</span></span></span><span class="line"><span class="cl"><span class="sd">          # Managed identity authentication (no keys needed)</span><span class="w">    
</span></span></span></code></pre></div><h3 id="credential-security-checklist">Credential Security Checklist<a href="#credential-security-checklist" class="anchor" aria-hidden="true">#</a> </h3>
<ul>
<li>✅ Credentials stored in environment variables or secret management systems</li>
<li>✅ Configuration files never committed to version control with credentials</li>
<li>✅ Credentials have minimal required permissions</li>
<li>✅ Access is logged and auditable</li>
<li>✅ Credentials rotated on a regular schedule</li>
<li>✅ Development and production credentials are separate</li>
<li>✅ Database backup location is restricted to authorized users</li>
<li>✅ Network access to cloud storage is restricted to necessary services</li>
</ul>
<h3 id="database-path-issues">Database Path Issues<a href="#database-path-issues" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Error</strong>: <code>no such file or directory</code> or <code>database is locked</code></p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Ensure the database path exists and is accessible</li>
<li>Check file permissions (Litestream needs read/write access)</li>
<li>Verify the database isn&rsquo;t being used by another process without proper <code>busy_timeout</code></li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Set busy timeout in your application
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">PRAGMA</span><span class="w"> </span><span class="n">busy_timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5000</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="mcp-server-wont-start">MCP Server Won&rsquo;t Start<a href="#mcp-server-wont-start" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Error</strong>: <code>bind: address already in use</code></p>
<p><strong>Solution</strong>: Check if another process is using the MCP port:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Check what&#39;s using port 3001</span>
</span></span><span class="line"><span class="cl">lsof -i :3001
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Use a different port in configuration</span>
</span></span><span class="line"><span class="cl">mcp-addr: <span class="s2">&#34;:3002&#34;</span>
</span></span></code></pre></div><h2 id="replication-issues">Replication Issues<a href="#replication-issues" class="anchor" aria-hidden="true">#</a> </h2>
<h3 id="s3-connection-failures">S3 Connection Failures<a href="#s3-connection-failures" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Error</strong>: <code>NoCredentialsProviders</code> or <code>access denied</code></p>
<p><strong>Solution</strong>:</p>
<ol>
<li>
<p>Verify AWS credentials are properly configured:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Check AWS credentials</span>
</span></span><span class="line"><span class="cl">aws configure list
</span></span></code></pre></div></li>
<li>
<p>Ensure IAM permissions include required S3 actions:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;Version&#34;</span><span class="p">:</span> <span class="s2">&#34;2012-10-17&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;Statement&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;Effect&#34;</span><span class="p">:</span> <span class="s2">&#34;Allow&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;Action&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;s3:GetObject&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;s3:PutObject&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;s3:DeleteObject&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;s3:ListBucket&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;Resource&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;arn:aws:s3:::your-bucket&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;arn:aws:s3:::your-bucket/*&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
</ol>
<h3 id="s3-signature-errors">S3 Signature Errors<a href="#s3-signature-errors" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Error</strong>: <code>SignatureDoesNotMatch</code> or similar signature mismatch errors</p>
<p><strong>Solution</strong>:</p>
<p>This error typically occurs with Litestream versions prior to v0.5.5 when using
AWS S3 or certain S3-compatible providers.</p>
<ol>
<li>
<p><strong>Upgrade to v0.5.5 or later</strong> — The default <code>sign-payload</code> setting changed
from <code>false</code> to <code>true</code>, which resolves most signature issues.</p>
</li>
<li>
<p>If you cannot upgrade, explicitly enable payload signing:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/db.sqlite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://bucket/path</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">sign-payload</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p>Or via URL query parameter:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://bucket/path?sign-payload=true</span><span class="w">
</span></span></span></code></pre></div></li>
</ol>
<h3 id="azure-blob-storage-permission-errors">Azure Blob Storage Permission Errors<a href="#azure-blob-storage-permission-errors" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Error</strong>: <code>AuthorizationPermissionMismatch</code> or <code>no matching backup files available</code></p>
<p>When using Microsoft Entra ID authentication (Managed Identity, Service Principal, or
Azure CLI), you must have the correct <strong>Storage Blob Data</strong> role assigned. Standard
Azure roles like Owner or Contributor manage the storage account but do <strong>not</strong> grant
access to blob data.</p>
<table>
<thead>
<tr>
<th>Error Message</th>
<th>Likely Cause</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AuthorizationPermissionMismatch</code></td>
<td>Missing Storage Blob Data role</td>
</tr>
<tr>
<td><code>AuthorizationFailure</code></td>
<td>Authentication issue or wrong account</td>
</tr>
<tr>
<td><code>no matching backup files available</code></td>
<td>Often a permissions issue (prior to v0.5.7, the actual error was hidden)</td>
</tr>
</tbody>
</table>
<p><strong>Solution</strong>:</p>
<ol>
<li>
<p>Verify you have the correct role assigned:</p>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Minimum Required Role</th>
</tr>
</thead>
<tbody>
<tr>
<td>Backup (write)</td>
<td>Storage Blob Data Contributor</td>
</tr>
<tr>
<td>Restore (read-only)</td>
<td>Storage Blob Data Reader</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Assign the role via Azure CLI:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">az role assignment create <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --role <span class="s2">&#34;Storage Blob Data Contributor&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --assignee &lt;your-email-or-object-id&gt; <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --scope <span class="s2">&#34;/subscriptions/&lt;subscription-id&gt;/resourceGroups/&lt;resource-group&gt;/providers/Microsoft.Storage/storageAccounts/&lt;storage-account&gt;&#34;</span>
</span></span></code></pre></div></li>
<li>
<p>Wait up to 10 minutes for role assignments to take effect.</p>
</li>
<li>
<p>Verify your authentication is working:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># For Azure CLI auth</span>
</span></span><span class="line"><span class="cl">az login
</span></span><span class="line"><span class="cl">az storage blob list --account-name &lt;storage-account&gt; --container-name &lt;container&gt; --auth-mode login
</span></span></code></pre></div></li>
</ol>
<p>See the <a href="/guides/azure/#required-azure-roles">Azure Blob Storage guide</a> for detailed
role assignment instructions.</p>
<h3 id="nats-connection-issues">NATS Connection Issues<a href="#nats-connection-issues" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Error</strong>: <code>connection refused</code> or <code>authentication failed</code></p>
<p><strong>Solution</strong>:</p>
<ol>
<li>
<p>Verify NATS server is running and accessible:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Test NATS connectivity</span>
</span></span><span class="line"><span class="cl">nats server check --server nats://localhost:4222
</span></span></code></pre></div></li>
<li>
<p>Check authentication credentials:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/db.sqlite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">nats</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">nats://localhost:4222/bucket</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># Use appropriate auth method</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">pass</span><span class="w">
</span></span></span></code></pre></div></li>
</ol>
<h3 id="s3-compatible-upload-errors">S3-Compatible Upload Errors<a href="#s3-compatible-upload-errors" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Error</strong>: <code>InvalidContentEncoding</code>, <code>MalformedTrailerError</code>, or similar errors
when uploading to S3-compatible providers</p>
<p><strong>Solution</strong>:</p>
<p>This error occurs with Litestream versions prior to v0.5.4 when using S3-compatible
providers (Tigris, Backblaze B2, MinIO, DigitalOcean Spaces, etc.). AWS SDK Go v2
v1.73.0+ introduced aws-chunked encoding that many providers don&rsquo;t support.</p>
<ol>
<li>
<p><strong>Upgrade to v0.5.4 or later</strong> — Litestream automatically disables aws-chunked
encoding for all S3-compatible providers.</p>
</li>
<li>
<p>See the <a href="/guides/s3-compatible/#upload-encoding-errors">S3-Compatible Guide</a>
for more details.</p>
</li>
</ol>
<h3 id="slow-replication">Slow Replication<a href="#slow-replication" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Symptoms</strong>: High lag between database changes and replica updates</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>
<p>Check sync intervals in configuration:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/db.sqlite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># Reduce intervals for faster sync</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">monitor-interval</span><span class="p">:</span><span class="w"> </span><span class="l">1s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">checkpoint-interval</span><span class="p">:</span><span class="w"> </span><span class="l">1m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">sync-interval</span><span class="p">:</span><span class="w"> </span><span class="l">1s</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p>Monitor system resources (CPU, memory, network)</p>
</li>
<li>
<p>Consider using local file replica for testing performance</p>
</li>
</ol>
<h3 id="file-retention-and-cleanup-issues">File Retention and Cleanup Issues<a href="#file-retention-and-cleanup-issues" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Symptoms</strong>: LTX files accumulating in your S3 or R2 bucket despite having
retention configured, or files not being deleted as expected.</p>
<p>This section explains how Litestream&rsquo;s retention timing works and covers known
issues with certain S3-compatible providers.</p>
<h4 id="understanding-retention-timing">Understanding Retention Timing<a href="#understanding-retention-timing" class="anchor" aria-hidden="true">#</a> </h4>
<p>Litestream uses a tiered file structure for replicas. Understanding when each
file type is eligible for deletion helps diagnose retention issues:</p>
<table>
<thead>
<tr>
<th>File Type</th>
<th>Retention Trigger</th>
<th>Dependencies</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>L0 (WAL segments)</strong></td>
<td>After <code>l0-retention</code> (default 5m)</td>
<td>Must be compacted into L1 first</td>
</tr>
<tr>
<td><strong>L1/L2/L3 (compacted)</strong></td>
<td>When <code>EnforceSnapshotRetention()</code> runs</td>
<td>Snapshot age &gt; <code>retention</code></td>
</tr>
<tr>
<td><strong>L9 (snapshots)</strong></td>
<td>When snapshot age &gt; <code>retention</code></td>
<td>None</td>
</tr>
</tbody>
</table>
<p>The effective cleanup delay is approximately: <code>snapshot.interval</code> + <code>snapshot.retention</code></p>
<p><strong>Example timing with default configuration:</strong></p>
<ul>
<li>Configuration: <code>interval=30m</code> + <code>retention=1h</code></li>
<li>First snapshot created at T+30m (age: 0)</li>
<li>Second snapshot created at T+1h (first snapshot age: 30m)</li>
<li>First snapshot becomes eligible for deletion at T+1h30m (age exceeds 1h)</li>
<li><strong>Result</strong>: Minimum 1.5 hours before L1+ cleanup begins</li>
</ul>
<p>This means files will accumulate during this period. This is expected behavior,
not a bug. Note that retention enforcement only runs when Litestream creates a
new snapshot, not continuously in the background.</p>
<h4 id="verifying-retention-is-working">Verifying Retention Is Working<a href="#verifying-retention-is-working" class="anchor" aria-hidden="true">#</a> </h4>
<p>Use Litestream&rsquo;s Prometheus metrics to monitor retention status:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-promql" data-lang="promql"><span class="line"><span class="cl"><span class="c1"># L0 file retention status (v0.5.x)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nv">litestream_l0_retention_files_total</span><span class="p">{</span><span class="nl">status</span><span class="o">=</span><span class="p">&#34;</span><span class="s">eligible</span><span class="p">&#34;}</span><span class="w">      </span><span class="c1"># Ready for deletion</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nv">litestream_l0_retention_files_total</span><span class="p">{</span><span class="nl">status</span><span class="o">=</span><span class="p">&#34;</span><span class="s">not_compacted</span><span class="p">&#34;}</span><span class="w"> </span><span class="c1"># Awaiting L1 compaction</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nv">litestream_l0_retention_files_total</span><span class="p">{</span><span class="nl">status</span><span class="o">=</span><span class="p">&#34;</span><span class="s">too_recent</span><span class="p">&#34;}</span><span class="w">    </span><span class="c1"># Within retention window</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1"># S3/R2 operation tracking</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">rate</span><span class="o">(</span><span class="nv">litestream_replica_operation_total</span><span class="p">{</span><span class="nl">operation</span><span class="o">=</span><span class="p">&#34;</span><span class="s">DELETE</span><span class="p">&#34;}[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nv">litestream_replica_operation_errors_total</span><span class="p">{</span><span class="nl">operation</span><span class="o">=</span><span class="p">&#34;</span><span class="s">DELETE</span><span class="p">&#34;}</span><span class="w">
</span></span></span></code></pre></div><p>If <code>DELETE</code> operations show errors or the <code>eligible</code> count keeps growing while
actual deletions don&rsquo;t occur, the issue may be with your storage provider.</p>
<h4 id="cloudflare-r2-silent-deletion-failures">Cloudflare R2 Silent Deletion Failures<a href="#cloudflare-r2-silent-deletion-failures" class="anchor" aria-hidden="true">#</a> </h4>
<p>Cloudflare R2 has a known issue where <code>DeleteObjects</code> API calls may return
HTTP 200 with objects listed as &ldquo;Deleted&rdquo;, but the files are not actually
removed from storage. This is documented in <a href="https://community.cloudflare.com/t/r2-delete-objects-command-does-not-delete-objects/537479">Cloudflare Community forums</a>.</p>
<p><strong>Symptoms:</strong></p>
<ul>
<li>Litestream logs show successful deletions</li>
<li>Prometheus metrics show DELETE operations succeeding</li>
<li>Files remain in R2 bucket when checked manually</li>
</ul>
<p><strong>Verification:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># After Litestream reports deletion, check if files still exist</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Using rclone (configure R2 remote first):</span>
</span></span><span class="line"><span class="cl">rclone ls r2:your-bucket/path/to/replica <span class="p">|</span> grep <span class="s2">&#34;filename-that-should-be-deleted&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Or using AWS CLI with R2 endpoint:</span>
</span></span><span class="line"><span class="cl">aws s3 ls s3://your-bucket/path/to/replica <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --endpoint-url https://ACCOUNT_ID.r2.cloudflarestorage.com <span class="p">|</span> grep <span class="s2">&#34;filename&#34;</span>
</span></span></code></pre></div><p>If files that should have been deleted are still present, R2&rsquo;s silent deletion
bug is likely occurring.</p>
<h5 id="workaround-r2-object-lifecycle-rules">Workaround: R2 Object Lifecycle Rules<a href="#workaround-r2-object-lifecycle-rules" class="anchor" aria-hidden="true">#</a> </h5>
<p>Configure <a href="https://developers.cloudflare.com/r2/buckets/object-lifecycles/">R2 Object Lifecycle rules</a>
as a fallback cleanup mechanism:</p>
<ol>
<li>Go to <strong>Cloudflare Dashboard</strong> → <strong>R2</strong> → <strong>Your Bucket</strong> → <strong>Settings</strong></li>
<li>Click <strong>Object Lifecycle Rules</strong> → <strong>Add rule</strong></li>
<li>Configure:
<ul>
<li><strong>Rule name</strong>: <code>litestream-cleanup</code></li>
<li><strong>Prefix filter</strong>: Your Litestream replica path (e.g., <code>backups/mydb/</code>)</li>
<li><strong>Action</strong>: Delete objects</li>
<li><strong>Days after object creation</strong>: Set based on your retention needs (e.g., 7 days)</li>
</ul>
</li>
</ol>
<p>Example using AWS SDK:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ID</span><span class="o">:</span> <span class="s2">&#34;litestream-cleanup&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Status</span><span class="o">:</span> <span class="s2">&#34;Enabled&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Filter</span><span class="o">:</span> <span class="p">{</span> <span class="nx">Prefix</span><span class="o">:</span> <span class="s2">&#34;backups/mydb/&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Expiration</span><span class="o">:</span> <span class="p">{</span> <span class="nx">Days</span><span class="o">:</span> <span class="mi">7</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><strong>Important considerations:</strong></p>
<ul>
<li>Objects are typically removed within 24 hours of expiration</li>
<li>This is a fallback, not a replacement for Litestream&rsquo;s retention</li>
<li>Set lifecycle days higher than your Litestream retention to avoid premature deletion</li>
</ul>
<h4 id="r2-bucket-versioning">R2 Bucket Versioning<a href="#r2-bucket-versioning" class="anchor" aria-hidden="true">#</a> </h4>
<p>If R2 bucket versioning is enabled, deleted objects become &ldquo;delete markers&rdquo;
rather than being permanently removed. Check your bucket settings:</p>
<ol>
<li><strong>Cloudflare Dashboard</strong> → <strong>R2</strong> → <strong>Your Bucket</strong> → <strong>Settings</strong></li>
<li>Look for <strong>Bucket versioning</strong> setting</li>
<li>If enabled, previous versions of objects are retained</li>
</ol>
<p>To clean up versioned objects, you may need to delete specific versions or
configure lifecycle rules that handle versioned objects.</p>
<h4 id="adjusting-retention-configuration">Adjusting Retention Configuration<a href="#adjusting-retention-configuration" class="anchor" aria-hidden="true">#</a> </h4>
<p>If files are accumulating faster than expected, consider adjusting your
retention settings. Snapshot and retention settings are configured globally,
not per-replica:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># Global snapshot settings (not per-replica)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">snapshot</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">1h     </span><span class="w"> </span><span class="c"># How often to create snapshots</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">24h   </span><span class="w"> </span><span class="c"># How long to keep snapshots</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/db.sqlite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://bucket/path</span><span class="w">
</span></span></span></code></pre></div><p>Shorter <code>snapshot.interval</code> values create more frequent snapshots, which allows
older data to be cleaned up sooner. See the
<a href="/reference/config/#retention-period">Configuration Reference</a> for details on
how retention works.</p>
<h2 id="database-issues">Database Issues<a href="#database-issues" class="anchor" aria-hidden="true">#</a> </h2>
<h3 id="wal-mode-problems">WAL Mode Problems<a href="#wal-mode-problems" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Error</strong>: <code>database is not in WAL mode</code></p>
<p><strong>Solution</strong>: Litestream requires WAL mode. Enable it in your application:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Enable WAL mode
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">PRAGMA</span><span class="w"> </span><span class="n">journal_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WAL</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Or let Litestream enable it automatically by ensuring proper database permissions.</p>
<h3 id="database-locks">Database Locks<a href="#database-locks" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Error</strong>: <code>database is locked</code> or <code>SQLITE_BUSY</code></p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Set busy timeout in your application (see above)</li>
<li>Ensure no long-running transactions are blocking checkpoints</li>
<li>Check for applications holding exclusive locks</li>
</ol>
<h3 id="wal-growth-and-checkpoint-blocking">WAL Growth and Checkpoint Blocking<a href="#wal-growth-and-checkpoint-blocking" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Symptoms</strong>: WAL file growing excessively large or writes timing out</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>
<p>Check if you have long-lived read transactions preventing checkpoints</p>
</li>
<li>
<p>Review checkpoint configuration in your config file</p>
</li>
<li>
<p>Consider disabling <code>truncate-page-n</code> if you have long-running queries:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/db.sqlite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">truncate-page-n</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">  </span><span class="c"># Disable blocking checkpoints</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p>Monitor WAL file size and disk space</p>
</li>
</ol>
<p>For detailed guidance on checkpoint configuration and trade-offs, see the <a href="/guides/wal-truncate-threshold">WAL
Truncate Threshold Configuration guide</a>.</p>
<h3 id="corruption-detection">Corruption Detection<a href="#corruption-detection" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Error</strong>: <code>database disk image is malformed</code></p>
<p><strong>Solution</strong>:</p>
<ol>
<li>
<p>Stop Litestream replication</p>
</li>
<li>
<p>Run SQLite integrity check:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sqlite3 /path/to/db.sqlite <span class="s2">&#34;PRAGMA integrity_check;&#34;</span>
</span></span></code></pre></div></li>
<li>
<p>If corrupted, restore from latest backup:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">litestream restore -o /path/to/recovered.db /path/to/db.sqlite
</span></span></code></pre></div></li>
</ol>
<h2 id="performance-issues">Performance Issues<a href="#performance-issues" class="anchor" aria-hidden="true">#</a> </h2>
<h3 id="high-cpu-usage">High CPU Usage<a href="#high-cpu-usage" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Symptoms</strong>: Litestream consuming excessive CPU (100%+ sustained)</p>
<p><strong>Common Causes</strong>:</p>
<ol>
<li><strong>Unbounded WAL growth</strong> — Long-running read transactions blocking checkpoints</li>
<li><strong>State corruption</strong> — Tracking files mismatched with replica state</li>
<li><strong>Blocked checkpoints</strong> — Application holding read locks</li>
</ol>
<p><strong>Diagnosis</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Check CPU usage over time</span>
</span></span><span class="line"><span class="cl">pidstat -p <span class="k">$(</span>pgrep litestream<span class="k">)</span> <span class="m">1</span> <span class="m">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Check WAL file size (large WAL indicates checkpoint blocking)</span>
</span></span><span class="line"><span class="cl">ls -lh /path/to/db.sqlite-wal
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Check for blocking processes</span>
</span></span><span class="line"><span class="cl">sqlite3 /path/to/db.sqlite <span class="s2">&#34;PRAGMA wal_checkpoint(PASSIVE);&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Result: status|log|checkpointed</span>
</span></span><span class="line"><span class="cl"><span class="c1"># status=1 means checkpoint was blocked</span>
</span></span></code></pre></div><p><strong>Solutions</strong>:</p>
<ol>
<li>
<p><strong>Reduce monitoring frequency</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/db.sqlite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">monitor-interval</span><span class="p">:</span><span class="w"> </span><span class="l">10s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># ... (other replica settings)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">sync-interval</span><span class="p">:</span><span class="w"> </span><span class="l">5m</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p><strong>Fix blocked checkpoints</strong> — Kill long-running read connections in your application</p>
</li>
<li>
<p><strong>Reset corrupted state</strong> — See <a href="#recovering-from-corrupted-tracking-state">Recovering from corrupted tracking state</a></p>
</li>
</ol>
<h3 id="memory-issues">Memory Issues<a href="#memory-issues" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Symptoms</strong>: High memory usage or out-of-memory errors</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>
<p>Monitor snapshot sizes and retention policies</p>
</li>
<li>
<p>Adjust retention settings:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">snapshot</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">24h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">72h </span><span class="w"> </span><span class="c"># Keep fewer snapshots</span><span class="w">
</span></span></span></code></pre></div></li>
</ol>
<h2 id="network-and-connectivity">Network and Connectivity<a href="#network-and-connectivity" class="anchor" aria-hidden="true">#</a> </h2>
<h3 id="intermittent-network-failures">Intermittent Network Failures<a href="#intermittent-network-failures" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Error</strong>: <code>connection reset by peer</code> or <code>timeout</code></p>
<p><strong>Solution</strong>:</p>
<ol>
<li>
<p>Adjust sync interval to reduce frequency of requests during outages:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/db.sqlite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://bucket/path</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">sync-interval</span><span class="p">:</span><span class="w"> </span><span class="l">10s</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p>Check network stability and firewall rules</p>
</li>
<li>
<p>Consider using regional endpoints for cloud storage</p>
</li>
<li>
<p>For production, use a configuration file to persist your settings (see <a href="https://litestream.io/reference/config/">Configuration Reference</a>)</p>
</li>
</ol>
<h3 id="dns-resolution-issues">DNS Resolution Issues<a href="#dns-resolution-issues" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Error</strong>: <code>no such host</code> or DNS timeouts</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>
<p>Test DNS resolution:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">nslookup s3.amazonaws.com
</span></span></code></pre></div></li>
<li>
<p>Use IP addresses instead of hostnames if needed</p>
</li>
<li>
<p>Check <code>/etc/resolv.conf</code> configuration</p>
</li>
</ol>
<h2 id="logging-and-debugging">Logging and Debugging<a href="#logging-and-debugging" class="anchor" aria-hidden="true">#</a> </h2>
<h3 id="enabling-debug-logging">Enabling Debug Logging<a href="#enabling-debug-logging" class="anchor" aria-hidden="true">#</a> </h3>
<p>Add debug logging to your configuration:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">logging</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l">debug</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">text</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">stderr</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div><h3 id="reading-logs">Reading Logs<a href="#reading-logs" class="anchor" aria-hidden="true">#</a> </h3>
<p>Common log locations:</p>
<ul>
<li><strong>Linux systemd</strong>: <code>journalctl -u litestream</code></li>
<li><strong>Docker</strong>: <code>docker logs container_name</code></li>
<li><strong>Windows Service</strong>: Event Viewer → Application → Litestream</li>
<li><strong>Command Line</strong>: stdout/stderr</li>
</ul>
<h3 id="important-log-messages">Important Log Messages<a href="#important-log-messages" class="anchor" aria-hidden="true">#</a> </h3>
<p>Look for these key messages:</p>
<ul>
<li><code>initialized db</code>: Database successfully loaded</li>
<li><code>replicating to</code>: Replica configuration loaded</li>
<li><code>sync error</code>: Replication issues</li>
<li><code>checkpoint completed</code>: Successful WAL checkpoint</li>
</ul>
<h2 id="ltx-replication-errors">LTX Replication Errors<a href="#ltx-replication-errors" class="anchor" aria-hidden="true">#</a> </h2>
<p><span class="badge badge-info litestream-version" title="This feature has been available since Litestream v0.5.7">
    v0.5.7
</span>
 LTX (Litestream Transaction Log) errors occur when
local tracking state becomes inconsistent with the replica. These errors are
commonly reported after unclean shutdowns, OOM kills, or manual state
manipulation.</p>
<h3 id="common-error-messages">Common Error Messages<a href="#common-error-messages" class="anchor" aria-hidden="true">#</a> </h3>
<h4 id="cannot-close-expected-page">&ldquo;cannot close, expected page&rdquo;<a href="#cannot-close-expected-page" class="anchor" aria-hidden="true">#</a> </h4>
<pre tabindex="0"><code>level=ERROR msg=&#34;sync error&#34; error=&#34;cannot close, expected page N but found M&#34;
</code></pre><p>This occurs when Litestream detects a mismatch between expected and actual page
numbers during sync. The local tracking state references pages that don&rsquo;t match
the current database state.</p>
<h4 id="nonsequential-page-numbers-in-snapshot-transaction">&ldquo;nonsequential page numbers in snapshot transaction&rdquo;<a href="#nonsequential-page-numbers-in-snapshot-transaction" class="anchor" aria-hidden="true">#</a> </h4>
<pre tabindex="0"><code>level=ERROR msg=&#34;sync error&#34; error=&#34;nonsequential page numbers in snapshot transaction&#34;
</code></pre><p>This indicates the snapshot transaction contains pages that are out of order,
typically caused by an incomplete or corrupted snapshot write.</p>
<h4 id="non-contiguous-transaction-files">&ldquo;non-contiguous transaction files&rdquo;<a href="#non-contiguous-transaction-files" class="anchor" aria-hidden="true">#</a> </h4>
<pre tabindex="0"><code>level=ERROR msg=&#34;sync error&#34; error=&#34;non-contiguous transaction files&#34;
</code></pre><p>LTX files must form a contiguous sequence. A gap in the sequence means one or
more transaction files are missing, usually from an unclean shutdown or
partial write.</p>
<h4 id="sync-retry-backoff-loops">Sync retry backoff loops<a href="#sync-retry-backoff-loops" class="anchor" aria-hidden="true">#</a> </h4>
<pre tabindex="0"><code>level=WARN msg=&#34;retrying sync&#34; attempt=1 error=&#34;...&#34; backoff=1s
level=WARN msg=&#34;retrying sync&#34; attempt=2 error=&#34;...&#34; backoff=2s
level=WARN msg=&#34;retrying sync&#34; attempt=3 error=&#34;...&#34; backoff=4s
</code></pre><p>Repeated retry messages with increasing backoff indicate Litestream is stuck
trying to sync with a persistent LTX error.</p>
<h3 id="recovery-options">Recovery Options<a href="#recovery-options" class="anchor" aria-hidden="true">#</a> </h3>
<p>There are two ways to recover from LTX errors:</p>
<h4 id="option-1-manual-reset">Option 1: Manual Reset<a href="#option-1-manual-reset" class="anchor" aria-hidden="true">#</a> </h4>
<p>Use the <a href="https://litestream.io/reference/reset/"><code>litestream reset</code></a> command to clear
local state and force a fresh snapshot:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Stop Litestream</span>
</span></span><span class="line"><span class="cl">sudo systemctl stop litestream
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Reset local state for the affected database</span>
</span></span><span class="line"><span class="cl">litestream reset /var/lib/db
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Restart Litestream</span>
</span></span><span class="line"><span class="cl">sudo systemctl start litestream
</span></span></code></pre></div><p>After restart, Litestream will create a fresh snapshot. See the
<a href="https://litestream.io/reference/reset/"><code>reset</code> command reference</a> for details.</p>
<h4 id="option-2-automatic-recovery">Option 2: Automatic Recovery<a href="#option-2-automatic-recovery" class="anchor" aria-hidden="true">#</a> </h4>
<p>Enable the <a href="https://litestream.io/reference/config/#auto-recover"><code>auto-recover</code></a> option
on your replica to have Litestream automatically reset when LTX errors occur:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://mybucket/db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">auto-recover</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div><p>This is recommended for unattended deployments where manual intervention is
impractical. See the <a href="https://litestream.io/reference/config/#auto-recover">configuration reference</a>
for guidance on when to enable this option.</p>
<h3 id="preventing-ltx-errors">Preventing LTX Errors<a href="#preventing-ltx-errors" class="anchor" aria-hidden="true">#</a> </h3>
<ul>
<li>
<p><strong>Use proper shutdown procedures</strong> — Always stop Litestream gracefully with
<code>SIGTERM</code> before shutting down the system</p>
</li>
<li>
<p><strong>Set busy timeout</strong> — Prevents checkpoint blocking that can lead to state
corruption:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">PRAGMA</span><span class="w"> </span><span class="n">busy_timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5000</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p><strong>Avoid in-place VACUUM</strong> — Use <code>VACUUM INTO</code> instead (see
<a href="#operations-that-invalidate-tracking-state">Operations That Invalidate Tracking State</a>)</p>
</li>
<li>
<p><strong>Monitor replication</strong> — Use Prometheus metrics to detect sync errors early</p>
</li>
</ul>
<h2 id="recovery-and-restore">Recovery and Restore<a href="#recovery-and-restore" class="anchor" aria-hidden="true">#</a> </h2>
<h3 id="point-in-time-recovery">Point-in-Time Recovery<a href="#point-in-time-recovery" class="anchor" aria-hidden="true">#</a> </h3>
<p>List available restore points:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">litestream ltx /path/to/db.sqlite
</span></span></code></pre></div><p>Restore to specific time:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">litestream restore -timestamp 2025-01-01T12:00:00Z -o restored.db /path/to/db.sqlite
</span></span></code></pre></div><h3 id="backup-validation">Backup Validation<a href="#backup-validation" class="anchor" aria-hidden="true">#</a> </h3>
<p>Verify backup integrity:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Restore to temporary location</span>
</span></span><span class="line"><span class="cl">litestream restore -o /tmp/test.db /path/to/db.sqlite
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Run integrity check</span>
</span></span><span class="line"><span class="cl">sqlite3 /tmp/test.db <span class="s2">&#34;PRAGMA integrity_check;&#34;</span>
</span></span></code></pre></div><h2 id="operations-that-invalidate-tracking-state">Operations That Invalidate Tracking State<a href="#operations-that-invalidate-tracking-state" class="anchor" aria-hidden="true">#</a> </h2>
<p>Litestream maintains internal tracking state in <code>.{filename}-litestream</code> directories
(e.g., <code>.db.sqlite-litestream</code> for a database file named <code>db.sqlite</code>) to efficiently
replicate changes. Certain operations can corrupt or invalidate
this tracking, leading to high CPU usage, replication errors, or state mismatch
between local tracking and remote replicas.</p>
<h3 id="operations-to-avoid">Operations to avoid<a href="#operations-to-avoid" class="anchor" aria-hidden="true">#</a> </h3>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Why It&rsquo;s Problematic</th>
<th>Safe Alternative</th>
</tr>
</thead>
<tbody>
<tr>
<td>In-place <code>VACUUM</code></td>
<td>Rewrites entire database, invalidating page tracking</td>
<td>Use <code>VACUUM INTO 'new.db'</code></td>
</tr>
<tr>
<td>Manual checkpoint while Litestream is stopped</td>
<td>Large WAL changes database state without tracking</td>
<td>Let Litestream manage checkpoints</td>
</tr>
<tr>
<td>Deleting <code>.sqlite-litestream</code> directory</td>
<td>Creates local/remote state mismatch</td>
<td>Delete both local tracking AND remote replica</td>
</tr>
<tr>
<td>Restoring database while Litestream is running</td>
<td>Overwrites database without updating tracking</td>
<td>Stop Litestream before restore</td>
</tr>
</tbody>
</table>
<h3 id="in-place-vacuum">In-place VACUUM<a href="#in-place-vacuum" class="anchor" aria-hidden="true">#</a> </h3>
<p>The SQLite <code>VACUUM</code> command rewrites the entire database file. Litestream tracks
changes at the page level, so a full rewrite invalidates all tracking state.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Dangerous: Invalidates Litestream tracking
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">VACUUM</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Safe: Creates new file, preserves original
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">VACUUM</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="s1">&#39;/path/to/compacted.db&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>If you must use in-place <code>VACUUM</code>:</p>
<ol>
<li>Stop Litestream</li>
<li>Run <code>VACUUM</code></li>
<li>Delete the <code>.sqlite-litestream</code> tracking directory</li>
<li>Delete the remote replica data (start fresh)</li>
<li>Restart Litestream</li>
</ol>
<h3 id="symptoms-of-corrupted-tracking-state">Symptoms of corrupted tracking state<a href="#symptoms-of-corrupted-tracking-state" class="anchor" aria-hidden="true">#</a> </h3>
<ul>
<li>
<p><strong>High CPU usage</strong> (100%+) even when database is idle</p>
</li>
<li>
<p><strong>Repeated log messages</strong> with identical transaction IDs</p>
</li>
<li>
<p><strong>&ldquo;timeout waiting for db initialization&rdquo;</strong> warnings</p>
</li>
<li>
<p><strong>Missing LTX file errors</strong>:</p>
<pre tabindex="0"><code>level=ERROR msg=&#34;monitor error&#34; error=&#34;open .../ltx/0/0000000000000001.ltx: no such file or directory&#34;
</code></pre></li>
<li>
<p><strong>Local/remote state mismatch</strong>:</p>
<pre tabindex="0"><code>level=INFO msg=&#34;detected database behind replica&#34; db_txid=0000000000000000 replica_txid=0000000000000001
</code></pre></li>
</ul>
<h2 id="recovering-from-corrupted-tracking-state">Recovering from Corrupted Tracking State<a href="#recovering-from-corrupted-tracking-state" class="anchor" aria-hidden="true">#</a> </h2>
<p>When Litestream&rsquo;s tracking state becomes corrupted, a complete state reset is
required. This procedure removes all local tracking and remote replica data,
forcing a fresh snapshot.</p>
<div class="alert alert-warning d-flex" role="alert">
  <div class="flex-shrink-1 alert-icon">⚠️</div>
  <div class="w-100">**Warning**: This procedure deletes your replica history. You will lose the ability to do point-in-time recovery to timestamps before the reset. Only proceed if you have confirmed tracking corruption.</div>
</div>
<h3 id="recovery-procedure">Recovery procedure<a href="#recovery-procedure" class="anchor" aria-hidden="true">#</a> </h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 1. Stop Litestream</span>
</span></span><span class="line"><span class="cl">sudo systemctl stop litestream
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 2. Kill any processes holding database connections</span>
</span></span><span class="line"><span class="cl"><span class="c1"># (application-specific - check for zombie processes)</span>
</span></span><span class="line"><span class="cl">lsof /path/to/db.sqlite
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 3. Checkpoint the database to clear WAL</span>
</span></span><span class="line"><span class="cl">sqlite3 /path/to/db.sqlite <span class="s2">&#34;PRAGMA wal_checkpoint(TRUNCATE);&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Verify: result should be &#34;0|0|0&#34; (success)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 4. Remove local Litestream tracking</span>
</span></span><span class="line"><span class="cl">rm -rf /path/to/.db.sqlite-litestream
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 5. Remove remote replica data (start fresh)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># For S3:</span>
</span></span><span class="line"><span class="cl">aws s3 rm s3://bucket/path/db.sqlite --recursive
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># For GCS:</span>
</span></span><span class="line"><span class="cl">gsutil rm -r gs://bucket/path/db.sqlite
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># For Azure:</span>
</span></span><span class="line"><span class="cl">az storage blob delete-batch --source container --pattern <span class="s2">&#34;path/db.sqlite/*&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 6. Restart Litestream</span>
</span></span><span class="line"><span class="cl">sudo systemctl start litestream
</span></span></code></pre></div><h3 id="verifying-recovery">Verifying recovery<a href="#verifying-recovery" class="anchor" aria-hidden="true">#</a> </h3>
<p>After restarting, verify Litestream has recovered:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Check CPU usage is normal (should be near 0% when idle)</span>
</span></span><span class="line"><span class="cl">pidstat -p <span class="k">$(</span>pgrep litestream<span class="k">)</span> <span class="m">1</span> <span class="m">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Check logs for successful snapshot</span>
</span></span><span class="line"><span class="cl">journalctl -u litestream -f
</span></span><span class="line"><span class="cl"><span class="c1"># Should see: &#34;snapshot written&#34; or similar</span>
</span></span></code></pre></div><h3 id="preventing-future-issues">Preventing future issues<a href="#preventing-future-issues" class="anchor" aria-hidden="true">#</a> </h3>
<ol>
<li>
<p><strong>Avoid in-place VACUUM</strong> — Use <code>VACUUM INTO</code> instead</p>
</li>
<li>
<p><strong>Set busy timeout</strong> — Prevent checkpoint blocking:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">PRAGMA</span><span class="w"> </span><span class="n">busy_timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5000</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p><strong>Monitor WAL size</strong> — Alert if WAL exceeds 50% of database size</p>
</li>
<li>
<p><strong>Kill zombie connections</strong> — Ensure application processes don&rsquo;t hold long-lived read locks</p>
</li>
</ol>
<h2 id="getting-help">Getting Help<a href="#getting-help" class="anchor" aria-hidden="true">#</a> </h2>
<h3 id="before-asking-for-help">Before Asking for Help<a href="#before-asking-for-help" class="anchor" aria-hidden="true">#</a> </h3>
<ol>
<li><strong>Check the logs</strong> for error messages (use debug level)</li>
<li><strong>Test with minimal config</strong> to isolate the issue</li>
<li><strong>Verify versions</strong>: Ensure you&rsquo;re using compatible Litestream version</li>
<li><strong>Search existing issues</strong> on GitHub</li>
</ol>
<h3 id="where-to-get-help">Where to Get Help<a href="#where-to-get-help" class="anchor" aria-hidden="true">#</a> </h3>
<ul>
<li><strong>GitHub Issues</strong>: <a href="https://github.com/benbjohnson/litestream/issues">github.com/benbjohnson/litestream/issues</a></li>
<li><strong>Documentation</strong>: Review <a href="https://litestream.io/reference/config/">Configuration Reference</a></li>
</ul>
<h3 id="reporting-issues">Reporting Issues<a href="#reporting-issues" class="anchor" aria-hidden="true">#</a> </h3>
<p>When reporting issues on GitHub, the bug report template will ask for:</p>
<ul>
<li><strong>Bug Description</strong>: Clear description of the issue</li>
<li><strong>Environment</strong>: Litestream version, operating system, installation method, storage backend</li>
<li><strong>Steps to Reproduce</strong>: Numbered steps, expected vs actual behavior</li>
<li><strong>Configuration</strong>: Your <code>litestream.yml</code> file (remove sensitive data)</li>
<li><strong>Logs</strong>: Relevant log output with debug level enabled</li>
<li><strong>Additional Context</strong>: Recent changes, related issues, workarounds attempted</li>
</ul>
<h2 id="sqlite-driver-issues-v050">SQLite Driver Issues (v0.5.0+)<a href="#sqlite-driver-issues-v050" class="anchor" aria-hidden="true">#</a> </h2>
<p><span class="badge badge-info litestream-version" title="This feature has been available since Litestream v0.5.0">
    v0.5.0
</span>
 Litestream migrated from <code>mattn/go-sqlite3</code> to <code>modernc.org/sqlite</code>. This section covers issues specific to this change.</p>
<h3 id="pragma-configuration-errors">PRAGMA Configuration Errors<a href="#pragma-configuration-errors" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Error</strong>: PRAGMAs not taking effect or <code>unknown pragma</code> errors</p>
<p><strong>Solution</strong>: v0.5.0+ uses different PRAGMA syntax in connection strings:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl"># OLD (v0.3.x - mattn/go-sqlite3):
</span></span><span class="line"><span class="cl">file:/path/to/db?_busy_timeout=5000
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># NEW (v0.5.0+ - modernc.org/sqlite):
</span></span><span class="line"><span class="cl">file:/path/to/db?_pragma=busy_timeout(5000)
</span></span></code></pre></div><p>See the <a href="https://litestream.io/docs/migration/#sqlite-driver-migration">SQLite Driver Migration</a> guide for complete syntax.</p>
<h3 id="busy-timeout-not-working">Busy Timeout Not Working<a href="#busy-timeout-not-working" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Error</strong>: <code>SQLITE_BUSY</code> errors despite setting busy timeout</p>
<p><strong>Solution</strong>: Verify you&rsquo;re using the correct syntax for v0.5.0+:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl"># Correct v0.5.0+ syntax
</span></span><span class="line"><span class="cl">?_pragma=busy_timeout(5000)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Incorrect (v0.3.x syntax - won&#39;t work in v0.5.0+)
</span></span><span class="line"><span class="cl">?_busy_timeout=5000
</span></span></code></pre></div><h3 id="build-errors-with-cgo">Build Errors with CGO<a href="#build-errors-with-cgo" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Error</strong>: CGO-related build errors when building Litestream</p>
<p><strong>Solution</strong>: v0.5.0+ does not require cgo for the main binary:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Explicitly disable cgo if you&#39;re seeing cgo errors</span>
</span></span><span class="line"><span class="cl"><span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> go build ./cmd/litestream
</span></span></code></pre></div><h3 id="performance-differences">Performance Differences<a href="#performance-differences" class="anchor" aria-hidden="true">#</a> </h3>
<p><strong>Symptoms</strong>: Different performance characteristics after upgrading</p>
<p><strong>Solution</strong>: While <code>modernc.org/sqlite</code> is highly optimized:</p>
<ol>
<li>Benchmark your specific workload if performance is critical</li>
<li>The pure Go driver performs comparably for most use cases</li>
<li>For VFS/experimental features, the cgo driver is still available</li>
</ol>
<h2 id="common-error-reference">Common Error Reference<a href="#common-error-reference" class="anchor" aria-hidden="true">#</a> </h2>
<table>
<thead>
<tr>
<th>Error Message</th>
<th>Common Cause</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>database is locked</code></td>
<td>No busy timeout set</td>
<td>Add <code>PRAGMA busy_timeout = 5000;</code></td>
</tr>
<tr>
<td><code>no such file or directory</code></td>
<td>Incorrect database path</td>
<td>Verify path exists and permissions</td>
</tr>
<tr>
<td><code>NoCredentialsProviders</code></td>
<td>Missing AWS credentials</td>
<td>Configure AWS credentials</td>
</tr>
<tr>
<td><code>SignatureDoesNotMatch</code></td>
<td>Unsigned payload (pre-v0.5.5)</td>
<td>Upgrade to v0.5.5+ or set <code>sign-payload: true</code></td>
</tr>
<tr>
<td><code>InvalidContentEncoding</code></td>
<td>aws-chunked encoding (pre-v0.5.4)</td>
<td>Upgrade to v0.5.4+ for S3-compatible providers</td>
</tr>
<tr>
<td><code>MalformedTrailerError</code></td>
<td>aws-chunked encoding (pre-v0.5.4)</td>
<td>Upgrade to v0.5.4+ for S3-compatible providers</td>
</tr>
<tr>
<td><code>AuthorizationPermissionMismatch</code> (Azure)</td>
<td>Missing Storage Blob Data role</td>
<td>Assign Storage Blob Data Contributor/Reader role</td>
</tr>
<tr>
<td><code>no matching backup files available</code> (Azure)</td>
<td>Permission issue (pre-v0.5.7)</td>
<td>Check Azure RBAC roles; upgrade to v0.5.7+ for better errors</td>
</tr>
<tr>
<td><code>connection refused</code></td>
<td>Service not running</td>
<td>Check if target service is accessible</td>
</tr>
<tr>
<td><code>yaml: unmarshal errors</code></td>
<td>Invalid YAML syntax</td>
<td>Validate configuration file syntax</td>
</tr>
<tr>
<td><code>bind: address already in use</code></td>
<td>Port conflict</td>
<td>Change MCP port or stop conflicting service</td>
</tr>
<tr>
<td>PRAGMA not taking effect</td>
<td>Wrong syntax for v0.5.0+</td>
<td>Use <code>_pragma=name(value)</code> syntax</td>
</tr>
<tr>
<td>LTX files accumulating (R2)</td>
<td>R2 silent deletion bug</td>
<td>Use R2 Object Lifecycle rules as fallback</td>
</tr>
<tr>
<td>Files not deleted despite retention</td>
<td>Retention timing or provider bug</td>
<td>Check retention timing math; verify deletions</td>
</tr>
<tr>
<td><code>cannot close, expected page</code></td>
<td>Corrupted local tracking state</td>
<td>Run <code>litestream reset</code> or enable <code>auto-recover</code></td>
</tr>
<tr>
<td><code>nonsequential page numbers in snapshot transaction</code></td>
<td>Incomplete snapshot write</td>
<td>Run <code>litestream reset</code> or enable <code>auto-recover</code></td>
</tr>
<tr>
<td><code>non-contiguous transaction files</code></td>
<td>Missing LTX files after unclean shutdown</td>
<td>Run <code>litestream reset</code> or enable <code>auto-recover</code></td>
</tr>
</tbody>
</table>
<h2 id="next-steps">Next Steps<a href="#next-steps" class="anchor" aria-hidden="true">#</a> </h2>
<ul>
<li><a href="https://litestream.io/reference/config/">Configuration Reference</a></li>
<li><a href="https://litestream.io/install/">Installation Guide</a></li>
<li><a href="https://litestream.io/getting-started/">Getting Started</a></li>
<li><a href="https://litestream.io/tips/">Tips &amp; Caveats</a></li>
</ul>

			<div class="docs-navigation d-flex justify-content-between">
	
	<a href="https://litestream.io/docs/migration/">
			<div class="card my-1">
				<div class="card-body py-2">
					&larr; Migration Guide
				</div>
			</div>
		</a>
	</div>

		</main>
	</div>

      </div>
    </div>
    
    
    <footer>
</footer>
    
    <script src="https://litestream.io/main.f4006b8dd3163d19fa41adf9892089fe185101b404b96884ed2a22ec4e9cb0706759ecdb3f4520a1d37fc5ad7a90a8d90abfb30055a1ff67aefb5b2324355d12.js" integrity="sha512-9ABrjdMWPRn6Qa35iSCJ/hhRAbQEuWiE7Soi7E6csHBnWezbP0UgodN/xa16kKjZCr&#43;zAFWh/2eu&#43;1sjJDVdEg==" crossorigin="anonymous" defer></script>
  <script src="https://litestream.io/index.min.d8f5e476bb38aa6e5d46c69b2d80d720c53aa36a5ac58c007ecdba8f37901667ae80f363425b578c037743ae3f5eae089ae324630132afe826096e36bc9acce1.js" integrity="sha512-2PXkdrs4qm5dRsabLYDXIMU6o2paxYwAfs26jzeQFmeugPNjQltXjAN3Q64/Xq4ImuMkYwEyr&#43;gmCW42vJrM4Q==" crossorigin="anonymous" defer></script>

  </body>
</html>