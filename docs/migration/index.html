<!doctype html>
<html lang="en-US">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <link rel="stylesheet" href="/main.3d00da4403468933e125edaaa0fd3f1c4dacf6d970d5130de45fa62f952af339aa6f9f622f4a35891e84d43de4e54156ed6fad0512598680291fb62f17e96153.css" integrity="sha512-PQDaRANGiTPhJe2qoP0/HE2s9tlw1RMN5F&#43;mL5Uq8zmqb59iL0o1iR6E1D3k5UFW7W&#43;tBRJZhoApH7YvF&#43;lhUw==" crossorigin="anonymous">
<noscript><style>img.lazyload { display: none; }</style></noscript>

<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;1,400;1,600&display=swap" rel="stylesheet">

  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <title>Migration Guide - Litestream</title>
<meta name="description" content="Guide for upgrading Litestream and migrating between configurations">
<link rel="canonical" href="https://litestream.io/docs/migration/">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://litestream.io/images/twitter-image.png">
<meta name="twitter:title" content="Migration Guide">
<meta name="twitter:description" content="Guide for upgrading Litestream and migrating between configurations">
<meta name="twitter:site" content="@litestreamio">
<meta name="twitter:creator" content="@benbjohnson">

<meta name="twitter:site" content="@litestreamio">
<meta name="twitter:creator" content="@benbjohnson">

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position":  1 ,
        "name": "Home",
        "item": "https:\/\/litestream.io\/"
    },{
        "@type": "ListItem",
        "position":  2 ,
        "name": "Docs",
        "item": "https:\/\/litestream.io\/docs\/"
    },{
        "@type": "ListItem",
        "position":  3 ,
        "name": "Migration",
        "item": "https:\/\/litestream.io\/docs\/migration\/"
    }]
}
</script>

  <meta name="theme-color" content="#fff">
<link rel="apple-touch-icon" sizes="180x180" href="https://litestream.io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://litestream.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://litestream.io/favicon-16x16.png">
<link rel="manifest" href="https://litestream.io/site.webmanifest">
  
</head>
  <body class="docs single">
    <header class="navbar fixed-top navbar-expand-md navbar-light">
  <div class="container align-items-baseline">
    <input class="menu-btn order-0" type="checkbox" id="menu-btn">

    <label class="menu-icon d-md-none" for="menu-btn"><span class="navicon"></span></label>

    <a class="navbar-brand order-1 order-md-0 mr-auto" href="https://litestream.io/">
      <img class="d-md-inline d-none" src="/images/logo.svg" />
      <span class="d-sm-inline d-md-none">Litestream</span>
    </a>

    <ul class="navbar-nav social-nav order-3 order-md-5">
      <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/litestreamio"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg><span class="ml-2 sr-only">Twitter</span></a>
        </li>
      <li class="nav-item">
          <a class="nav-link" href="https://github.com/benbjohnson/litestream"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="ml-2 sr-only">GitHub</span></a>
        </li>
      </ul>

    <div class="collapse navbar-collapse order-4 order-md-1">
      <ul class="navbar-nav main-nav mr-auto order-5 order-md-2"><li class="nav-item">
            <a class="nav-link" href="https://litestream.io/install">Install</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://litestream.io/guides">Guides</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://litestream.io/reference">Reference</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://github.com/benbjohnson/litestream">GitHub</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://join.slack.com/t/litestream/shared_invite/zt-3ed89j5s4-KODYR5v93N_0vHE_kDWCyg">Slack</a>
          </li>
        </ul>
      <div class="break order-6 d-md-none"></div>
    </div>
  </div>
</header>
    <div class="version-banner alert alert-warning text-center mb-0" role="alert" style="border-radius: 0;">
  <div class="container">
    <strong>v0.5.x</strong> - Latest - Actively maintained with new features and bug fixes| <a href="/v0.3/" class="alert-link">View v0.3.13 (Previous)</a></div>
</div>
    <div class="wrap container" role="document">
      <div class="content">
        
<div class="row justify-content-center">
  <div class="col-md-12 col-lg-10 col-xl-8">
    <article>
      <h1>Migration Guide</h1>
      <h2 id="overview">Overview</h2>
<p>This guide covers upgrading Litestream versions, migrating configuration formats, and switching between replica types. Follow the appropriate section based on your current setup and target version.</p>
<h2 id="version-upgrades">Version Upgrades</h2>
<h3 id="upgrading-to-v050">Upgrading to v0.5.0+</h3>
<p><span class="badge badge-info litestream-version" title="This feature has been available since Litestream v0.5.0">
    v0.5.0
</span>
 includes MCP support and NATS replication.</p>
<h4 id="pre-upgrade-checklist">Pre-Upgrade Checklist</h4>
<ol>
<li>
<p><strong>Backup your current setup</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Stop Litestream</span>
</span></span><span class="line"><span class="cl">sudo systemctl stop litestream
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Backup configuration</span>
</span></span><span class="line"><span class="cl">cp /etc/litestream.yml /etc/litestream.yml.backup
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Backup binary</span>
</span></span><span class="line"><span class="cl">cp <span class="k">$(</span>which litestream<span class="k">)</span> /usr/local/bin/litestream.backup
</span></span></code></pre></div></li>
<li>
<p><strong>Review configuration changes</strong> (see Configuration Migration below)</p>
</li>
<li>
<p><strong>Test in staging environment</strong> before upgrading production</p>
</li>
</ol>
<h4 id="installation">Installation</h4>
<p>Download and install the new version:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Download latest stable release (check https://github.com/benbjohnson/litestream/releases)</span>
</span></span><span class="line"><span class="cl">wget https://github.com/benbjohnson/litestream/releases/download/v0.3.13/litestream-v0.3.13-linux-amd64.tar.gz
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Extract and install</span>
</span></span><span class="line"><span class="cl">tar -xzf litestream-v0.3.13-linux-amd64.tar.gz
</span></span><span class="line"><span class="cl">sudo mv litestream /usr/local/bin/
</span></span><span class="line"><span class="cl">sudo chmod +x /usr/local/bin/litestream
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Verify installation</span>
</span></span><span class="line"><span class="cl">litestream version
</span></span></code></pre></div><h3 id="upgrading-from-v03x-to-v050">Upgrading from v0.3.x to v0.5.0+</h3>
<h4 id="key-changes">Key Changes</h4>
<ol>
<li>
<p><strong>SQLite Driver Change</strong>:</p>
<ul>
<li>Migration from <code>mattn/go-sqlite3</code> (cgo-based) to <code>modernc.org/sqlite</code> (pure Go)</li>
<li>No cgo requirement for main binary (simpler builds, better cross-compilation)</li>
<li><strong>PRAGMA configuration syntax changed</strong> (see <a href="#sqlite-driver-migration">SQLite Driver Migration</a> below)</li>
</ul>
</li>
<li>
<p><strong>Cloud SDK Upgrades</strong>:</p>
<ul>
<li>AWS SDK v1 ‚Üí v2 with improved credential chain support</li>
<li>Azure SDK v1 ‚Üí v2 with Managed Identity support (see <a href="#azure-sdk-v2-migration">Azure SDK v2 Migration</a> below)</li>
</ul>
</li>
<li>
<p><strong>Command Changes</strong>:</p>
<ul>
<li><code>litestream wal</code> ‚Üí <code>litestream ltx</code> (WAL command renamed to LTX)</li>
<li>New <code>mcp-addr</code> configuration option for Model Context Protocol support</li>
<li>NATS replica support with JetStream</li>
</ul>
</li>
<li>
<p><strong>Configuration Changes</strong>:</p>
<ul>
<li>Single <code>replica</code> field replaces <code>replicas</code> array (backward compatible)</li>
<li>New global configuration sections: <code>levels</code>, <code>snapshot</code>, <code>exec</code></li>
<li>Extended replica configuration options</li>
</ul>
</li>
</ol>
<h4 id="migration-steps">Migration Steps</h4>
<ol>
<li><strong>Update configuration format</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># OLD FORMAT (still supported, but only with a single replica)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replicas</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://my-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">72h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># NEW FORMAT (recommended)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://my-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">72h</span><span class="w">
</span></span></span></code></pre></div><ol>
<li><strong>Override default settings</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># Add MCP support (disabled by default)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">mcp-addr</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;:3001&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Override global snapshot configuration (defaults: interval=24h, retention=24h)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">snapshot</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">24h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">168h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Add level-based retention (no default levels configured)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">levels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">1h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">24h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">24h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">168h</span><span class="w">
</span></span></span></code></pre></div><ol>
<li><strong>Update command usage</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># OLD: Query WAL information</span>
</span></span><span class="line"><span class="cl">litestream wal /path/to/db.sqlite
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># NEW: Query LTX information</span>
</span></span><span class="line"><span class="cl">litestream ltx /path/to/db.sqlite
</span></span></code></pre></div><ol>
<li><strong>Restart services</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Restart Litestream with new configuration</span>
</span></span><span class="line"><span class="cl">sudo systemctl restart litestream
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Verify it&#39;s working</span>
</span></span><span class="line"><span class="cl">sudo systemctl status litestream
</span></span><span class="line"><span class="cl">litestream databases
</span></span></code></pre></div><h3 id="age-encryption-migration">Age Encryption Migration</h3>
<div class="alert alert-warning d-flex" role="alert">
  <div class="flex-shrink-1 alert-icon">‚ö†Ô∏è</div>
  <div class="w-100">**Important**: Age encryption is not available in v0.5.0+. If you are upgrading from v0.3.x with Age encryption configured, your replica will be rejected with an explicit error message.</div>
</div>
<h4 id="who-is-affected">Who is Affected</h4>
<p>If you meet <strong>any</strong> of the following conditions, this section applies to you:</p>
<ul>
<li>Running v0.3.x with Age encryption enabled</li>
<li>Have Age encryption configured in your <code>litestream.yml</code></li>
<li>Have existing Age-encrypted backups in S3, GCS, Azure, or other storage</li>
</ul>
<h4 id="why-age-encryption-was-disabled">Why Age Encryption Was Disabled</h4>
<p>Age encryption was removed from v0.5.0+ as part of the LTX storage layer refactor. The core issue is that <strong>Age encrypts entire files as a single unit</strong>, which doesn&rsquo;t align with Litestream&rsquo;s new architecture.</p>
<p>Litestream&rsquo;s v0.5+ uses the LTX format which allows <strong>per-page encryption</strong> - the ability to fetch and decrypt individual pages from storage (S3, GCS, etc.) without needing the entire file. This is more efficient and provides better integration with cloud storage.</p>
<p>The feature was not maintained and has been disabled to prevent accidental data loss from misconfigured encryption (users believing their data was encrypted when it wasn&rsquo;t being encrypted at all).</p>
<h4 id="upgrade-options">Upgrade Options</h4>
<p>Choose the option that best fits your situation:</p>
<h4 id="option-1-stay-on-v03x">Option 1: Stay on v0.3.x</h4>
<p>If you need Age encryption, remain on v0.3.x until the feature is restored:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Check your current version</span>
</span></span><span class="line"><span class="cl">litestream version
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># If you&#39;ve already upgraded to v0.5, downgrade to latest v0.3</span>
</span></span><span class="line"><span class="cl">wget https://github.com/benbjohnson/litestream/releases/download/v0.3.13/litestream-v0.3.13-linux-amd64.tar.gz
</span></span><span class="line"><span class="cl">tar -xzf litestream-v0.3.13-linux-amd64.tar.gz
</span></span><span class="line"><span class="cl">sudo mv litestream /usr/local/bin/
</span></span><span class="line"><span class="cl">sudo systemctl restart litestream
</span></span></code></pre></div><h4 id="option-2-upgrade-to-v050-remove-age-encryption">Option 2: Upgrade to v0.5.0+ (Remove Age Encryption)</h4>
<p>If you can migrate away from Age encryption:</p>
<ol>
<li>
<p><strong>Validate your current backups are accessible</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">litestream restore -o /tmp/test-restore.db /var/lib/app.db
</span></span></code></pre></div></li>
<li>
<p><strong>Remove Age encryption from configuration</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># REMOVE this entire section from your litestream.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">age</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">identities</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">/etc/litestream/age-identity.txt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">recipients</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">age1xxxxxxxxxxxxx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Your replica should look like:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://my-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># No &#39;age&#39; section</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p><strong>Migrate existing encrypted backups</strong> (optional):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Decrypt and restore from v0.3.x backup</span>
</span></span><span class="line"><span class="cl">litestream restore -o /tmp/decrypted.db /var/lib/app.db
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Stop replication</span>
</span></span><span class="line"><span class="cl">sudo systemctl stop litestream
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Delete old encrypted replica (careful!)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Example for S3:</span>
</span></span><span class="line"><span class="cl">aws s3 rm s3://my-bucket/app --recursive
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Update configuration and restart</span>
</span></span><span class="line"><span class="cl">sudo systemctl start litestream
</span></span></code></pre></div></li>
<li>
<p><strong>Verify new backups are working</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Wait a few minutes for replication to occur</span>
</span></span><span class="line"><span class="cl">litestream databases
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Test restore functionality</span>
</span></span><span class="line"><span class="cl">litestream restore -o /tmp/verify.db /var/lib/app.db
</span></span></code></pre></div></li>
</ol>
<h4 id="option-3-use-unencrypted-backups-temporarily">Option 3: Use Unencrypted Backups Temporarily</h4>
<p>While Age encryption is unavailable, use standard unencrypted replication:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://my-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">72h</span><span class="w">
</span></span></span></code></pre></div><p>For encryption at rest, consider:</p>
<ul>
<li>S3 Server-Side Encryption (SSE-S3, SSE-KMS)</li>
<li>Google Cloud Storage encryption</li>
<li>Azure Blob Storage encryption</li>
<li>Encrypted storage volumes at the provider level</li>
</ul>
<h4 id="frequently-asked-questions">Frequently Asked Questions</h4>
<p><strong>Q: Will my v0.3.x Age-encrypted backups still work with v0.5?</strong></p>
<p>A: No. If you have v0.3.x Age-encrypted backups and try to restore with v0.5, the restore will fail because Age encryption is not available in v0.5. You must either stay on v0.3.x to restore the backups or decrypt them first while still on v0.3.x.</p>
<p><strong>Q: Do I need to re-encrypt existing backups?</strong></p>
<p>A: No, your existing v0.3.x Age-encrypted backups remain encrypted in storage. The issue only affects upgrading to v0.5.0+. If you stay on v0.3.x, your backups continue to work normally.</p>
<p><strong>Q: What if I&rsquo;m already using Age encryption in production?</strong></p>
<p>A: Do not upgrade to v0.5.0+ at this time. Stay on v0.3.x. Monitor the <a href="https://github.com/benbjohnson/litestream/releases">Litestream releases</a> page for updates on Age encryption restoration.</p>
<p><strong>Q: When will encryption be restored?</strong></p>
<p>A: Encryption support will be re-implemented <strong>directly in the LTX format</strong> to support per-page encryption. This is planned work but no timeline has been announced. The implementation is complex and requires careful design to work efficiently with cloud storage providers.</p>
<p>If you need encryption immediately, you can:</p>
<ul>
<li>Stay on v0.3.x with Age encryption</li>
<li>Use provider-level encryption (S3 SSE-KMS, GCS encryption, Azure encryption, etc.)</li>
<li>Use database-level encryption (SQLCipher)</li>
</ul>
<p>See <a href="https://github.com/benbjohnson/litestream/issues/458">issue #458</a> (LTX Support) for the tracking issue on encryption and other planned LTX features.</p>
<h4 id="validation-before-upgrading">Validation Before Upgrading</h4>
<p>Before upgrading to v0.5.0+, if you use Age encryption:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Check if you have Age encryption in your config</span>
</span></span><span class="line"><span class="cl">grep -n <span class="s2">&#34;age:&#34;</span> /etc/litestream.yml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># If the above returns results, you MUST:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 1. Stay on v0.3.x, OR</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 2. Remove Age encryption configuration before upgrading</span>
</span></span></code></pre></div><h3 id="azure-sdk-v2-migration">Azure SDK v2 Migration</h3>
<p><span class="badge badge-info litestream-version" title="This feature has been available since Litestream v0.5.0">
    v0.5.0
</span>
 Litestream v0.5.0 upgraded from the deprecated Azure Storage SDK (<code>github.com/Azure/azure-storage-blob-go</code>) to the modern Azure SDK for Go v2 (<code>github.com/Azure/azure-sdk-for-go/sdk/storage/azblob</code>). This change brings significant improvements in authentication, reliability, and maintenance.</p>
<h4 id="why-this-change-was-made">Why This Change Was Made</h4>
<p>The migration to Azure SDK v2 provides several benefits:</p>
<ul>
<li><strong>Modern authentication</strong>: Support for Azure&rsquo;s default credential chain including Managed Identity</li>
<li><strong>Better reliability</strong>: Improved retry policies with exponential backoff</li>
<li><strong>Active maintenance</strong>: The legacy SDK was retired in September 2024</li>
<li><strong>Consistent patterns</strong>: Aligned with AWS SDK v2 upgrade for unified configuration experience</li>
</ul>
<div class="alert alert-warning d-flex" role="alert">
  <div class="flex-shrink-1 alert-icon">üí°</div>
  <div class="w-100">The legacy azure-storage-blob-go SDK reached end of Community Support on September 13, 2024. All new Azure Blob Storage integrations should use the modern SDK.</div>
</div>
<h4 id="authentication-changes">Authentication Changes</h4>
<p>The most significant improvement is support for Azure&rsquo;s <strong>default credential chain</strong> (<code>DefaultAzureCredential</code>). This allows flexible authentication across different environments without code changes.</p>
<h5 id="credential-chain-order">Credential Chain Order</h5>
<p>When no explicit credentials are configured, Litestream attempts authentication in this order:</p>
<ol>
<li><strong>Environment Credential</strong> (service principal via environment variables)</li>
<li><strong>Workload Identity Credential</strong> (Kubernetes workload identity)</li>
<li><strong>Managed Identity Credential</strong> (Azure VMs, App Service, Functions)</li>
<li><strong>Azure CLI Credential</strong> (local development with <code>az login</code>)</li>
<li><strong>Azure Developer CLI Credential</strong> (local development with <code>azd auth login</code>)</li>
</ol>
<div class="alert alert-warning d-flex" role="alert">
  <div class="flex-shrink-1 alert-icon">üí°</div>
  <div class="w-100">When running outside Azure infrastructure, the credential chain may take several seconds to complete as it attempts each method. This is normal behavior‚Äîthe Managed Identity check times out when not on Azure. For faster startup in non-Azure environments, use explicit credentials (account key or service principal environment variables).</div>
</div>
<h5 id="environment-variables-for-service-principal">Environment Variables for Service Principal</h5>
<p>To authenticate using a service principal, set these environment variables:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AZURE_CLIENT_ID</span><span class="o">=</span>your-app-id
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AZURE_TENANT_ID</span><span class="o">=</span>your-tenant-id
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AZURE_CLIENT_SECRET</span><span class="o">=</span>your-client-secret
</span></span></code></pre></div><p>For certificate-based authentication:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AZURE_CLIENT_ID</span><span class="o">=</span>your-app-id
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AZURE_TENANT_ID</span><span class="o">=</span>your-tenant-id
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AZURE_CLIENT_CERTIFICATE_PATH</span><span class="o">=</span>/path/to/cert.pem
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AZURE_CLIENT_CERTIFICATE_PASSWORD</span><span class="o">=</span>optional-password
</span></span></code></pre></div><h5 id="managed-identity-recommended-for-azure">Managed Identity (Recommended for Azure)</h5>
<p>When running on Azure infrastructure (VMs, App Service, Container Apps, AKS), Managed Identity is the recommended authentication method. No credentials or environment variables are required:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">abs://STORAGEACCOUNT@CONTAINERNAME/PATH</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># No account-key needed - uses Managed Identity</span><span class="w">
</span></span></span></code></pre></div><div class="alert alert-warning d-flex" role="alert">
  <div class="flex-shrink-1 alert-icon">‚ö†Ô∏è</div>
  <div class="w-100">Managed Identity only works when running on Azure infrastructure. For local development, use Azure CLI authentication (`az login`) or explicit credentials.</div>
</div>
<h5 id="shared-key-authentication-backward-compatible">Shared Key Authentication (Backward Compatible)</h5>
<p>Existing configurations using account keys continue to work:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">abs://STORAGEACCOUNT@CONTAINERNAME/PATH</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">account-key</span><span class="p">:</span><span class="w"> </span><span class="l">ACCOUNTKEY</span><span class="w">
</span></span></span></code></pre></div><p>Or using environment variables:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LITESTREAM_AZURE_ACCOUNT_KEY</span><span class="o">=</span>your-account-key
</span></span></code></pre></div><h4 id="configuration-migration">Configuration Migration</h4>
<h5 id="no-breaking-changes">No Breaking Changes</h5>
<p>The upgrade to Azure SDK v2 maintains <strong>full backward compatibility</strong>. All existing Litestream configurations for Azure Blob Storage will continue to work without modification.</p>
<h5 id="new-capabilities">New Capabilities</h5>
<p>With SDK v2, you can now:</p>
<ul>
<li>Use Managed Identity without any credential configuration</li>
<li>Leverage service principal authentication via environment variables</li>
<li>Benefit from improved retry handling automatically</li>
</ul>
<h5 id="before-and-after-examples">Before and After Examples</h5>
<p><strong>Shared Key Authentication</strong> (unchanged):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># v0.3.x and v0.5.x - identical configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">abs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">account-name</span><span class="p">:</span><span class="w"> </span><span class="l">mystorageaccount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">account-key</span><span class="p">:</span><span class="w"> </span><span class="l">${AZURE_STORAGE_KEY}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">bucket</span><span class="p">:</span><span class="w"> </span><span class="l">mycontainer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">backups/app</span><span class="w">
</span></span></span></code></pre></div><p><strong>Managed Identity</strong> (new in v0.5.x):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># v0.5.x - no credentials needed on Azure infrastructure</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">abs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">account-name</span><span class="p">:</span><span class="w"> </span><span class="l">mystorageaccount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">bucket</span><span class="p">:</span><span class="w"> </span><span class="l">mycontainer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">backups/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># Automatically uses Managed Identity when available</span><span class="w">
</span></span></span></code></pre></div><p><strong>Service Principal</strong> (new in v0.5.x):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Set environment variables</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AZURE_CLIENT_ID</span><span class="o">=</span>12345678-1234-1234-1234-123456789012
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AZURE_TENANT_ID</span><span class="o">=</span>87654321-4321-4321-4321-210987654321
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AZURE_CLIENT_SECRET</span><span class="o">=</span>your-client-secret
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># Configuration - no credentials in file</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">abs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">account-name</span><span class="p">:</span><span class="w"> </span><span class="l">mystorageaccount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">bucket</span><span class="p">:</span><span class="w"> </span><span class="l">mycontainer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">backups/app</span><span class="w">
</span></span></span></code></pre></div><h4 id="retry-policy-changes">Retry Policy Changes</h4>
<p>Azure SDK v2 includes improved retry handling:</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Max Retries</td>
<td>10</td>
<td>Maximum retry attempts</td>
</tr>
<tr>
<td>Retry Delay</td>
<td>1-30 seconds</td>
<td>Exponential backoff range</td>
</tr>
<tr>
<td>Try Timeout</td>
<td>15 minutes</td>
<td>Timeout per individual attempt</td>
</tr>
<tr>
<td>Status Codes</td>
<td>408, 429, 500, 502, 503, 504</td>
<td>HTTP codes that trigger retries</td>
</tr>
</tbody>
</table>
<p>These settings are optimized for Azure Blob Storage and follow <a href="https://learn.microsoft.com/en-us/azure/storage/blobs/storage-retry-policy-go">Azure SDK best practices</a>.</p>
<h4 id="troubleshooting">Troubleshooting</h4>
<h5 id="authentication-errors">Authentication Errors</h5>
<p><strong>Error</strong>: <code>DefaultAzureCredential: failed to acquire a token</code></p>
<p><strong>Solutions</strong>:</p>
<ol>
<li><strong>On Azure infrastructure</strong>: Ensure Managed Identity is enabled for your resource</li>
<li><strong>Local development</strong>: Run <code>az login</code> to authenticate with Azure CLI</li>
<li><strong>Service principal</strong>: Verify environment variables are set correctly</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Check if environment variables are set</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">$AZURE_CLIENT_ID</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">$AZURE_TENANT_ID</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">$AZURE_CLIENT_SECRET</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Test Azure CLI authentication</span>
</span></span><span class="line"><span class="cl">az account show
</span></span></code></pre></div><p><strong>Error</strong>: <code>AZURE_TENANT_ID, AZURE_CLIENT_ID, and AZURE_CLIENT_SECRET must be set</code></p>
<p><strong>Solution</strong>: This indicates service principal authentication is being attempted but environment variables are missing. Either:</p>
<ul>
<li>Set all three environment variables, or</li>
<li>Use a different authentication method (Managed Identity, Azure CLI, or account key)</li>
</ul>
<h5 id="timeout-errors">Timeout Errors</h5>
<p>If you encounter timeout errors with large databases:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">abs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">account-name</span><span class="p">:</span><span class="w"> </span><span class="l">mystorageaccount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">bucket</span><span class="p">:</span><span class="w"> </span><span class="l">mycontainer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">backups/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># SDK v2 has a 15-minute per-operation timeout by default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># Contact the Litestream team if you need adjustments</span><span class="w">
</span></span></span></code></pre></div><h5 id="verifying-sdk-version">Verifying SDK Version</h5>
<p>To confirm you&rsquo;re running Litestream v0.5.0+ with Azure SDK v2:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">litestream version
</span></span><span class="line"><span class="cl"><span class="c1"># Should show v0.5.0 or later</span>
</span></span></code></pre></div><h5 id="common-migration-issues">Common Migration Issues</h5>
<p><strong>Issue</strong>: Authentication worked in v0.3.x but fails in v0.5.x</p>
<p><strong>Cause</strong>: The SDK v2 credential chain may behave differently than SDK v1</p>
<p><strong>Solution</strong>: Explicitly specify credentials using either:</p>
<ul>
<li><code>account-key</code> in configuration</li>
<li><code>LITESTREAM_AZURE_ACCOUNT_KEY</code> environment variable</li>
<li>Service principal environment variables (<code>AZURE_CLIENT_ID</code>, etc.)</li>
</ul>
<h4 id="breaking-changes">Breaking Changes</h4>
<p>There are no breaking changes. All v0.3.x Azure Blob Storage configurations work with v0.5.0 without modification. The SDK upgrade is transparent to users with existing configurations.</p>
<h4 id="further-reading">Further Reading</h4>
<ul>
<li><a href="/guides/azure">Azure Blob Storage Guide</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/developer/go/sdk/authentication/authentication-overview">Azure SDK for Go Authentication Overview</a></li>
<li><a href="https://pkg.go.dev/github.com/Azure/azure-sdk-for-go/sdk/azidentity#DefaultAzureCredential">DefaultAzureCredential Documentation</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/storage/blobs/storage-retry-policy-go">Azure Blob Storage Retry Policies</a></li>
</ul>
<h3 id="sqlite-driver-migration">SQLite Driver Migration</h3>
<p><span class="badge badge-info litestream-version" title="This feature has been available since Litestream v0.5.0">
    v0.5.0
</span>
 Litestream v0.5.0 migrated from <a href="https://github.com/mattn/go-sqlite3">mattn/go-sqlite3</a> (cgo-based) to <a href="https://pkg.go.dev/modernc.org/sqlite">modernc.org/sqlite</a> (pure Go). This change provides significant benefits but requires attention to PRAGMA configuration syntax.</p>
<h4 id="why-this-change-was-made-1">Why This Change Was Made</h4>
<p>The migration to <code>modernc.org/sqlite</code> provides several benefits:</p>
<ul>
<li><strong>No cgo requirement</strong>: The main Litestream binary no longer requires a C compiler or cgo toolchain to build</li>
<li><strong>Easier cross-compilation</strong>: Build for any platform without complex cross-compilation toolchains</li>
<li><strong>Signed macOS releases</strong>: Enables automatic signing of Apple Silicon Mac releases</li>
<li><strong>Simpler deployment</strong>: No C library dependencies to manage</li>
</ul>
<div class="alert alert-warning d-flex" role="alert">
  <div class="flex-shrink-1 alert-icon">üí°</div>
  <div class="w-100">The VFS feature (litestream-vfs) still uses cgo-based drivers for performance reasons and remains experimental.</div>
</div>
<h4 id="pragma-configuration-changes">PRAGMA Configuration Changes</h4>
<p>The most significant change is how PRAGMAs are configured in database connection strings. The <code>modernc.org/sqlite</code> driver uses a different syntax than <code>mattn/go-sqlite3</code>.</p>
<h5 id="syntax-comparison">Syntax Comparison</h5>
<table>
<thead>
<tr>
<th>PRAGMA</th>
<th>mattn/go-sqlite3 (v0.3.x)</th>
<th>modernc.org/sqlite (v0.5.0+)</th>
</tr>
</thead>
<tbody>
<tr>
<td>busy_timeout</td>
<td><code>?_busy_timeout=5000</code></td>
<td><code>?_pragma=busy_timeout(5000)</code></td>
</tr>
<tr>
<td>journal_mode</td>
<td><code>?_journal_mode=WAL</code></td>
<td><code>?_pragma=journal_mode(WAL)</code></td>
</tr>
<tr>
<td>synchronous</td>
<td><code>?_synchronous=NORMAL</code></td>
<td><code>?_pragma=synchronous(NORMAL)</code></td>
</tr>
<tr>
<td>foreign_keys</td>
<td><code>?_foreign_keys=1</code></td>
<td><code>?_pragma=foreign_keys(1)</code></td>
</tr>
<tr>
<td>cache_size</td>
<td><code>?_cache_size=2000</code></td>
<td><code>?_pragma=cache_size(2000)</code></td>
</tr>
</tbody>
</table>
<h5 id="connection-string-examples">Connection String Examples</h5>
<p><strong>v0.3.x (mattn/go-sqlite3):</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">file:/path/to/db.sqlite?_busy_timeout=5000&amp;_journal_mode=WAL&amp;_synchronous=NORMAL
</span></span></code></pre></div><p><strong>v0.5.0+ (modernc.org/sqlite):</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">file:/path/to/db.sqlite?_pragma=busy_timeout(5000)&amp;_pragma=journal_mode(WAL)&amp;_pragma=synchronous(NORMAL)
</span></span></code></pre></div><h5 id="multiple-pragmas">Multiple PRAGMAs</h5>
<p>The <code>_pragma</code> parameter can be specified multiple times:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">file:/path/to/db.sqlite?_pragma=busy_timeout(5000)&amp;_pragma=journal_mode(WAL)&amp;_pragma=foreign_keys(1)
</span></span></code></pre></div><h4 id="impact-on-litestream-users">Impact on Litestream Users</h4>
<p>For most Litestream users, this change is transparent. Litestream handles database connections internally and has been updated to use the new syntax. However, if you:</p>
<ul>
<li><strong>Use Litestream as a library</strong>: Update your connection strings to use the new <code>_pragma=name(value)</code> syntax</li>
<li><strong>Pass custom DSN options</strong>: Review and update your database paths</li>
<li><strong>Build Litestream from source</strong>: Note that cgo is no longer required for the main binary</li>
</ul>
<h4 id="for-library-users">For Library Users</h4>
<p>If you embed Litestream as a library and need to configure SQLite pragmas:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// v0.3.x style (mattn/go-sqlite3) - NO LONGER WORKS
</span></span></span><span class="line"><span class="cl"><span class="c1">// dsn := &#34;file:/path/to/db?_busy_timeout=5000&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// v0.5.0+ style (modernc.org/sqlite)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">dsn</span> <span class="o">:=</span> <span class="s">&#34;file:/path/to/db?_pragma=busy_timeout(5000)&#34;</span>
</span></span></code></pre></div><h4 id="building-from-source">Building from Source</h4>
<p>v0.5.0+ simplifies the build process:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># v0.3.x required cgo</span>
</span></span><span class="line"><span class="cl"><span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">1</span> go build ./cmd/litestream
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># v0.5.0+ does not require cgo for main binary</span>
</span></span><span class="line"><span class="cl"><span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> go build ./cmd/litestream
</span></span></code></pre></div><p>Cross-compilation is now straightforward:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Build for Linux on macOS (or any platform)</span>
</span></span><span class="line"><span class="cl"><span class="nv">GOOS</span><span class="o">=</span>linux <span class="nv">GOARCH</span><span class="o">=</span>amd64 go build ./cmd/litestream
</span></span><span class="line"><span class="cl"><span class="nv">GOOS</span><span class="o">=</span>linux <span class="nv">GOARCH</span><span class="o">=</span>arm64 go build ./cmd/litestream
</span></span><span class="line"><span class="cl"><span class="nv">GOOS</span><span class="o">=</span>windows <span class="nv">GOARCH</span><span class="o">=</span>amd64 go build ./cmd/litestream
</span></span></code></pre></div><h4 id="driver-selection-for-library-users">Driver Selection for Library Users</h4>
<p>If you use Litestream as a library and need the cgo-based driver (for VFS support or performance testing):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Pure Go driver (default in v0.5.0+)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">_</span> <span class="s">&#34;modernc.org/sqlite&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// OR cgo-based driver (for VFS/experimental features)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// _ &#34;github.com/mattn/go-sqlite3&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">)</span>
</span></span></code></pre></div><p>Build tags control which driver is compiled:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Default: modernc.org/sqlite</span>
</span></span><span class="line"><span class="cl">go build ./cmd/litestream
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># VFS extension (requires cgo and additional build steps)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># See the VFS Guide for complete build instructions:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># https://litestream.io/guides/vfs/</span>
</span></span></code></pre></div><h4 id="common-pragma-reference">Common PRAGMA Reference</h4>
<p>Here are commonly used PRAGMAs with the v0.5.0+ syntax:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl"># Recommended production settings
</span></span><span class="line"><span class="cl">?_pragma=busy_timeout(5000)&amp;_pragma=journal_mode(WAL)&amp;_pragma=synchronous(NORMAL)&amp;_pragma=foreign_keys(1)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Individual PRAGMAs:
</span></span><span class="line"><span class="cl">_pragma=busy_timeout(5000)      # Wait 5 seconds for locks
</span></span><span class="line"><span class="cl">_pragma=journal_mode(WAL)       # Write-ahead logging (required by Litestream)
</span></span><span class="line"><span class="cl">_pragma=synchronous(NORMAL)     # Balance safety and performance
</span></span><span class="line"><span class="cl">_pragma=foreign_keys(1)         # Enable foreign key constraints
</span></span><span class="line"><span class="cl">_pragma=cache_size(-64000)      # 64MB cache (negative = KB)
</span></span><span class="line"><span class="cl">_pragma=mmap_size(268435456)    # 256MB memory-mapped I/O
</span></span></code></pre></div><p>See the <a href="https://www.sqlite.org/pragma.html">SQLite PRAGMA documentation</a> for the complete list.</p>
<h4 id="troubleshooting-driver-issues">Troubleshooting Driver Issues</h4>
<p><strong>Error</strong>: <code>unknown pragma</code> or PRAGMA not taking effect</p>
<p><strong>Solution</strong>: Ensure you&rsquo;re using the <code>_pragma=name(value)</code> syntax, not the old <code>_name=value</code> syntax.</p>
<p><strong>Error</strong>: Build failures with cgo errors</p>
<p><strong>Solution</strong>: For v0.5.0+, you don&rsquo;t need cgo. Ensure <code>CGO_ENABLED=0</code> or simply don&rsquo;t set it (defaults work).</p>
<p><strong>Error</strong>: Performance differences after upgrade</p>
<p><strong>Solution</strong>: While <code>modernc.org/sqlite</code> is highly optimized, some workloads may see slight differences. If performance is critical, benchmark your specific use case. The pure Go implementation performs comparably to cgo for most workloads.</p>
<h2 id="configuration-migration-1">Configuration Migration</h2>
<h3 id="single-replica-vs-multiple-replicas">Single Replica vs Multiple Replicas</h3>
<p>The new configuration format uses a single <code>replica</code> field instead of a <code>replicas</code> array:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># Multiple replicas (OLD - still supported)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replicas</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://primary-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://secondary-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">file</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/local/backup</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Single replica (NEW - recommended)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://primary-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db </span><span class="w"> </span><span class="c"># Separate entry for each replica</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://secondary-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">file</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/local/backup</span><span class="w">
</span></span></span></code></pre></div><h3 id="global-configuration-sections">Global Configuration Sections</h3>
<p>New global sections provide better control:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># Global snapshot configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">snapshot</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">24h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">168h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Global level-based retention</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">levels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">5m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">1h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">1h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">24h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">24h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">168h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Global exec hooks</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">exec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">cmd</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;/usr/local/bin/notify&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;Litestream started&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Enable MCP server</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">mcp-addr</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;:3001&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://my-bucket/app</span><span class="w">
</span></span></span></code></pre></div><h2 id="replica-type-migration">Replica Type Migration</h2>
<h3 id="migrating-from-file-to-s3">Migrating from File to S3</h3>
<ol>
<li>
<p><strong>Prepare S3 bucket and credentials</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Create S3 bucket</span>
</span></span><span class="line"><span class="cl">aws s3 mb s3://my-litestream-backups
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Configure credentials</span>
</span></span><span class="line"><span class="cl">aws configure
</span></span></code></pre></div></li>
<li>
<p><strong>Update configuration</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># OLD: File replica</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># type: file  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># path: /backup/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># NEW: S3 replica</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://my-litestream-backups/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l">us-east-1</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p><strong>Perform initial sync</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Stop current replication</span>
</span></span><span class="line"><span class="cl">sudo systemctl stop litestream
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Start with new configuration</span>
</span></span><span class="line"><span class="cl">sudo systemctl start litestream
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Verify replication</span>
</span></span><span class="line"><span class="cl">litestream databases
</span></span></code></pre></div></li>
</ol>
<h3 id="migrating-from-s3-to-nats">Migrating from S3 to NATS</h3>
<ol>
<li>
<p><strong>Set up NATS server with JetStream</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Start NATS with JetStream enabled</span>
</span></span><span class="line"><span class="cl">nats-server -js
</span></span></code></pre></div></li>
<li>
<p><strong>Update configuration</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># OLD: S3 replica</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># url: s3://my-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># NEW: NATS replica</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">nats</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">nats://localhost:4222/my-app-bucket</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># Add authentication if needed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">litestream</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">${NATS_PASSWORD}</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p><strong>Create NATS bucket</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Create JetStream bucket</span>
</span></span><span class="line"><span class="cl">nats stream create my-app-bucket <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --subjects<span class="o">=</span><span class="s2">&#34;my-app-bucket.&gt;&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --storage<span class="o">=</span>file <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --retention<span class="o">=</span>limits <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --max-age<span class="o">=</span>168h
</span></span></code></pre></div></li>
</ol>
<h3 id="migrating-between-cloud-providers">Migrating Between Cloud Providers</h3>
<h4 id="s3-to-google-cloud-storage">S3 to Google Cloud Storage</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># OLD: AWS S3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># url: s3://aws-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># region: us-east-1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># NEW: Google Cloud Storage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">gs://gcs-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># Set up Application Default Credentials</span><span class="w">
</span></span></span></code></pre></div><h4 id="s3-to-azure-blob-storage">S3 to Azure Blob Storage</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># OLD: AWS S3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># url: s3://aws-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># NEW: Azure Blob Storage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">abs://storage-account/container/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">account-name</span><span class="p">:</span><span class="w"> </span><span class="l">${AZURE_STORAGE_ACCOUNT}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">account-key</span><span class="p">:</span><span class="w"> </span><span class="l">${AZURE_STORAGE_KEY}</span><span class="w">
</span></span></span></code></pre></div><h2 id="data-migration">Data Migration</h2>
<h3 id="copying-existing-backups">Copying Existing Backups</h3>
<p>When changing replica types, you may want to preserve existing backups:</p>
<ol>
<li>
<p><strong>Export current backups</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># List available LTX files</span>
</span></span><span class="line"><span class="cl">litestream ltx /var/lib/app.db
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Restore latest to temporary file</span>
</span></span><span class="line"><span class="cl">litestream restore -o /tmp/app-backup.db /var/lib/app.db
</span></span></code></pre></div></li>
<li>
<p><strong>Initialize new replica with existing data</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Stop replication</span>
</span></span><span class="line"><span class="cl">sudo systemctl stop litestream
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Update configuration to new replica type</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Start replication (will sync current database)</span>
</span></span><span class="line"><span class="cl">sudo systemctl start litestream
</span></span></code></pre></div></li>
</ol>
<h3 id="zero-downtime-migration">Zero-Downtime Migration</h3>
<p>For production systems requiring zero downtime:</p>
<ol>
<li>
<p><strong>Set up parallel replication</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Keep existing replica</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://old-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Add new replica type  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">nats</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">nats://localhost:4222/new-bucket</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p><strong>Monitor both replicas</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Watch replication status</span>
</span></span><span class="line"><span class="cl">watch -n <span class="m">5</span> <span class="s1">&#39;litestream databases&#39;</span>
</span></span></code></pre></div></li>
<li>
<p><strong>Switch over when new replica is synchronized</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Remove old replica, keep new one</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">nats</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">nats://localhost:4222/new-bucket</span><span class="w">
</span></span></span></code></pre></div></li>
</ol>
<h2 id="command-line-migration">Command-Line Migration</h2>
<h3 id="script-updates">Script Updates</h3>
<p>Update any scripts using deprecated commands:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># OLD commands</span>
</span></span><span class="line"><span class="cl"><span class="c1"># litestream wal /var/lib/app.db</span>
</span></span><span class="line"><span class="cl"><span class="c1"># litestream databases -replica s3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># NEW commands  </span>
</span></span><span class="line"><span class="cl">litestream ltx /var/lib/app.db
</span></span><span class="line"><span class="cl">litestream databases
</span></span></code></pre></div><h3 id="cron-job-updates">Cron Job Updates</h3>
<p>Update cron jobs and systemd timers:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># OLD cron job</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 0 2 * * * litestream wal -path /var/lib/app.db</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># NEW cron job</span>
</span></span><span class="line"><span class="cl"><span class="m">0</span> <span class="m">2</span> * * * litestream ltx /var/lib/app.db
</span></span></code></pre></div><h2 id="testing-migration">Testing Migration</h2>
<h3 id="validation-steps">Validation Steps</h3>
<p>After migration, validate your setup:</p>
<ol>
<li>
<p><strong>Verify configuration</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">litestream databases
</span></span></code></pre></div></li>
<li>
<p><strong>Test restore functionality</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">litestream restore -o /tmp/test-restore.db /var/lib/app.db
</span></span><span class="line"><span class="cl">sqlite3 /tmp/test-restore.db <span class="s2">&#34;PRAGMA integrity_check;&#34;</span>
</span></span></code></pre></div></li>
<li>
<p><strong>Monitor replication</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Watch for replication activity</span>
</span></span><span class="line"><span class="cl">tail -f /var/log/litestream.log
</span></span></code></pre></div></li>
</ol>
<h3 id="rollback-plan">Rollback Plan</h3>
<p>Always have a rollback plan:</p>
<ol>
<li>
<p><strong>Keep old binary available</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Quick rollback if needed</span>
</span></span><span class="line"><span class="cl">sudo cp /usr/local/bin/litestream.backup /usr/local/bin/litestream
</span></span><span class="line"><span class="cl">sudo cp /etc/litestream.yml.backup /etc/litestream.yml
</span></span><span class="line"><span class="cl">sudo systemctl restart litestream
</span></span></code></pre></div></li>
<li>
<p><strong>Restore from backup if needed</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">litestream restore -o /var/lib/app-recovered.db /var/lib/app.db
</span></span></code></pre></div></li>
</ol>
<h2 id="common-migration-issues-1">Common Migration Issues</h2>
<h3 id="configuration-validation-errors">Configuration Validation Errors</h3>
<p><strong>Error</strong>: <code>yaml: unmarshal errors</code>
<strong>Solution</strong>: Validate YAML syntax and check for unsupported options</p>
<h3 id="missing-dependencies">Missing Dependencies</h3>
<p><strong>Error</strong>: MCP server fails to start
<strong>Solution</strong>: Ensure all required ports are available and firewall rules permit access</p>
<h3 id="permission-issues">Permission Issues</h3>
<p><strong>Error</strong>: <code>permission denied</code> when accessing new replica locations<br>
<strong>Solution</strong>: Verify credentials and access permissions for new replica type</p>
<h2 id="getting-help">Getting Help</h2>
<h3 id="migration-support">Migration Support</h3>
<ul>
<li><strong>Documentation</strong>: <a href="https://litestream.io/reference/config/">Configuration Reference</a></li>
<li><strong>Community</strong>: <a href="https://github.com/benbjohnson/litestream/discussions">GitHub Discussions</a></li>
<li><strong>Issues</strong>: <a href="https://github.com/benbjohnson/litestream/issues">Report migration problems</a></li>
</ul>
<h3 id="professional-services">Professional Services</h3>
<p>For complex migrations or production environments, consider:</p>
<ul>
<li>Reviewing migration plan with the community</li>
<li>Testing in staging environment first</li>
<li>Planning maintenance windows for critical systems</li>
</ul>
<h2 id="next-steps">Next Steps</h2>
<p>After migration:</p>
<ul>
<li><a href="https://litestream.io/reference/mcp/">Enable MCP integration</a></li>
<li><a href="https://litestream.io/docs/troubleshooting/">Troubleshooting Guide</a></li>
<li><a href="https://litestream.io/reference/config/">Configuration Reference</a></li>
</ul>

    </article>
  </div>
</div>

      </div>
    </div>
    
    
    <footer>
</footer>
    
    <script src="https://litestream.io/main.f4006b8dd3163d19fa41adf9892089fe185101b404b96884ed2a22ec4e9cb0706759ecdb3f4520a1d37fc5ad7a90a8d90abfb30055a1ff67aefb5b2324355d12.js" integrity="sha512-9ABrjdMWPRn6Qa35iSCJ/hhRAbQEuWiE7Soi7E6csHBnWezbP0UgodN/xa16kKjZCr&#43;zAFWh/2eu&#43;1sjJDVdEg==" crossorigin="anonymous" defer></script>
  <script src="https://litestream.io/index.min.5e4631d144edfc16ee185bed453b33fc154c7d088b6f37ef6cfce5fc04e92aa46815d8f7cc3fb468b0b8cf948763bd3f09157b44ca20c6d6a84fc3127711a785.js" integrity="sha512-XkYx0UTt/BbuGFvtRTsz/BVMfQiLbzfvbPzl/ATpKqRoFdj3zD&#43;0aLC4z5SHY70/CRV7RMogxtaoT8MSdxGnhQ==" crossorigin="anonymous" defer></script>

  </body>
</html>