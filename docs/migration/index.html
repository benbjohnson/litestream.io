<!doctype html>
<html lang="en-US">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <link rel="stylesheet" href="/main.6b1b8740d9d3d1c9f37138879a5cb29ec186c056723f6421dd21deb4e18504eb68df0e73df56491b24c90d1ac9de080e4d991034742630feac126b345b419f04.css" integrity="sha512-axuHQNnT0cnzcTiHmlyynsGGwFZyP2Qh3SHetOGFBOto3w5z31ZJGyTJDRrJ3ggOTZkQNHQmMP6sEms0W0GfBA==" crossorigin="anonymous">
<noscript><style>img.lazyload { display: none; }</style></noscript>

<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;1,400;1,600&display=swap" rel="stylesheet">

  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <title>Migration Guide - Litestream</title>
<meta name="description" content="Guide for upgrading Litestream and migrating between configurations">
<link rel="canonical" href="https://litestream.io/docs/migration/">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://litestream.io/images/twitter-image.png">
<meta name="twitter:title" content="Migration Guide">
<meta name="twitter:description" content="Guide for upgrading Litestream and migrating between configurations">
<meta name="twitter:site" content="@litestreamio">
<meta name="twitter:creator" content="@benbjohnson">

<meta name="twitter:site" content="@litestreamio">
<meta name="twitter:creator" content="@benbjohnson">

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position":  1 ,
        "name": "Home",
        "item": "https:\/\/litestream.io\/"
    },{
        "@type": "ListItem",
        "position":  2 ,
        "name": "Docs",
        "item": "https:\/\/litestream.io\/docs\/"
    },{
        "@type": "ListItem",
        "position":  3 ,
        "name": "Migration",
        "item": "https:\/\/litestream.io\/docs\/migration\/"
    }]
}
</script>

  <meta name="theme-color" content="#fff">
<link rel="apple-touch-icon" sizes="180x180" href="https://litestream.io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://litestream.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://litestream.io/favicon-16x16.png">
<link rel="manifest" href="https://litestream.io/site.webmanifest">
  
</head>
  <body class="docs single">
    <header class="navbar fixed-top navbar-expand-md navbar-light">
  <div class="container align-items-baseline">
    <input class="menu-btn order-0" type="checkbox" id="menu-btn">

    <label class="menu-icon d-md-none" for="menu-btn"><span class="navicon"></span></label>

    <a class="navbar-brand order-1 order-md-0 mr-auto" href="https://litestream.io/">
      <img class="d-md-inline d-none" src="/images/logo.svg" />
      <span class="d-sm-inline d-md-none">Litestream</span>
    </a>

    <ul class="navbar-nav social-nav order-3 order-md-5">
      <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/litestreamio"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg><span class="ml-2 sr-only">Twitter</span></a>
        </li>
      <li class="nav-item">
          <a class="nav-link" href="https://github.com/benbjohnson/litestream"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="ml-2 sr-only">GitHub</span></a>
        </li>
      </ul>

    <div class="collapse navbar-collapse order-4 order-md-1">
      <ul class="navbar-nav main-nav mr-auto order-5 order-md-2"><li class="nav-item">
            <a class="nav-link" href="https://litestream.io/install">Install</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://litestream.io/guides">Guides</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://litestream.io/reference">Reference</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://github.com/benbjohnson/litestream">GitHub</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://join.slack.com/t/litestream/shared_invite/zt-3ed89j5s4-KODYR5v93N_0vHE_kDWCyg">Slack</a>
          </li>
        </ul>
      <div class="break order-6 d-md-none"></div>
    </div>
  </div>
</header>
    <div class="version-banner alert alert-warning text-center mb-0" role="alert" style="border-radius: 0;">
  <div class="container">
    <strong>v0.5.x</strong> - Latest - Actively maintained with new features and bug fixes| <a href="/v0.3/" class="alert-link">View v0.3.13 (Previous)</a></div>
</div>
    <div class="wrap container" role="document">
      <div class="content">
        
<div class="row justify-content-center">
  <div class="col-md-12 col-lg-10 col-xl-8">
    <article>
      <h1>Migration Guide</h1>
      <h2 id="overview">Overview</h2>
<p>This guide covers upgrading Litestream versions, migrating configuration formats, and switching between replica types. Follow the appropriate section based on your current setup and target version.</p>
<h2 id="version-upgrades">Version Upgrades</h2>
<h3 id="upgrading-to-v050">Upgrading to v0.5.0+</h3>
<p><span class="badge badge-info litestream-version" title="This feature has been available since Litestream v0.5.0">
    v0.5.0
</span>
 includes MCP support and NATS replication.</p>
<h4 id="pre-upgrade-checklist">Pre-Upgrade Checklist</h4>
<ol>
<li>
<p><strong>Backup your current setup</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Stop Litestream</span>
</span></span><span class="line"><span class="cl">sudo systemctl stop litestream
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Backup configuration</span>
</span></span><span class="line"><span class="cl">cp /etc/litestream.yml /etc/litestream.yml.backup
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Backup binary</span>
</span></span><span class="line"><span class="cl">cp <span class="k">$(</span>which litestream<span class="k">)</span> /usr/local/bin/litestream.backup
</span></span></code></pre></div></li>
<li>
<p><strong>Review configuration changes</strong> (see Configuration Migration below)</p>
</li>
<li>
<p><strong>Test in staging environment</strong> before upgrading production</p>
</li>
</ol>
<h4 id="installation">Installation</h4>
<p>Download and install the new version:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Download latest stable release (check https://github.com/benbjohnson/litestream/releases)</span>
</span></span><span class="line"><span class="cl">wget https://github.com/benbjohnson/litestream/releases/download/v0.3.13/litestream-v0.3.13-linux-amd64.tar.gz
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Extract and install</span>
</span></span><span class="line"><span class="cl">tar -xzf litestream-v0.3.13-linux-amd64.tar.gz
</span></span><span class="line"><span class="cl">sudo mv litestream /usr/local/bin/
</span></span><span class="line"><span class="cl">sudo chmod +x /usr/local/bin/litestream
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Verify installation</span>
</span></span><span class="line"><span class="cl">litestream version
</span></span></code></pre></div><h3 id="upgrading-from-v03x-to-v050">Upgrading from v0.3.x to v0.5.0+</h3>
<h4 id="key-changes">Key Changes</h4>
<ol>
<li>
<p><strong>Command Changes</strong>:</p>
<ul>
<li><code>litestream wal</code> â†’ <code>litestream ltx</code> (WAL command renamed to LTX)</li>
<li>New <code>mcp-addr</code> configuration option for Model Context Protocol support</li>
<li>NATS replica support with JetStream</li>
</ul>
</li>
<li>
<p><strong>Configuration Changes</strong>:</p>
<ul>
<li>Single <code>replica</code> field replaces <code>replicas</code> array (backward compatible)</li>
<li>New global configuration sections: <code>levels</code>, <code>snapshot</code>, <code>exec</code></li>
<li>Extended replica configuration options</li>
</ul>
</li>
</ol>
<h4 id="migration-steps">Migration Steps</h4>
<ol>
<li><strong>Update configuration format</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># OLD FORMAT (still supported, but only with a single replica)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replicas</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://my-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">72h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># NEW FORMAT (recommended)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://my-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">72h</span><span class="w">
</span></span></span></code></pre></div><ol start="2">
<li><strong>Override default settings</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># Add MCP support (disabled by default)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">mcp-addr</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;:3001&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Override global snapshot configuration (defaults: interval=24h, retention=24h)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">snapshot</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">24h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">168h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Add level-based retention (no default levels configured)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">levels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">1h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">24h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">24h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">168h</span><span class="w">
</span></span></span></code></pre></div><ol start="3">
<li><strong>Update command usage</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># OLD: Query WAL information</span>
</span></span><span class="line"><span class="cl">litestream wal /path/to/db.sqlite
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># NEW: Query LTX information  </span>
</span></span><span class="line"><span class="cl">litestream ltx /path/to/db.sqlite
</span></span></code></pre></div><ol start="4">
<li><strong>Restart services</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Restart Litestream with new configuration</span>
</span></span><span class="line"><span class="cl">sudo systemctl restart litestream
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Verify it&#39;s working</span>
</span></span><span class="line"><span class="cl">sudo systemctl status litestream
</span></span><span class="line"><span class="cl">litestream databases
</span></span></code></pre></div><h2 id="configuration-migration">Configuration Migration</h2>
<h3 id="single-replica-vs-multiple-replicas">Single Replica vs Multiple Replicas</h3>
<p>The new configuration format uses a single <code>replica</code> field instead of a <code>replicas</code> array:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># Multiple replicas (OLD - still supported)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replicas</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://primary-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://secondary-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">file</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/local/backup</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Single replica (NEW - recommended)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://primary-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db </span><span class="w"> </span><span class="c"># Separate entry for each replica</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://secondary-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">file</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/local/backup</span><span class="w">
</span></span></span></code></pre></div><h3 id="global-configuration-sections">Global Configuration Sections</h3>
<p>New global sections provide better control:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># Global snapshot configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">snapshot</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">24h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">168h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Global level-based retention</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">levels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">5m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">1h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">1h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">24h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">24h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l">168h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Global exec hooks</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">exec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">cmd</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;/usr/local/bin/notify&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;Litestream started&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Enable MCP server</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">mcp-addr</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;:3001&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://my-bucket/app</span><span class="w">
</span></span></span></code></pre></div><h2 id="replica-type-migration">Replica Type Migration</h2>
<h3 id="migrating-from-file-to-s3">Migrating from File to S3</h3>
<ol>
<li>
<p><strong>Prepare S3 bucket and credentials</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Create S3 bucket</span>
</span></span><span class="line"><span class="cl">aws s3 mb s3://my-litestream-backups
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Configure credentials</span>
</span></span><span class="line"><span class="cl">aws configure
</span></span></code></pre></div></li>
<li>
<p><strong>Update configuration</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># OLD: File replica</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># type: file  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># path: /backup/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># NEW: S3 replica</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://my-litestream-backups/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l">us-east-1</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p><strong>Perform initial sync</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Stop current replication</span>
</span></span><span class="line"><span class="cl">sudo systemctl stop litestream
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Start with new configuration</span>
</span></span><span class="line"><span class="cl">sudo systemctl start litestream
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Verify replication</span>
</span></span><span class="line"><span class="cl">litestream databases
</span></span></code></pre></div></li>
</ol>
<h3 id="migrating-from-s3-to-nats">Migrating from S3 to NATS</h3>
<ol>
<li>
<p><strong>Set up NATS server with JetStream</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Start NATS with JetStream enabled</span>
</span></span><span class="line"><span class="cl">nats-server -js
</span></span></code></pre></div></li>
<li>
<p><strong>Update configuration</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># OLD: S3 replica</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># url: s3://my-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># NEW: NATS replica</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">nats</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">nats://localhost:4222/my-app-bucket</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># Add authentication if needed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">litestream</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">${NATS_PASSWORD}</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p><strong>Create NATS bucket</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Create JetStream bucket</span>
</span></span><span class="line"><span class="cl">nats stream create my-app-bucket <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --subjects<span class="o">=</span><span class="s2">&#34;my-app-bucket.&gt;&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --storage<span class="o">=</span>file <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --retention<span class="o">=</span>limits <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --max-age<span class="o">=</span>168h
</span></span></code></pre></div></li>
</ol>
<h3 id="migrating-between-cloud-providers">Migrating Between Cloud Providers</h3>
<h4 id="s3-to-google-cloud-storage">S3 to Google Cloud Storage</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># OLD: AWS S3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># url: s3://aws-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># region: us-east-1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># NEW: Google Cloud Storage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">gs://gcs-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># Set up Application Default Credentials</span><span class="w">
</span></span></span></code></pre></div><h4 id="s3-to-azure-blob-storage">S3 to Azure Blob Storage</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># OLD: AWS S3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># url: s3://aws-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># NEW: Azure Blob Storage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">abs://storage-account/container/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">account-name</span><span class="p">:</span><span class="w"> </span><span class="l">${AZURE_STORAGE_ACCOUNT}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">account-key</span><span class="p">:</span><span class="w"> </span><span class="l">${AZURE_STORAGE_KEY}</span><span class="w">
</span></span></span></code></pre></div><h2 id="data-migration">Data Migration</h2>
<h3 id="copying-existing-backups">Copying Existing Backups</h3>
<p>When changing replica types, you may want to preserve existing backups:</p>
<ol>
<li>
<p><strong>Export current backups</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># List available LTX files</span>
</span></span><span class="line"><span class="cl">litestream ltx /var/lib/app.db
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Restore latest to temporary file</span>
</span></span><span class="line"><span class="cl">litestream restore -o /tmp/app-backup.db /var/lib/app.db
</span></span></code></pre></div></li>
<li>
<p><strong>Initialize new replica with existing data</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Stop replication</span>
</span></span><span class="line"><span class="cl">sudo systemctl stop litestream
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Update configuration to new replica type</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Start replication (will sync current database)</span>
</span></span><span class="line"><span class="cl">sudo systemctl start litestream
</span></span></code></pre></div></li>
</ol>
<h3 id="zero-downtime-migration">Zero-Downtime Migration</h3>
<p>For production systems requiring zero downtime:</p>
<ol>
<li>
<p><strong>Set up parallel replication</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Keep existing replica</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://old-bucket/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Add new replica type  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">nats</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">nats://localhost:4222/new-bucket</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p><strong>Monitor both replicas</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Watch replication status</span>
</span></span><span class="line"><span class="cl">watch -n <span class="m">5</span> <span class="s1">&#39;litestream databases&#39;</span>
</span></span></code></pre></div></li>
<li>
<p><strong>Switch over when new replica is synchronized</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Remove old replica, keep new one</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app.db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">nats</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">nats://localhost:4222/new-bucket</span><span class="w">
</span></span></span></code></pre></div></li>
</ol>
<h2 id="command-line-migration">Command-Line Migration</h2>
<h3 id="script-updates">Script Updates</h3>
<p>Update any scripts using deprecated commands:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># OLD commands</span>
</span></span><span class="line"><span class="cl"><span class="c1"># litestream wal /var/lib/app.db</span>
</span></span><span class="line"><span class="cl"><span class="c1"># litestream databases -replica s3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># NEW commands  </span>
</span></span><span class="line"><span class="cl">litestream ltx /var/lib/app.db
</span></span><span class="line"><span class="cl">litestream databases
</span></span></code></pre></div><h3 id="cron-job-updates">Cron Job Updates</h3>
<p>Update cron jobs and systemd timers:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># OLD cron job</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 0 2 * * * litestream wal -path /var/lib/app.db</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># NEW cron job</span>
</span></span><span class="line"><span class="cl"><span class="m">0</span> <span class="m">2</span> * * * litestream ltx /var/lib/app.db
</span></span></code></pre></div><h2 id="testing-migration">Testing Migration</h2>
<h3 id="validation-steps">Validation Steps</h3>
<p>After migration, validate your setup:</p>
<ol>
<li>
<p><strong>Verify configuration</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">litestream databases
</span></span></code></pre></div></li>
<li>
<p><strong>Test restore functionality</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">litestream restore -o /tmp/test-restore.db /var/lib/app.db
</span></span><span class="line"><span class="cl">sqlite3 /tmp/test-restore.db <span class="s2">&#34;PRAGMA integrity_check;&#34;</span>
</span></span></code></pre></div></li>
<li>
<p><strong>Monitor replication</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Watch for replication activity</span>
</span></span><span class="line"><span class="cl">tail -f /var/log/litestream.log
</span></span></code></pre></div></li>
</ol>
<h3 id="rollback-plan">Rollback Plan</h3>
<p>Always have a rollback plan:</p>
<ol>
<li>
<p><strong>Keep old binary available</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Quick rollback if needed</span>
</span></span><span class="line"><span class="cl">sudo cp /usr/local/bin/litestream.backup /usr/local/bin/litestream
</span></span><span class="line"><span class="cl">sudo cp /etc/litestream.yml.backup /etc/litestream.yml
</span></span><span class="line"><span class="cl">sudo systemctl restart litestream
</span></span></code></pre></div></li>
<li>
<p><strong>Restore from backup if needed</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">litestream restore -o /var/lib/app-recovered.db /var/lib/app.db
</span></span></code></pre></div></li>
</ol>
<h2 id="common-migration-issues">Common Migration Issues</h2>
<h3 id="configuration-validation-errors">Configuration Validation Errors</h3>
<p><strong>Error</strong>: <code>yaml: unmarshal errors</code>
<strong>Solution</strong>: Validate YAML syntax and check for unsupported options</p>
<h3 id="missing-dependencies">Missing Dependencies</h3>
<p><strong>Error</strong>: MCP server fails to start
<strong>Solution</strong>: Ensure all required ports are available and firewall rules permit access</p>
<h3 id="permission-issues">Permission Issues</h3>
<p><strong>Error</strong>: <code>permission denied</code> when accessing new replica locations<br>
<strong>Solution</strong>: Verify credentials and access permissions for new replica type</p>
<h2 id="getting-help">Getting Help</h2>
<h3 id="migration-support">Migration Support</h3>
<ul>
<li><strong>Documentation</strong>: <a href="https://litestream.io/reference/config/">Configuration Reference</a></li>
<li><strong>Community</strong>: <a href="https://github.com/benbjohnson/litestream/discussions">GitHub Discussions</a></li>
<li><strong>Issues</strong>: <a href="https://github.com/benbjohnson/litestream/issues">Report migration problems</a></li>
</ul>
<h3 id="professional-services">Professional Services</h3>
<p>For complex migrations or production environments, consider:</p>
<ul>
<li>Reviewing migration plan with the community</li>
<li>Testing in staging environment first</li>
<li>Planning maintenance windows for critical systems</li>
</ul>
<h2 id="next-steps">Next Steps</h2>
<p>After migration:</p>
<ul>
<li><a href="https://litestream.io/reference/mcp/">Enable MCP integration</a></li>
<li><a href="https://litestream.io/docs/troubleshooting/">Troubleshooting Guide</a></li>
<li><a href="https://litestream.io/reference/config/">Configuration Reference</a></li>
</ul>

    </article>
  </div>
</div>

      </div>
    </div>
    
    
    <footer>
</footer>
    
    <script src="https://litestream.io/main.f4006b8dd3163d19fa41adf9892089fe185101b404b96884ed2a22ec4e9cb0706759ecdb3f4520a1d37fc5ad7a90a8d90abfb30055a1ff67aefb5b2324355d12.js" integrity="sha512-9ABrjdMWPRn6Qa35iSCJ/hhRAbQEuWiE7Soi7E6csHBnWezbP0UgodN/xa16kKjZCr&#43;zAFWh/2eu&#43;1sjJDVdEg==" crossorigin="anonymous" defer></script>
  <script src="https://litestream.io/index.min.e04ee49e690eded37dc03980e051ea16b5eb8ab2b615fd73ace1ada6e873b5d02f05e3c8aa463936f9bb9377f2096ac5e07deee2d61ec3fd427e14afe7b813b5.js" integrity="sha512-4E7knmkO3tN9wDmA4FHqFrXrirK2Ff1zrOGtpuhztdAvBePIqkY5Nvm7k3fyCWrF4H3u4tYew/1CfhSv57gTtQ==" crossorigin="anonymous" defer></script>

  </body>
</html>