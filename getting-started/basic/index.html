<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet href=https://litestream.io/main.9a379f0e47cf6a7ae8725e6b50a5421ecc882f7da21b8814e611a13d3aff805bf5de08a3061726b542524e25fd7f5e69d00c28b994c8c592eafe543100fe31af.css integrity="sha512-mjefDkfPanrocl5rUKVCHsyIL32iG4gU5hGhPTr/gFv13gijBhcmtUJSTiX9f15p0AwouZTIxZLq/lQxAP4xrw==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;1,400;1,600&display=swap" rel=stylesheet><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Replicating a Single Database - Litestream</title><meta name=description content="Litestream replicates SQLite databases in real-time to S3."><link rel=canonical href=https://litestream.io/getting-started/basic/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://litestream.io/litestream.png"><meta name=twitter:title content="Replicating a Single Database"><meta name=twitter:description content="This tutorial will get you up and running with Litestream locally and replicating a SQLite database to Amazon S3. By the end, you&rsquo;ll understand the replicate and restore commands and be able to continuously backup your database. This tutorial assumes you&rsquo;re comfortable on the command line.
Before continuing, please install Litestream on your local machine. You will also need SQLite installed for this tutorial. It comes packaged with some operating systems such as Mac OS X but you may need to install it separately."><meta name=twitter:site content="@litestreamio"><meta name=twitter:creator content="@litestreamio"><meta property="og:title" content="Replicating a Single Database"><meta property="og:description" content="This tutorial will get you up and running with Litestream locally and replicating a SQLite database to Amazon S3. By the end, you&rsquo;ll understand the replicate and restore commands and be able to continuously backup your database. This tutorial assumes you&rsquo;re comfortable on the command line.
Before continuing, please install Litestream on your local machine. You will also need SQLite installed for this tutorial. It comes packaged with some operating systems such as Mac OS X but you may need to install it separately."><meta property="og:type" content="article"><meta property="og:url" content="https://litestream.io/getting-started/basic/"><meta property="og:image" content="https://litestream.io/litestream.png"><meta property="article:published_time" content="2021-02-01T00:00:00+00:00"><meta property="article:modified_time" content="2021-02-01T00:00:00+00:00"><meta property="og:site_name" content="Litestream"><meta property="article:publisher" content="https://www.facebook.com/"><meta property="article:author" content="https://www.facebook.com/"><meta property="og:locale" content="en_US"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/litestream.io\/"},{"@type":"ListItem","position":2,"name":"Getting Started","item":"https:\/\/litestream.io\/getting-started\/"},{"@type":"ListItem","position":3,"name":"Basic","item":"https:\/\/litestream.io\/getting-started\/basic\/"}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://litestream.io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://litestream.io/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://litestream.io/favicon-16x16.png><link rel=manifest href=https://litestream.io/site.webmanifest></head><body class="getting-started single"><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class="container align-items-baseline"><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 mr-auto" href=https://litestream.io/>Litestream</a><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://twitter.com/litestreamio><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg><span class="ml-2 sr-only">Twitter</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/benbjohnson/litestream><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ml-2 sr-only">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav mr-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=https://litestream.io/install>Install</a></li><li class=nav-item><a class=nav-link href=https://litestream.io/getting-started>Getting Started</a></li><li class=nav-item><a class=nav-link href=https://litestream.io/blog/>Blog</a></li></ul><div class="break order-6 d-md-none"></div></div></div></header><div class="wrap container" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><h3><a href=https://litestream.io/install>Install</a></h3><ul class=list-unstyled><li><a class=docs-link href=https://litestream.io/install/mac/>Mac OS X</a></li><li><a class=docs-link href=https://litestream.io/install/debian/>Linux (Debian)</a></li><li><a class=docs-link href=https://litestream.io/install/source/>Build from Source</a></li></ul><h3><a href=https://litestream.io/getting-started/>Getting Started</a></h3><ul class=list-unstyled><li><a class="docs-link active" href=https://litestream.io/getting-started/basic/>Replicating a Single Database</a></li><li><a class=docs-link href=https://litestream.io/getting-started/systemd/>Running as a systemd Service</a></li></ul><h3><a href=https://litestream.io/reference/>Reference</a></h3></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#creating-an-s3-bucket>Creating an S3 bucket</a></li><li><a href=#setting-up-your-database>Setting up your database</a></li><li><a href=#replicating-your-database>Replicating your database</a></li><li><a href=#restoring-your-database>Restoring your database</a></li><li><a href=#continuous-replication>Continuous replication</a></li><li><a href=#further-reading>Further reading</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>Replicating a Single Database</h1><p class=lead></p><p>This tutorial will get you up and running with Litestream locally and
replicating a SQLite database to Amazon S3. By the end, you&rsquo;ll understand the
<code>replicate</code> and <code>restore</code> commands and be able to continuously backup your
database. This tutorial assumes you&rsquo;re comfortable on the command line.</p><p>Before continuing, <a href=/install>please install Litestream on your local machine</a>.
You will also need SQLite installed for this tutorial. It comes packaged with
some operating systems such as Mac OS X but you may need to install it separately.</p><h2 id=creating-an-s3-bucket>Creating an S3 bucket<a href=#creating-an-s3-bucket class=anchor aria-hidden=true>#</a></h2><p>If you don&rsquo;t already have an Amazon AWS account, you can go
<a href=https://aws.amazon.com/>https://aws.amazon.com/</a> and click &ldquo;Create Account&rdquo;.
Once you have an account, you&rsquo;ll log in and obtain API credentials from their
IAM service. You should have an &ldquo;access key id&rdquo; and a &ldquo;secret access key&rdquo;.
Once you have those, add them to your environment variables. On Mac OS X &
Linux, you can run this from your command line using your own key values:</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh><span class=nb>export</span> <span class=nv>AWS_ACCESS_KEY_ID</span><span class=o>=</span>AKIAxxxxxxxxxxxxxxxx
<span class=nb>export</span> <span class=nv>AWS_SECRET_ACCESS_KEY</span><span class=o>=</span>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/xxxxxxxxx
</code></pre></div><p>After your credentials are set, you&rsquo;ll also need to create a bucket in the S3
service of AWS. You&rsquo;ll need to create a unique name for your bucket. In this
tutorial, we&rsquo;ll name our bucket, <code>"mybkt.litestream.io"</code>.</p><h2 id=setting-up-your-database>Setting up your database<a href=#setting-up-your-database class=anchor aria-hidden=true>#</a></h2><p>Now that our S3 bucket is configured, we can replicate data to it. Litestream
can work with any SQLite database so we&rsquo;ll use the <code>sqlite3</code> command line tool
to show how it works.</p><p>First, we&rsquo;ll open a new database file:</p><pre><code>sqlite3 fruits.db
</code></pre><p>This will open the SQLite command prompt and now we can execute SQL commands.
We&rsquo;ll start with creating a new table:</p><pre><code>CREATE TABLE fruits (name TEXT, color TEXT);
</code></pre><p>And we can add some data to our table:</p><pre><code>INSERT INTO fruits (name, color) VALUES ('apple', 'red');
INSERT INTO fruits (name, color) VALUES ('banana', 'yellow');
</code></pre><h2 id=replicating-your-database>Replicating your database<a href=#replicating-your-database class=anchor aria-hidden=true>#</a></h2><p><strong>In a separate terminal window</strong>, we&rsquo;ll run Litestream to replicate our new
database. Make sure both terminal windows are using the same working directory.</p><pre><code>litestream replicate fruits.db s3://mybkt.litestream.io/fruits.db
</code></pre><p>You should see Litestream print some initialization commands and then hang
indefinitely. Normally, Litestream is run as a background service so it
continuously watches your database for new changes.</p><p>If you open the <a href=https://s3.console.aws.amazon.com/s3>S3 Management Console</a>,
you will see there is a <code>fruits.db</code> directory in your bucket.</p><h2 id=restoring-your-database>Restoring your database<a href=#restoring-your-database class=anchor aria-hidden=true>#</a></h2><p><strong>In a third terminal window</strong>, we&rsquo;ll restore our database to a new file. Make
sure your environment variables are set correctly and run:</p><pre><code>litestream restore -o fruits2.db s3://mybkt.litestream.io/fruits.db
</code></pre><p>This will pull down the backup from S3 and write it to the <code>fruits2.db</code> file.
You can verify the database matches by opening it with SQLite:</p><pre><code>sqlite3 fruits2.db
</code></pre><p>And reading the data:</p><pre><code>SELECT * FROM fruits;
apple|red
banana|yellow
</code></pre><p>Litestream physically replicates the data so the original and restored database
should match byte-for-byte. You can verify this by running a checksum on the
files:</p><pre><code>md5 fruit*
MD5 (fruit.db) = e6a6ceda013b99c7ddc8b68ebd4351d0
MD5 (fruit2.db) = e6a6ceda013b99c7ddc8b68ebd4351d0
</code></pre><h2 id=continuous-replication>Continuous replication<a href=#continuous-replication class=anchor aria-hidden=true>#</a></h2><p>Litestream continuously monitors your database and backs it up to S3. We can
see this by writing some more data to our original <code>fruit.db</code> database. Open
the database (if you don&rsquo;t already have it open):</p><pre><code>sqlite3 fruit.db
</code></pre><p>Then write a new row to our table:</p><pre><code>INSERT INTO fruits (name, color) VALUES ('grape', 'blue');
</code></pre><p>Litestream will replicate to S3 <em>every 10 seconds</em> by default so you&rsquo;ll need to
wait for that time to pass and then you can restore your database again to a
new <code>fruits3.db</code> file:</p><pre><code>litestream restore -o fruits3.db s3://mybkt.litestream.io/fruits.db
</code></pre><p>We can open this file:</p><pre><code>sqlite3 fruits3.db
</code></pre><p>Then read the data and we should now see our new row:</p><pre><code>SELECT * FROM fruits;
apple|red
banana|yellow
grape|purple
</code></pre><h2 id=further-reading>Further reading<a href=#further-reading class=anchor aria-hidden=true>#</a></h2><p>Litestream was built to run as a background service that you don&rsquo;t need to worry
aboutâ€”it just replicates your database all the time. To run Litestream as a
background service, please read the <a href=/getting-started/systemd>Running as a Systemd Service</a>
tutorial.</p><div class="docs-navigation d-flex justify-content-between"><a class=ml-auto href=https://litestream.io/getting-started/systemd/><div class="card my-1"><div class="card-body py-2">Running as a systemd Service &rarr;</div></div></a></div></main></div></div></div><footer></footer><script src=https://litestream.io/main.f6b484f556ad1f3bcf6061082139a2f21fa759f13930c39a25fe4a9f78f35e64122c2d86dffd56e67b292dabbda4095d8077194f196e0e348441c106a9f3d40e.js integrity="sha512-9rSE9VatHzvPYGEIITmi8h+nWfE5MMOaJf5Kn3jzXmQSLC2G3/1W5nspLau9pAldgHcZTxluDjSEQcEGqfPUDg==" crossorigin=anonymous defer></script><script src=https://litestream.io/index.min.3cf72e2d46fb5e5ef4c137f33b9a80ab66cb3d96bc8451412b740d90917bb1d3f5f511faa6358f78f6c5b4610e34b9f0a696d9a355e8ed0e55884a6267cf452c.js integrity="sha512-PPcuLUb7Xl70wTfzO5qAq2bLPZa8hFFBK3QNkJF7sdP19RH6pjWPePbFtGEONLnwppbZo1Xo7Q5ViEpiZ89FLA==" crossorigin=anonymous defer></script></body></html>