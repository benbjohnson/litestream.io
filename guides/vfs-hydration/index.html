<!doctype html>
<html lang="en-US">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <link rel="stylesheet" href="/main.211f27ab66d952d637fa741b575d7cfdf53f25b5ea7d6f38193f667a756f6b85f1e0e59a36a863834fb2e4ef66f1928cff1358b23bb8a5956101d4994514962f.css" integrity="sha512-IR8nq2bZUtY3&#43;nQbV118/fU/JbXqfW84GT9menVva4Xx4OWaNqhjg0&#43;y5O9m8ZKM/xNYsju4pZVhAdSZRRSWLw==" crossorigin="anonymous">
<noscript><style>img.lazyload { display: none; }</style></noscript>

<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;1,400;1,600&display=swap" rel="stylesheet">

  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <title>VFS Hydration - Litestream</title>
<meta name="description" content="Litestream replicates SQLite databases in real-time to S3.">
<link rel="canonical" href="https://litestream.io/guides/vfs-hydration/">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://litestream.io/images/twitter-image.png">
<meta name="twitter:title" content="VFS Hydration">
<meta name="twitter:description" content="VFS hydration restores the entire database to a local file in the background while the VFS continues serving reads from the cache and remote storage. Once hydration completes, all reads are served from the local file, eliminating remote fetch latency entirely.
When to use hydration Read-heavy workloads where remote latency impacts performance. Large databases where the cache cannot hold the full working set. Latency-sensitive applications that need local-disk performance after startup.">
<meta name="twitter:site" content="@litestreamio">
<meta name="twitter:creator" content="@benbjohnson">

<meta name="twitter:site" content="@litestreamio">
<meta name="twitter:creator" content="@benbjohnson">

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position":  1 ,
        "name": "Home",
        "item": "https:\/\/litestream.io\/"
    },{
        "@type": "ListItem",
        "position":  2 ,
        "name": "Guides",
        "item": "https:\/\/litestream.io\/guides\/"
    },{
        "@type": "ListItem",
        "position":  3 ,
        "name": "Vfs Hydration",
        "item": "https:\/\/litestream.io\/guides\/vfs-hydration\/"
    }]
}
</script>

  <meta name="theme-color" content="#fff">
<link rel="apple-touch-icon" sizes="180x180" href="https://litestream.io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://litestream.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://litestream.io/favicon-16x16.png">
<link rel="manifest" href="https://litestream.io/site.webmanifest">
  
</head>
  <body class="guides single">
    <header class="navbar fixed-top navbar-expand-md navbar-light">
  <div class="container align-items-baseline">
    <input class="menu-btn order-0" type="checkbox" id="menu-btn">

    <label class="menu-icon d-md-none" for="menu-btn"><span class="navicon"></span></label>

    <a class="navbar-brand order-1 order-md-0 mr-auto" href="https://litestream.io/">
      <img class="d-md-inline d-none" src="/images/logo.svg" />
      <span class="d-sm-inline d-md-none">Litestream</span>
    </a>

    <ul class="navbar-nav social-nav order-3 order-md-5">
      <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/litestreamio"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg><span class="ml-2 sr-only">Twitter</span></a>
        </li>
      <li class="nav-item">
          <a class="nav-link" href="https://github.com/benbjohnson/litestream"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="ml-2 sr-only">GitHub</span></a>
        </li>
      </ul>

    <div class="collapse navbar-collapse order-4 order-md-1">
      <ul class="navbar-nav main-nav mr-auto order-5 order-md-2"><li class="nav-item">
            <a class="nav-link" href="https://litestream.io/install">Install</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://litestream.io/guides">Guides</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://litestream.io/reference">Reference</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://github.com/benbjohnson/litestream">GitHub</a>
          </li>
        </ul>
      <div class="break order-6 d-md-none"></div>
    </div>
  </div>
</header>
    <div class="version-banner alert alert-warning text-center mb-0" role="alert" style="border-radius: 0;">
  <div class="container">
    <strong>v0.5.x</strong> - Latest - Actively maintained with new features and bug fixes| <a href="/v0.3/" class="alert-link">View v0.3.13 (Previous)</a></div>
</div>
    <div class="wrap container" role="document">
      <div class="content">
        
	<div class="row flex-xl-nowrap">
		<div class="col-lg-5 col-xl-4 docs-sidebar">
			<nav class="docs-links" aria-label="Main navigation">
				<h3>
    <a href="https://litestream.io/install">Install</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/install/mac/">macOS</a></li>
    <li><a class="docs-link" href="https://litestream.io/install/linux/">Linux</a></li>
    <li><a class="docs-link" href="https://litestream.io/install/source/">Build from Source</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/">General</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/getting-started/">Getting Started</a></li>
    <li><a class="docs-link" href="https://litestream.io/tips/">Tips &amp; Caveats</a></li>
    <li><a class="docs-link" href="https://litestream.io/how-it-works/">How it works</a></li>
    <li><a class="docs-link" href="https://litestream.io/how-it-works/vfs/">Read Replicas with VFS</a></li>
    <li><a class="docs-link" href="https://litestream.io/alternatives/">Alternatives</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/guides/">Infrastructure Guides</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/guides/docker/">Running in a Docker container</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/kubernetes/">Running in a Kubernetes cluster</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/systemd/">Running as a Systemd service</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/windows/">Running as a Windows Service</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/directory-watcher/">Directory Watcher</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/guides/">Replica Guides</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/guides/global-defaults/">Global Replica Defaults</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/s3/">Replicating to Amazon S3</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/aws-sdk-v2/">AWS SDK v2 Migration</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/alibaba-oss/">Replicating to Alibaba Cloud OSS</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/s3-advanced/">S3 Advanced Configuration</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/vfs/">VFS Read Replicas</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/go-library/">Using Litestream as a Go Library</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/vfs-write-mode/">VFS Write Mode</a></li>
    <li><a class="docs-link active" href="https://litestream.io/guides/vfs-hydration/">VFS Hydration</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/azure/">Replicating to Azure Blob Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/s3-compatible/">Replicating to S3-Compatible Services</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/backblaze/">Replicating to Backblaze B2</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/digitalocean/">Replicating to DigitalOcean Spaces</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/scaleway/">Replicating to Scaleway Object Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/tigris/">Replicating to Tigris (Fly.io)</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/gcs/">Replicating to Google Cloud Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/linode/">Replicating to Linode Object Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/sftp/">Replicating to an SFTP Server</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/file/">Replicating to a Local File Path</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/nats/">Replicating to NATS JetStream</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/directory/">Replicating Directories</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/webdav/">Replicating to a WebDAV Server</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/docs/">Help</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/docs/migration/">Migration Guide</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/wal-truncate-threshold/">WAL Truncate Threshold Configuration</a></li>
    <li><a class="docs-link" href="https://litestream.io/docs/troubleshooting/">Troubleshooting</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/reference/">Reference</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/reference/config/">Configuration File</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/vfs/">VFS Extension</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/metrics/">Prometheus Metrics</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/databases/">Command: databases</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/mcp/">Command: mcp</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/replicate/">Command: replicate</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/ltx/">Command: ltx</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/restore/">Command: restore</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/version/">Command: version</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/wal/">Command: wal</a></li>
    </ul>
  
			</nav>        
		</div>
		<nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation">
			<div class="page-links">
    <h3>On this page</h3>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#when-to-use-hydration">When to use hydration</a></li>
    <li><a href="#when-not-to-use-hydration">When NOT to use hydration</a></li>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#configuration">Configuration</a>
      <ul>
        <li><a href="#configuration-options">Configuration options</a></li>
      </ul>
    </li>
    <li><a href="#how-it-works">How it works</a>
      <ul>
        <li><a href="#read-path-evolution">Read path evolution</a></li>
      </ul>
    </li>
    <li><a href="#performance-benefits">Performance benefits</a></li>
    <li><a href="#memory-usage">Memory usage</a></li>
    <li><a href="#interaction-with-time-travel">Interaction with time travel</a></li>
    <li><a href="#examples">Examples</a>
      <ul>
        <li><a href="#python">Python</a></li>
        <li><a href="#go">Go</a></li>
      </ul>
    </li>
    <li><a href="#monitoring-hydration-progress">Monitoring hydration progress</a></li>
    <li><a href="#combining-with-write-mode">Combining with write mode</a></li>
    <li><a href="#limitations--constraints">Limitations &amp; constraints</a></li>
    <li><a href="#troubleshooting">Troubleshooting</a></li>
    <li><a href="#see-also">See Also</a></li>
  </ul>
</nav>
  </div>

		</nav>
		<main class="docs-content col-lg-11 col-xl-9 mx-xl-auto">
		<h1>VFS Hydration</h1>
			<p class="lead"></p>
			<p>VFS hydration restores the entire database to a local file in the background
while the VFS continues serving reads from the cache and remote storage. Once
hydration completes, all reads are served from the local file, eliminating
remote fetch latency entirely.</p>
<h2 id="when-to-use-hydration">When to use hydration<a href="#when-to-use-hydration" class="anchor" aria-hidden="true">#</a> </h2>
<ul>
<li>Read-heavy workloads where remote latency impacts performance.</li>
<li>Large databases where the cache cannot hold the full working set.</li>
<li>Latency-sensitive applications that need local-disk performance after startup.</li>
<li>Long-running processes that benefit from full local access after initial warm-up.</li>
</ul>
<p>Hydration is ideal when you want the quick startup of VFS (no upfront restore)
combined with the performance of a local database once the background restore
completes.</p>
<h2 id="when-not-to-use-hydration">When NOT to use hydration<a href="#when-not-to-use-hydration" class="anchor" aria-hidden="true">#</a> </h2>
<ul>
<li>Small databases that fit entirely in the VFS cache (hydration adds no benefit).</li>
<li>Limited local disk space (hydration requires space for the full database).</li>
<li>Short-lived processes that terminate before hydration completes.</li>
<li>Time travel queries (hydration is temporarily paused during time travel).</li>
</ul>
<p>For small databases or disk-constrained environments, the default VFS caching
is usually sufficient.</p>
<h2 id="prerequisites">Prerequisites<a href="#prerequisites" class="anchor" aria-hidden="true">#</a> </h2>
<ul>
<li>VFS extension built (same as standard VFS usage).</li>
<li>A configured replica URL pointing to object storage.</li>
<li>Sufficient local disk space for the fully restored database.</li>
<li>Stable network connection during hydration.</li>
</ul>
<h2 id="configuration">Configuration<a href="#configuration" class="anchor" aria-hidden="true">#</a> </h2>
<p>Enable hydration with environment variables:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Enable hydration</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LITESTREAM_HYDRATION_ENABLED</span><span class="o">=</span><span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Set replica URL (required)</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LITESTREAM_REPLICA_URL</span><span class="o">=</span><span class="s2">&#34;s3://mybucket/mydb&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Hydration file path (default: temp file)</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LITESTREAM_HYDRATION_PATH</span><span class="o">=</span>/var/lib/litestream/hydrated.db
</span></span></code></pre></div><h3 id="configuration-options">Configuration options<a href="#configuration-options" class="anchor" aria-hidden="true">#</a> </h3>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>LITESTREAM_HYDRATION_ENABLED</code></td>
<td>boolean</td>
<td><code>false</code></td>
<td>Enable background hydration</td>
</tr>
<tr>
<td><code>LITESTREAM_HYDRATION_PATH</code></td>
<td>string</td>
<td>temp file</td>
<td>Local file path for hydrated database</td>
</tr>
</tbody>
</table>
<p>If <code>LITESTREAM_HYDRATION_PATH</code> is not set, hydration uses a temporary file that
is cleaned up when the VFS closes. Set an explicit path to persist the hydrated
database across restarts.</p>
<h2 id="how-it-works">How it works<a href="#how-it-works" class="anchor" aria-hidden="true">#</a> </h2>
<p>Hydration runs as a non-blocking background process while the VFS remains fully
operational:</p>
<ol>
<li>
<p><strong>Streaming compaction</strong>: The VFS reads LTX files and applies them to build
a complete SQLite database file locally.</p>
</li>
<li>
<p><strong>Non-blocking reads</strong>: During hydration, reads are served from the VFS cache
or fetched from remote storage as usual. Applications experience no interruption.</p>
</li>
<li>
<p><strong>Incremental updates</strong>: As new LTX files arrive from the primary, they are
applied to the hydrated file to keep it current.</p>
</li>
<li>
<p><strong>Read path transition</strong>: Once hydration completes, the VFS switches to
serving reads directly from the local file instead of remote storage.</p>
</li>
<li>
<p><strong>Continuous sync</strong>: After initial hydration, the VFS continues applying new
LTX files to the local file, keeping it synchronized with the replica.</p>
</li>
</ol>
<h3 id="read-path-evolution">Read path evolution<a href="#read-path-evolution" class="anchor" aria-hidden="true">#</a> </h3>
<table>
<thead>
<tr>
<th>Phase</th>
<th>Read Source</th>
<th>Latency</th>
</tr>
</thead>
<tbody>
<tr>
<td>Pre-hydration</td>
<td>Remote storage + cache</td>
<td>Network latency (5-50ms+ per page miss)</td>
</tr>
<tr>
<td>During hydration</td>
<td>Remote storage + cache</td>
<td>Network latency (unchanged)</td>
</tr>
<tr>
<td>Post-hydration</td>
<td>Local file</td>
<td>Local disk latency (&lt;1ms)</td>
</tr>
</tbody>
</table>
<p>The transition happens automatically and is transparent to the application.</p>
<h2 id="performance-benefits">Performance benefits<a href="#performance-benefits" class="anchor" aria-hidden="true">#</a> </h2>
<p>Hydration significantly improves read latency once complete:</p>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Without Hydration</th>
<th>With Hydration</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cache hit</td>
<td>&lt;1ms</td>
<td>&lt;1ms</td>
</tr>
<tr>
<td>Cache miss (indexed lookup)</td>
<td>5-50ms</td>
<td>&lt;1ms</td>
</tr>
<tr>
<td>Sequential scan (100MB)</td>
<td>500ms-5s</td>
<td>&lt;100ms</td>
</tr>
<tr>
<td>Cold start, random reads</td>
<td>High latency</td>
<td>High initially, then &lt;1ms</td>
</tr>
</tbody>
</table>
<p>The benefit is most noticeable for:</p>
<ul>
<li>Sequential scans and large aggregations (no longer fetch each page remotely).</li>
<li>Random access patterns that exceed cache size.</li>
<li>Any workload after hydration completes.</li>
</ul>
<h2 id="memory-usage">Memory usage<a href="#memory-usage" class="anchor" aria-hidden="true">#</a> </h2>
<p>Hydration uses streaming compaction with bounded memory:</p>
<ul>
<li>LTX files are processed incrementally; the entire database is never loaded into memory.</li>
<li>Memory usage is proportional to the compaction buffer, not the database size.</li>
<li>The local hydration file is written directly to disk via streaming I/O.</li>
</ul>
<p>A 10GB database can be hydrated with minimal additional memory beyond the
standard VFS cache.</p>
<h2 id="interaction-with-time-travel">Interaction with time travel<a href="#interaction-with-time-travel" class="anchor" aria-hidden="true">#</a> </h2>
<p>Hydration and time travel have specific interactions:</p>
<ul>
<li>
<p><strong>During time travel</strong>: Hydration is paused. The VFS serves historical data
directly from LTX files in remote storage.</p>
</li>
<li>
<p><strong>After time travel ends</strong>: Hydration resumes from where it left off when you
return to <code>latest</code>.</p>
</li>
<li>
<p><strong>Hydration progress</strong>: Time travel does not reset hydration progress. The
local file remains valid for the current state.</p>
</li>
</ul>
<p>If your workload uses frequent time travel queries, hydration may provide
limited benefit since those queries always read from remote LTX files.</p>
<h2 id="examples">Examples<a href="#examples" class="anchor" aria-hidden="true">#</a> </h2>
<h3 id="python">Python<a href="#python" class="anchor" aria-hidden="true">#</a> </h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LITESTREAM_HYDRATION_ENABLED</span><span class="o">=</span><span class="nb">true</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LITESTREAM_REPLICA_URL</span><span class="o">=</span><span class="s2">&#34;s3://mybucket/analytics.db&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LITESTREAM_HYDRATION_PATH</span><span class="o">=</span>/tmp/analytics-hydrated.db
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>AKIAxxxx
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>xxxx
</span></span><span class="line"><span class="cl">python analytics.py
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sqlite3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Load VFS extension</span>
</span></span><span class="line"><span class="cl"><span class="n">loader</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&#34;:memory:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">loader</span><span class="o">.</span><span class="n">enable_load_extension</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">loader</span><span class="o">.</span><span class="n">load_extension</span><span class="p">(</span><span class="s2">&#34;./dist/litestream-vfs.so&#34;</span><span class="p">,</span> <span class="n">entrypoint</span><span class="o">=</span><span class="s2">&#34;sqlite3_litestreamvfs_init&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">loader</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Connect - hydration starts automatically in the background</span>
</span></span><span class="line"><span class="cl"><span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&#34;file:analytics.db?vfs=litestream&#34;</span><span class="p">,</span> <span class="n">uri</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Reads work immediately (from cache/remote during hydration)</span>
</span></span><span class="line"><span class="cl"><span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;SELECT COUNT(*) FROM events&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Total events: </span><span class="si">{</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># After hydration completes, this scan is served from local disk</span>
</span></span><span class="line"><span class="cl"><span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;SELECT date(ts), COUNT(*) FROM events GROUP BY 1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> events&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="go">Go<a href="#go" class="anchor" aria-hidden="true">#</a> </h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;context&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;database/sql&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;log&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;os&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">_</span> <span class="s">&#34;github.com/mattn/go-sqlite3&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;github.com/psanford/sqlite3vfs&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s">&#34;github.com/benbjohnson/litestream&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;github.com/benbjohnson/litestream/s3&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">client</span> <span class="o">:=</span> <span class="nx">s3</span><span class="p">.</span><span class="nf">NewReplicaClient</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nx">client</span><span class="p">.</span><span class="nx">AccessKeyID</span> <span class="p">=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Getenv</span><span class="p">(</span><span class="s">&#34;AWS_ACCESS_KEY_ID&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">client</span><span class="p">.</span><span class="nx">SecretAccessKey</span> <span class="p">=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Getenv</span><span class="p">(</span><span class="s">&#34;AWS_SECRET_ACCESS_KEY&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">client</span><span class="p">.</span><span class="nx">Region</span> <span class="p">=</span> <span class="s">&#34;us-east-1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">client</span><span class="p">.</span><span class="nx">Bucket</span> <span class="p">=</span> <span class="s">&#34;mybucket&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">client</span><span class="p">.</span><span class="nx">Path</span> <span class="p">=</span> <span class="s">&#34;analytics.db&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">Init</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">());</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">vfs</span> <span class="o">:=</span> <span class="nx">litestream</span><span class="p">.</span><span class="nf">NewVFS</span><span class="p">(</span><span class="nx">client</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">vfs</span><span class="p">.</span><span class="nx">HydrationEnabled</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">    <span class="nx">vfs</span><span class="p">.</span><span class="nx">HydrationPath</span> <span class="p">=</span> <span class="s">&#34;/tmp/analytics-hydrated.db&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">sqlite3vfs</span><span class="p">.</span><span class="nf">RegisterVFS</span><span class="p">(</span><span class="s">&#34;litestream&#34;</span><span class="p">,</span> <span class="nx">vfs</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">db</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">sql</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="s">&#34;sqlite3&#34;</span><span class="p">,</span> <span class="s">&#34;file:analytics.db?vfs=litestream&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">defer</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Query immediately - uses cache/remote during hydration
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">var</span> <span class="nx">count</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">    <span class="nx">db</span><span class="p">.</span><span class="nf">QueryRow</span><span class="p">(</span><span class="s">&#34;SELECT COUNT(*) FROM events&#34;</span><span class="p">).</span><span class="nf">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Total events: %d&#34;</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// After hydration, large scans are fast
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">rows</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="s">`
</span></span></span><span class="line"><span class="cl"><span class="s">        SELECT date(ts), COUNT(*)
</span></span></span><span class="line"><span class="cl"><span class="s">        FROM events
</span></span></span><span class="line"><span class="cl"><span class="s">        GROUP BY 1
</span></span></span><span class="line"><span class="cl"><span class="s">        ORDER BY 1 DESC
</span></span></span><span class="line"><span class="cl"><span class="s">        LIMIT 30
</span></span></span><span class="line"><span class="cl"><span class="s">    `</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">defer</span> <span class="nx">rows</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">rows</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">date</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">eventCount</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">        <span class="nx">rows</span><span class="p">.</span><span class="nf">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">date</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">eventCount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%s: %d events&#34;</span><span class="p">,</span> <span class="nx">date</span><span class="p">,</span> <span class="nx">eventCount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="monitoring-hydration-progress">Monitoring hydration progress<a href="#monitoring-hydration-progress" class="anchor" aria-hidden="true">#</a> </h2>
<p>If implemented in your Litestream build, these SQL functions can monitor
hydration status:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Get hydration progress as percentage (0-100)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">litestream_hydration_progress</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Returns: 75
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Get hydration status
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">litestream_hydration_status</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Returns: idle | restoring | catching_up | complete
</span></span></span></code></pre></div><table>
<thead>
<tr>
<th>Status</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>idle</code></td>
<td>Hydration not enabled or not started</td>
</tr>
<tr>
<td><code>restoring</code></td>
<td>Initial database restoration in progress</td>
</tr>
<tr>
<td><code>catching_up</code></td>
<td>Applying recent LTX files after initial restore</td>
</tr>
<tr>
<td><code>complete</code></td>
<td>Hydration finished, all reads served locally</td>
</tr>
</tbody>
</table>
<p>Check if your build includes these functions by attempting to call them. If not
available, monitor the hydration file size as a rough progress indicator.</p>
<h2 id="combining-with-write-mode">Combining with write mode<a href="#combining-with-write-mode" class="anchor" aria-hidden="true">#</a> </h2>
<p>Hydration can be used together with write mode. When both are enabled:</p>
<ul>
<li>The hydrated local file receives both remote updates and local writes.</li>
<li>Write buffer syncs happen independently of hydration.</li>
<li>Local writes are immediately visible in the hydrated file.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LITESTREAM_WRITE_ENABLED</span><span class="o">=</span><span class="nb">true</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LITESTREAM_HYDRATION_ENABLED</span><span class="o">=</span><span class="nb">true</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LITESTREAM_REPLICA_URL</span><span class="o">=</span><span class="s2">&#34;s3://mybucket/app.db&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LITESTREAM_BUFFER_PATH</span><span class="o">=</span>/data/buffer.db
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LITESTREAM_HYDRATION_PATH</span><span class="o">=</span>/data/hydrated.db
</span></span></code></pre></div><p>This combination provides:</p>
<ul>
<li>Quick startup (no full restore required).</li>
<li>Local disk performance once hydrated.</li>
<li>Write capability with remote persistence.</li>
</ul>
<h2 id="limitations--constraints">Limitations &amp; constraints<a href="#limitations--constraints" class="anchor" aria-hidden="true">#</a> </h2>
<ul>
<li><strong>Disk space</strong>: Requires space for the full database locally.</li>
<li><strong>Hydration time</strong>: Large databases take time to hydrate (network-bound).</li>
<li><strong>Time travel</strong>: Pauses hydration and reads from remote during time travel.</li>
<li><strong>No partial hydration</strong>: The entire database is hydrated; cannot hydrate specific tables.</li>
</ul>
<h2 id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="anchor" aria-hidden="true">#</a> </h2>
<ul>
<li><strong>Slow hydration</strong>: Check network bandwidth to replica storage. Consider running in the same region.</li>
<li><strong>Disk full errors</strong>: Ensure sufficient space for the hydration file (database size + overhead).</li>
<li><strong>Hydration not starting</strong>: Verify <code>LITESTREAM_HYDRATION_ENABLED=true</code> is set before VFS initialization.</li>
<li><strong>Stale data after restart</strong>: If using a temp file path, hydration restarts from scratch. Use a persistent path.</li>
</ul>
<h2 id="see-also">See Also<a href="#see-also" class="anchor" aria-hidden="true">#</a> </h2>
<ul>
<li><a href="/guides/vfs">VFS Read Replicas Guide</a> - Standard VFS usage</li>
<li><a href="/guides/vfs-write-mode">VFS Write Mode Guide</a> - Write mode configuration</li>
<li><a href="/reference/vfs">VFS Extension Reference</a> - Complete configuration reference</li>
<li><a href="/how-it-works/vfs">How it works: VFS</a> - Architecture details</li>
</ul>

			<div class="docs-navigation d-flex justify-content-between">
	
	<a href="https://litestream.io/guides/go-library/">
			<div class="card my-1">
				<div class="card-body py-2">
					&larr; Using Litestream as a Go Library
				</div>
			</div>
		</a>
	<a class="ml-auto" href="https://litestream.io/guides/s3-compatible/">
			<div class="card my-1">
				<div class="card-body py-2">
					Replicating to S3-Compatible Services &rarr;
				</div>
			</div>
		</a>
	</div>

		</main>
	</div>

      </div>
    </div>
    
    
    <footer>
</footer>
    
    <script src="https://litestream.io/main.f4006b8dd3163d19fa41adf9892089fe185101b404b96884ed2a22ec4e9cb0706759ecdb3f4520a1d37fc5ad7a90a8d90abfb30055a1ff67aefb5b2324355d12.js" integrity="sha512-9ABrjdMWPRn6Qa35iSCJ/hhRAbQEuWiE7Soi7E6csHBnWezbP0UgodN/xa16kKjZCr&#43;zAFWh/2eu&#43;1sjJDVdEg==" crossorigin="anonymous" defer></script>
  <script src="https://litestream.io/index.min.acaed2ab359be4203284b87bf3718ce80bc318f46c826036fd3782dac995f1c9e42145db5e934626b43b552dc6296d580a4e49a3392dbd78784d8a78a6252f93.js" integrity="sha512-rK7SqzWb5CAyhLh783GM6AvDGPRsgmA2/TeC2smV8cnkIUXbXpNGJrQ7VS3GKW1YCk5JozktvXh4TYp4piUvkw==" crossorigin="anonymous" defer></script>

  </body>
</html>