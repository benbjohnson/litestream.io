<!doctype html>
<html lang="en-US">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <link rel="stylesheet" href="/main.211f27ab66d952d637fa741b575d7cfdf53f25b5ea7d6f38193f667a756f6b85f1e0e59a36a863834fb2e4ef66f1928cff1358b23bb8a5956101d4994514962f.css" integrity="sha512-IR8nq2bZUtY3&#43;nQbV118/fU/JbXqfW84GT9menVva4Xx4OWaNqhjg0&#43;y5O9m8ZKM/xNYsju4pZVhAdSZRRSWLw==" crossorigin="anonymous">
<noscript><style>img.lazyload { display: none; }</style></noscript>

<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;1,400;1,600&display=swap" rel="stylesheet">

  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <title>S3 Advanced Configuration - Litestream</title>
<meta name="description" content="Litestream replicates SQLite databases in real-time to S3.">
<link rel="canonical" href="https://litestream.io/guides/s3-advanced/">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://litestream.io/images/twitter-image.png">
<meta name="twitter:title" content="S3 Advanced Configuration">
<meta name="twitter:description" content="This guide covers advanced S3 configuration options for tuning multipart upload performance. These settings control how Litestream uploads data to S3 and S3-compatible storage services.
v0.5.0 Part size and concurrency configuration options were added in Litestream v0.5.0.
Overview When Litestream uploads files to S3, it uses multipart uploads for efficient data transfer. Two key settings control this behavior:
Part Size: The size of each chunk uploaded to S3 Concurrency: The number of parts uploaded simultaneously Understanding these settings helps you optimize performance for your specific network conditions, storage provider, and resource constraints.">
<meta name="twitter:site" content="@litestreamio">
<meta name="twitter:creator" content="@benbjohnson">

<meta name="twitter:site" content="@litestreamio">
<meta name="twitter:creator" content="@benbjohnson">

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position":  1 ,
        "name": "Home",
        "item": "https:\/\/litestream.io\/"
    },{
        "@type": "ListItem",
        "position":  2 ,
        "name": "Guides",
        "item": "https:\/\/litestream.io\/guides\/"
    },{
        "@type": "ListItem",
        "position":  3 ,
        "name": "S3 Advanced",
        "item": "https:\/\/litestream.io\/guides\/s3-advanced\/"
    }]
}
</script>

  <meta name="theme-color" content="#fff">
<link rel="apple-touch-icon" sizes="180x180" href="https://litestream.io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://litestream.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://litestream.io/favicon-16x16.png">
<link rel="manifest" href="https://litestream.io/site.webmanifest">
  
</head>
  <body class="guides single">
    <header class="navbar fixed-top navbar-expand-md navbar-light">
  <div class="container align-items-baseline">
    <input class="menu-btn order-0" type="checkbox" id="menu-btn">

    <label class="menu-icon d-md-none" for="menu-btn"><span class="navicon"></span></label>

    <a class="navbar-brand order-1 order-md-0 mr-auto" href="https://litestream.io/">
      <img class="d-md-inline d-none" src="/images/logo.svg" />
      <span class="d-sm-inline d-md-none">Litestream</span>
    </a>

    <ul class="navbar-nav social-nav order-3 order-md-5">
      <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/litestreamio"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg><span class="ml-2 sr-only">Twitter</span></a>
        </li>
      <li class="nav-item">
          <a class="nav-link" href="https://github.com/benbjohnson/litestream"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="ml-2 sr-only">GitHub</span></a>
        </li>
      </ul>

    <div class="collapse navbar-collapse order-4 order-md-1">
      <ul class="navbar-nav main-nav mr-auto order-5 order-md-2"><li class="nav-item">
            <a class="nav-link" href="https://litestream.io/install">Install</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://litestream.io/guides">Guides</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://litestream.io/reference">Reference</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://github.com/benbjohnson/litestream">GitHub</a>
          </li>
        </ul>
      <div class="break order-6 d-md-none"></div>
    </div>
  </div>
</header>
    <div class="version-banner alert alert-warning text-center mb-0" role="alert" style="border-radius: 0;">
  <div class="container">
    <strong>v0.5.x</strong> - Latest - Actively maintained with new features and bug fixes| <a href="/v0.3/" class="alert-link">View v0.3.13 (Previous)</a></div>
</div>
    <div class="wrap container" role="document">
      <div class="content">
        
	<div class="row flex-xl-nowrap">
		<div class="col-lg-5 col-xl-4 docs-sidebar">
			<nav class="docs-links" aria-label="Main navigation">
				<h3>
    <a href="https://litestream.io/install">Install</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/install/mac/">macOS</a></li>
    <li><a class="docs-link" href="https://litestream.io/install/linux/">Linux</a></li>
    <li><a class="docs-link" href="https://litestream.io/install/source/">Build from Source</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/">General</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/getting-started/">Getting Started</a></li>
    <li><a class="docs-link" href="https://litestream.io/tips/">Tips &amp; Caveats</a></li>
    <li><a class="docs-link" href="https://litestream.io/how-it-works/">How it works</a></li>
    <li><a class="docs-link" href="https://litestream.io/how-it-works/vfs/">Read Replicas with VFS</a></li>
    <li><a class="docs-link" href="https://litestream.io/alternatives/">Alternatives</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/guides/">Infrastructure Guides</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/guides/docker/">Running in a Docker container</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/kubernetes/">Running in a Kubernetes cluster</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/systemd/">Running as a Systemd service</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/windows/">Running as a Windows Service</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/directory-watcher/">Directory Watcher</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/guides/">Replica Guides</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/guides/global-defaults/">Global Replica Defaults</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/s3/">Replicating to Amazon S3</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/aws-sdk-v2/">AWS SDK v2 Migration</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/alibaba-oss/">Replicating to Alibaba Cloud OSS</a></li>
    <li><a class="docs-link active" href="https://litestream.io/guides/s3-advanced/">S3 Advanced Configuration</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/vfs/">VFS Read Replicas</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/go-library/">Using Litestream as a Go Library</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/vfs-write-mode/">VFS Write Mode</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/vfs-hydration/">VFS Hydration</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/azure/">Replicating to Azure Blob Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/s3-compatible/">Replicating to S3-Compatible Services</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/backblaze/">Replicating to Backblaze B2</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/digitalocean/">Replicating to DigitalOcean Spaces</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/scaleway/">Replicating to Scaleway Object Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/tigris/">Replicating to Tigris (Fly.io)</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/gcs/">Replicating to Google Cloud Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/linode/">Replicating to Linode Object Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/sftp/">Replicating to an SFTP Server</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/file/">Replicating to a Local File Path</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/nats/">Replicating to NATS JetStream</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/directory/">Replicating Directories</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/webdav/">Replicating to a WebDAV Server</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/docs/">Help</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/docs/migration/">Migration Guide</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/wal-truncate-threshold/">WAL Truncate Threshold Configuration</a></li>
    <li><a class="docs-link" href="https://litestream.io/docs/troubleshooting/">Troubleshooting</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/reference/">Reference</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/reference/config/">Configuration File</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/vfs/">VFS Extension</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/metrics/">Prometheus Metrics</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/databases/">Command: databases</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/mcp/">Command: mcp</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/replicate/">Command: replicate</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/ltx/">Command: ltx</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/restore/">Command: restore</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/reset/">Command: reset</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/ipc/">IPC Endpoints</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/version/">Command: version</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/wal/">Command: wal</a></li>
    </ul>
  
			</nav>        
		</div>
		<nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation">
			<div class="page-links">
    <h3>On this page</h3>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#configuration-options">Configuration Options</a>
      <ul>
        <li><a href="#part-size">Part Size</a></li>
        <li><a href="#concurrency">Concurrency</a></li>
      </ul>
    </li>
    <li><a href="#provider-requirements">Provider Requirements</a>
      <ul>
        <li><a href="#aws-s3">AWS S3</a></li>
        <li><a href="#backblaze-b2">Backblaze B2</a></li>
        <li><a href="#minio">MinIO</a></li>
        <li><a href="#other-s3-compatible-services">Other S3-Compatible Services</a></li>
      </ul>
    </li>
    <li><a href="#performance-tuning">Performance Tuning</a>
      <ul>
        <li><a href="#when-to-increase-part-size">When to Increase Part Size</a></li>
        <li><a href="#when-to-decrease-part-size">When to Decrease Part Size</a></li>
        <li><a href="#when-to-increase-concurrency">When to Increase Concurrency</a></li>
        <li><a href="#when-to-decrease-concurrency">When to Decrease Concurrency</a></li>
      </ul>
    </li>
    <li><a href="#configuration-examples">Configuration Examples</a>
      <ul>
        <li><a href="#high-performance-configuration">High-Performance Configuration</a></li>
        <li><a href="#resource-constrained-configuration">Resource-Constrained Configuration</a></li>
        <li><a href="#backblaze-b2-optimized">Backblaze B2 Optimized</a></li>
      </ul>
    </li>
    <li><a href="#cost-considerations">Cost Considerations</a></li>
    <li><a href="#troubleshooting">Troubleshooting</a>
      <ul>
        <li><a href="#upload-failures-with-small-part-size">Upload Failures with Small Part Size</a></li>
        <li><a href="#memory-issues">Memory Issues</a></li>
        <li><a href="#slow-uploads">Slow Uploads</a></li>
        <li><a href="#provider-specific-errors">Provider-Specific Errors</a></li>
      </ul>
    </li>
    <li><a href="#distributed-leasing">Distributed Leasing</a>
      <ul>
        <li><a href="#how-it-works">How It Works</a></li>
        <li><a href="#lock-file-format">Lock File Format</a></li>
        <li><a href="#failover-behavior">Failover Behavior</a></li>
        <li><a href="#requirements">Requirements</a></li>
      </ul>
    </li>
    <li><a href="#see-also">See Also</a></li>
  </ul>
</nav>
  </div>

		</nav>
		<main class="docs-content col-lg-11 col-xl-9 mx-xl-auto">
		<h1>S3 Advanced Configuration</h1>
			<p class="lead"></p>
			<p>This guide covers advanced S3 configuration options for tuning multipart upload
performance. These settings control how Litestream uploads data to S3 and
S3-compatible storage services.</p>
<p><span class="badge badge-info litestream-version" title="This feature has been available since Litestream v0.5.0">
    v0.5.0
</span>
 Part size and concurrency configuration options
were added in Litestream v0.5.0.</p>
<h2 id="overview">Overview<a href="#overview" class="anchor" aria-hidden="true">#</a> </h2>
<p>When Litestream uploads files to S3, it uses multipart uploads for efficient
data transfer. Two key settings control this behavior:</p>
<ul>
<li><strong>Part Size</strong>: The size of each chunk uploaded to S3</li>
<li><strong>Concurrency</strong>: The number of parts uploaded simultaneously</li>
</ul>
<p>Understanding these settings helps you optimize performance for your specific
network conditions, storage provider, and resource constraints.</p>
<h2 id="configuration-options">Configuration Options<a href="#configuration-options" class="anchor" aria-hidden="true">#</a> </h2>
<h3 id="part-size">Part Size<a href="#part-size" class="anchor" aria-hidden="true">#</a> </h3>
<p>The <code>part-size</code> field controls the size of each part in multipart uploads.
Litestream accepts human-readable size strings.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">s3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">bucket</span><span class="p">:</span><span class="w"> </span><span class="l">mybucket</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">part-size</span><span class="p">:</span><span class="w"> </span><span class="l">10MB</span><span class="w">
</span></span></span></code></pre></div><p><strong>Supported formats:</strong></p>
<ul>
<li>Bytes: <code>5242880</code> (numeric value in bytes)</li>
<li>Kilobytes: <code>5120KB</code> or <code>5120K</code></li>
<li>Megabytes: <code>5MB</code> or <code>5M</code></li>
<li>Gigabytes: <code>1GB</code> or <code>1G</code></li>
<li>Decimal values: <code>1.5MB</code></li>
</ul>
<p><strong>Defaults and limits:</strong></p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Default</td>
<td>5 MiB (AWS SDK default)</td>
</tr>
<tr>
<td>Minimum</td>
<td>5 MiB (S3 requirement)</td>
</tr>
<tr>
<td>Maximum</td>
<td>5 GiB</td>
</tr>
</tbody>
</table>
<p>The final part of an upload may be smaller than the minimum size.</p>
<h3 id="concurrency">Concurrency<a href="#concurrency" class="anchor" aria-hidden="true">#</a> </h3>
<p>The <code>concurrency</code> field controls how many parts are uploaded in parallel.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">s3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">bucket</span><span class="p">:</span><span class="w"> </span><span class="l">mybucket</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">concurrency</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span></code></pre></div><p><strong>Defaults:</strong></p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Default</td>
<td>5 concurrent uploads</td>
</tr>
</tbody>
</table>
<h2 id="provider-requirements">Provider Requirements<a href="#provider-requirements" class="anchor" aria-hidden="true">#</a> </h2>
<p>Different S3-compatible providers have specific requirements for multipart
uploads.</p>
<h3 id="aws-s3">AWS S3<a href="#aws-s3" class="anchor" aria-hidden="true">#</a> </h3>
<p>AWS S3 uses the standard multipart upload limits:</p>
<ul>
<li>Minimum part size: 5 MiB</li>
<li>Maximum part size: 5 GiB</li>
<li>Maximum parts per upload: 10,000</li>
</ul>
<p>The default settings work well for most AWS S3 use cases.</p>
<h3 id="backblaze-b2">Backblaze B2<a href="#backblaze-b2" class="anchor" aria-hidden="true">#</a> </h3>
<p>Backblaze B2&rsquo;s S3-compatible API requires a <strong>minimum part size of 5 MB</strong>.
The defaults work correctly, but if you customize the part size, ensure it
meets this minimum.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">s3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">bucket</span><span class="p">:</span><span class="w"> </span><span class="l">mybucket</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l">s3.us-west-000.backblazeb2.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">force-path-style</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">part-size</span><span class="p">:</span><span class="w"> </span><span class="l">10MB </span><span class="w"> </span><span class="c"># Must be &gt;= 5MB for B2</span><span class="w">
</span></span></span></code></pre></div><p>Backblaze recommends 100 MB part sizes for optimal performance with large files.</p>
<h3 id="minio">MinIO<a href="#minio" class="anchor" aria-hidden="true">#</a> </h3>
<p>MinIO follows standard S3 multipart upload limits. The default settings work
without modification.</p>
<h3 id="other-s3-compatible-services">Other S3-Compatible Services<a href="#other-s3-compatible-services" class="anchor" aria-hidden="true">#</a> </h3>
<p>Check your provider&rsquo;s documentation for specific multipart upload requirements.
Most services follow the standard S3 limits (5 MiB minimum part size).</p>
<h2 id="performance-tuning">Performance Tuning<a href="#performance-tuning" class="anchor" aria-hidden="true">#</a> </h2>
<h3 id="when-to-increase-part-size">When to Increase Part Size<a href="#when-to-increase-part-size" class="anchor" aria-hidden="true">#</a> </h3>
<p>Larger part sizes may improve performance when:</p>
<ul>
<li>You have high bandwidth and low latency connections</li>
<li>You&rsquo;re uploading large database snapshots</li>
<li>You want to reduce the total number of API requests (cost savings)</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">part-size</span><span class="p">:</span><span class="w"> </span><span class="l">50MB</span><span class="w">
</span></span></span></code></pre></div><h3 id="when-to-decrease-part-size">When to Decrease Part Size<a href="#when-to-decrease-part-size" class="anchor" aria-hidden="true">#</a> </h3>
<p>Smaller part sizes may be beneficial when:</p>
<ul>
<li>You have unreliable network connections (smaller retries on failure)</li>
<li>Memory is constrained</li>
<li>You want faster feedback on upload progress</li>
</ul>
<p>Note: You cannot go below 5 MiB due to S3&rsquo;s minimum requirement.</p>
<h3 id="when-to-increase-concurrency">When to Increase Concurrency<a href="#when-to-increase-concurrency" class="anchor" aria-hidden="true">#</a> </h3>
<p>Higher concurrency improves throughput when:</p>
<ul>
<li>You have high bandwidth connections</li>
<li>Network latency is high (parallel uploads hide latency)</li>
<li>You&rsquo;re not CPU or memory constrained</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">concurrency</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span></code></pre></div><h3 id="when-to-decrease-concurrency">When to Decrease Concurrency<a href="#when-to-decrease-concurrency" class="anchor" aria-hidden="true">#</a> </h3>
<p>Lower concurrency may be appropriate when:</p>
<ul>
<li>Memory is limited (each concurrent part uses memory)</li>
<li>CPU resources are constrained</li>
<li>You want to limit network bandwidth usage</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">concurrency</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span></code></pre></div><h2 id="configuration-examples">Configuration Examples<a href="#configuration-examples" class="anchor" aria-hidden="true">#</a> </h2>
<h3 id="high-performance-configuration">High-Performance Configuration<a href="#high-performance-configuration" class="anchor" aria-hidden="true">#</a> </h3>
<p>For servers with fast network connections and ample resources:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">s3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">bucket</span><span class="p">:</span><span class="w"> </span><span class="l">mybucket</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">part-size</span><span class="p">:</span><span class="w"> </span><span class="l">50MB</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">concurrency</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span></code></pre></div><h3 id="resource-constrained-configuration">Resource-Constrained Configuration<a href="#resource-constrained-configuration" class="anchor" aria-hidden="true">#</a> </h3>
<p>For embedded devices or containers with limited memory:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">s3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">bucket</span><span class="p">:</span><span class="w"> </span><span class="l">mybucket</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">part-size</span><span class="p">:</span><span class="w"> </span><span class="l">5MB</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">concurrency</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span></code></pre></div><h3 id="backblaze-b2-optimized">Backblaze B2 Optimized<a href="#backblaze-b2-optimized" class="anchor" aria-hidden="true">#</a> </h3>
<p>Following Backblaze&rsquo;s recommendations for optimal performance:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">s3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">bucket</span><span class="p">:</span><span class="w"> </span><span class="l">mybucket</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l">s3.us-west-000.backblazeb2.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">force-path-style</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">part-size</span><span class="p">:</span><span class="w"> </span><span class="l">100MB</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">concurrency</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span></code></pre></div><h2 id="cost-considerations">Cost Considerations<a href="#cost-considerations" class="anchor" aria-hidden="true">#</a> </h2>
<p>Part size affects the number of API requests made to your storage provider:</p>
<ul>
<li><strong>Larger parts</strong> = fewer PUT requests = lower request costs</li>
<li><strong>Smaller parts</strong> = more PUT requests = higher request costs</li>
</ul>
<p>For high-volume databases with frequent syncs, consider larger part sizes to
reduce the total number of API calls.</p>
<h2 id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="anchor" aria-hidden="true">#</a> </h2>
<h3 id="upload-failures-with-small-part-size">Upload Failures with Small Part Size<a href="#upload-failures-with-small-part-size" class="anchor" aria-hidden="true">#</a> </h3>
<p>If you see errors about part size being too small, ensure your <code>part-size</code>
is at least 5 MiB:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">part-size</span><span class="p">:</span><span class="w"> </span><span class="l">5MB </span><span class="w"> </span><span class="c"># Minimum allowed</span><span class="w">
</span></span></span></code></pre></div><h3 id="memory-issues">Memory Issues<a href="#memory-issues" class="anchor" aria-hidden="true">#</a> </h3>
<p>If Litestream uses too much memory during uploads, reduce concurrency:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">concurrency</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span></code></pre></div><p>Each concurrent upload buffers a part in memory before sending.</p>
<h3 id="slow-uploads">Slow Uploads<a href="#slow-uploads" class="anchor" aria-hidden="true">#</a> </h3>
<p>For slow uploads, try:</p>
<ol>
<li>
<p>Increasing concurrency to better utilize bandwidth:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">concurrency</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p>Adjusting part size based on your network conditions</p>
</li>
</ol>
<h3 id="provider-specific-errors">Provider-Specific Errors<a href="#provider-specific-errors" class="anchor" aria-hidden="true">#</a> </h3>
<p>If you receive errors from your storage provider about invalid part sizes,
verify you meet their minimum requirements. Backblaze B2 and some other
providers have a strict 5 MB minimum.</p>
<h2 id="distributed-leasing">Distributed Leasing<a href="#distributed-leasing" class="anchor" aria-hidden="true">#</a> </h2>
<p><span class="badge badge-info litestream-version" title="This feature has been available since Litestream v0.5.8">
    v0.5.8
</span>
 Litestream supports distributed leasing for safe
multi-instance deployments using S3 conditional writes. This ensures only one
Litestream instance actively replicates a database at a time, enabling
high-availability patterns where a standby instance can take over if the
primary fails.</p>
<h3 id="how-it-works">How It Works<a href="#how-it-works" class="anchor" aria-hidden="true">#</a> </h3>
<p>Litestream uses a <code>lock.json</code> file stored alongside your replica data. The
leasing algorithm uses S3&rsquo;s <code>If-Match</code> and <code>If-None-Match</code> conditional headers
for atomic leader election:</p>
<ol>
<li><strong>Acquire</strong>: Read existing <code>lock.json</code>, check if the lease has expired, then
conditionally write a new lease using ETag matching</li>
<li><strong>Renew</strong>: The active leader periodically refreshes the lease before expiry</li>
<li><strong>Release</strong>: On graceful shutdown, the leader releases the lease</li>
</ol>
<p>If another instance attempts to acquire the lease while it is held, S3 returns
a <code>412 Precondition Failed</code> response and the instance waits.</p>
<h3 id="lock-file-format">Lock File Format<a href="#lock-file-format" class="anchor" aria-hidden="true">#</a> </h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;generation&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nt">&#34;expires_at&#34;</span><span class="p">:</span> <span class="s2">&#34;2025-02-21T15:04:33.206179Z&#34;</span><span class="p">,</span> <span class="nt">&#34;owner&#34;</span><span class="p">:</span> <span class="s2">&#34;hostname:pid&#34;</span><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><code>generation</code> — Monotonically increasing counter for lease generations</li>
<li><code>expires_at</code> — Unix timestamp when the lease expires</li>
<li><code>owner</code> — Identifier of the instance holding the lease</li>
</ul>
<h3 id="failover-behavior">Failover Behavior<a href="#failover-behavior" class="anchor" aria-hidden="true">#</a> </h3>
<p>When the active instance stops (crash, shutdown, or network partition), the
lease expires and a standby instance acquires it automatically. The failover
time depends on the lease duration.</p>
<h3 id="requirements">Requirements<a href="#requirements" class="anchor" aria-hidden="true">#</a> </h3>
<p>Distributed leasing requires an S3 provider that supports conditional writes.
AWS S3 supports this natively. Check your provider&rsquo;s documentation for
<code>If-Match</code>/<code>If-None-Match</code> header support.</p>
<p>This feature is currently available through the Go library API. See the
<a href="/guides/go-library">Go library guide</a> for programmatic usage.</p>
<h2 id="see-also">See Also<a href="#see-also" class="anchor" aria-hidden="true">#</a> </h2>
<ul>
<li><a href="/guides/s3">Replicating to Amazon S3</a> - Basic S3 setup guide</li>
<li><a href="/guides/s3-compatible">S3-Compatible Services</a> - Other S3-compatible providers</li>
<li><a href="/docs/troubleshooting">Troubleshooting</a> - Common issues and solutions</li>
<li><a href="/reference/config">Configuration Reference</a> - Complete configuration options</li>
</ul>

			<div class="docs-navigation d-flex justify-content-between">
	
	<a href="https://litestream.io/guides/alibaba-oss/">
			<div class="card my-1">
				<div class="card-body py-2">
					&larr; Replicating to Alibaba Cloud OSS
				</div>
			</div>
		</a>
	<a class="ml-auto" href="https://litestream.io/guides/vfs/">
			<div class="card my-1">
				<div class="card-body py-2">
					VFS Read Replicas &rarr;
				</div>
			</div>
		</a>
	</div>

		</main>
	</div>

      </div>
    </div>
    
    
    <footer>
</footer>
    
    <script src="https://litestream.io/main.f4006b8dd3163d19fa41adf9892089fe185101b404b96884ed2a22ec4e9cb0706759ecdb3f4520a1d37fc5ad7a90a8d90abfb30055a1ff67aefb5b2324355d12.js" integrity="sha512-9ABrjdMWPRn6Qa35iSCJ/hhRAbQEuWiE7Soi7E6csHBnWezbP0UgodN/xa16kKjZCr&#43;zAFWh/2eu&#43;1sjJDVdEg==" crossorigin="anonymous" defer></script>
  <script src="https://litestream.io/index.min.d8f5e476bb38aa6e5d46c69b2d80d720c53aa36a5ac58c007ecdba8f37901667ae80f363425b578c037743ae3f5eae089ae324630132afe826096e36bc9acce1.js" integrity="sha512-2PXkdrs4qm5dRsabLYDXIMU6o2paxYwAfs26jzeQFmeugPNjQltXjAN3Q64/Xq4ImuMkYwEyr&#43;gmCW42vJrM4Q==" crossorigin="anonymous" defer></script>

  </body>
</html>