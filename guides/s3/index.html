<!doctype html>
<html lang="en-US">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <link rel="stylesheet" href="/main.211f27ab66d952d637fa741b575d7cfdf53f25b5ea7d6f38193f667a756f6b85f1e0e59a36a863834fb2e4ef66f1928cff1358b23bb8a5956101d4994514962f.css" integrity="sha512-IR8nq2bZUtY3&#43;nQbV118/fU/JbXqfW84GT9menVva4Xx4OWaNqhjg0&#43;y5O9m8ZKM/xNYsju4pZVhAdSZRRSWLw==" crossorigin="anonymous">
<noscript><style>img.lazyload { display: none; }</style></noscript>

<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;1,400;1,600&display=swap" rel="stylesheet">

  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <title>Replicating to Amazon S3 - Litestream</title>
<meta name="description" content="Litestream replicates SQLite databases in real-time to S3.">
<link rel="canonical" href="https://litestream.io/guides/s3/">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://litestream.io/images/twitter-image.png">
<meta name="twitter:title" content="Replicating to Amazon S3">
<meta name="twitter:description" content="This guide will show you how to use Amazon S3 as a database replica path for Litestream. You will need an Amazon AWS account to complete this guide.
Setup Create an IAM user You will need to set up a user with programmatic access to work with Amazon S3. From the AWS Console, go to the IAM service. Next, click Users from the left-hand navigation and then click the Create user button.">
<meta name="twitter:site" content="@litestreamio">
<meta name="twitter:creator" content="@benbjohnson">

<meta name="twitter:site" content="@litestreamio">
<meta name="twitter:creator" content="@benbjohnson">

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position":  1 ,
        "name": "Home",
        "item": "https:\/\/litestream.io\/"
    },{
        "@type": "ListItem",
        "position":  2 ,
        "name": "Guides",
        "item": "https:\/\/litestream.io\/guides\/"
    },{
        "@type": "ListItem",
        "position":  3 ,
        "name": "S3",
        "item": "https:\/\/litestream.io\/guides\/s3\/"
    }]
}
</script>

  <meta name="theme-color" content="#fff">
<link rel="apple-touch-icon" sizes="180x180" href="https://litestream.io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://litestream.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://litestream.io/favicon-16x16.png">
<link rel="manifest" href="https://litestream.io/site.webmanifest">
  
</head>
  <body class="guides single">
    <header class="navbar fixed-top navbar-expand-md navbar-light">
  <div class="container align-items-baseline">
    <input class="menu-btn order-0" type="checkbox" id="menu-btn">

    <label class="menu-icon d-md-none" for="menu-btn"><span class="navicon"></span></label>

    <a class="navbar-brand order-1 order-md-0 mr-auto" href="https://litestream.io/">
      <img class="d-md-inline d-none" src="/images/logo.svg" />
      <span class="d-sm-inline d-md-none">Litestream</span>
    </a>

    <ul class="navbar-nav social-nav order-3 order-md-5">
      <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/litestreamio"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg><span class="ml-2 sr-only">Twitter</span></a>
        </li>
      <li class="nav-item">
          <a class="nav-link" href="https://github.com/benbjohnson/litestream"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="ml-2 sr-only">GitHub</span></a>
        </li>
      </ul>

    <div class="collapse navbar-collapse order-4 order-md-1">
      <ul class="navbar-nav main-nav mr-auto order-5 order-md-2"><li class="nav-item">
            <a class="nav-link" href="https://litestream.io/install">Install</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://litestream.io/guides">Guides</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://litestream.io/reference">Reference</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://github.com/benbjohnson/litestream">GitHub</a>
          </li>
        </ul>
      <div class="break order-6 d-md-none"></div>
    </div>
  </div>
</header>
    <div class="version-banner alert alert-warning text-center mb-0" role="alert" style="border-radius: 0;">
  <div class="container">
    <strong>v0.5.x</strong> - Latest - Actively maintained with new features and bug fixes| <a href="/v0.3/" class="alert-link">View v0.3.13 (Previous)</a></div>
</div>
    <div class="wrap container" role="document">
      <div class="content">
        
	<div class="row flex-xl-nowrap">
		<div class="col-lg-5 col-xl-4 docs-sidebar">
			<nav class="docs-links" aria-label="Main navigation">
				<h3>
    <a href="https://litestream.io/install">Install</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/install/mac/">macOS</a></li>
    <li><a class="docs-link" href="https://litestream.io/install/linux/">Linux</a></li>
    <li><a class="docs-link" href="https://litestream.io/install/source/">Build from Source</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/">General</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/getting-started/">Getting Started</a></li>
    <li><a class="docs-link" href="https://litestream.io/tips/">Tips &amp; Caveats</a></li>
    <li><a class="docs-link" href="https://litestream.io/how-it-works/">How it works</a></li>
    <li><a class="docs-link" href="https://litestream.io/how-it-works/vfs/">Read Replicas with VFS</a></li>
    <li><a class="docs-link" href="https://litestream.io/alternatives/">Alternatives</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/guides/">Infrastructure Guides</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/guides/docker/">Running in a Docker container</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/kubernetes/">Running in a Kubernetes cluster</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/systemd/">Running as a Systemd service</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/windows/">Running as a Windows Service</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/directory-watcher/">Directory Watcher</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/guides/">Replica Guides</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/guides/global-defaults/">Global Replica Defaults</a></li>
    <li><a class="docs-link active" href="https://litestream.io/guides/s3/">Replicating to Amazon S3</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/aws-sdk-v2/">AWS SDK v2 Migration</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/alibaba-oss/">Replicating to Alibaba Cloud OSS</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/s3-advanced/">S3 Advanced Configuration</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/vfs/">VFS Read Replicas</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/go-library/">Using Litestream as a Go Library</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/vfs-write-mode/">VFS Write Mode</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/vfs-hydration/">VFS Hydration</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/azure/">Replicating to Azure Blob Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/s3-compatible/">Replicating to S3-Compatible Services</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/backblaze/">Replicating to Backblaze B2</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/digitalocean/">Replicating to DigitalOcean Spaces</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/scaleway/">Replicating to Scaleway Object Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/tigris/">Replicating to Tigris (Fly.io)</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/gcs/">Replicating to Google Cloud Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/linode/">Replicating to Linode Object Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/sftp/">Replicating to an SFTP Server</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/file/">Replicating to a Local File Path</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/nats/">Replicating to NATS JetStream</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/directory/">Replicating Directories</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/webdav/">Replicating to a WebDAV Server</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/docs/">Help</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/docs/migration/">Migration Guide</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/wal-truncate-threshold/">WAL Truncate Threshold Configuration</a></li>
    <li><a class="docs-link" href="https://litestream.io/docs/troubleshooting/">Troubleshooting</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/reference/">Reference</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/reference/config/">Configuration File</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/vfs/">VFS Extension</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/metrics/">Prometheus Metrics</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/databases/">Command: databases</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/mcp/">Command: mcp</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/replicate/">Command: replicate</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/ltx/">Command: ltx</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/restore/">Command: restore</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/version/">Command: version</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/wal/">Command: wal</a></li>
    </ul>
  
			</nav>        
		</div>
		<nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation">
			<div class="page-links">
    <h3>On this page</h3>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#setup">Setup</a>
      <ul>
        <li><a href="#create-an-iam-user">Create an IAM user</a></li>
        <li><a href="#create-a-bucket">Create a bucket</a></li>
      </ul>
    </li>
    <li><a href="#usage">Usage</a>
      <ul>
        <li><a href="#command-line-usage">Command line usage</a></li>
        <li><a href="#configuration-file-usage">Configuration file usage</a></li>
      </ul>
    </li>
    <li><a href="#using-s3-access-points">Using S3 Access Points</a>
      <ul>
        <li><a href="#benefits">Benefits</a></li>
        <li><a href="#url-format">URL Format</a></li>
        <li><a href="#command-line-usage-1">Command Line Usage</a></li>
        <li><a href="#configuration-file-usage-1">Configuration File Usage</a></li>
        <li><a href="#iam-policy-for-access-points">IAM Policy for Access Points</a></li>
        <li><a href="#vpc-endpoint-configuration">VPC Endpoint Configuration</a></li>
        <li><a href="#troubleshooting-access-points">Troubleshooting Access Points</a></li>
      </ul>
    </li>
    <li><a href="#restrictive-iam-policies">Restrictive IAM Policies</a>
      <ul>
        <li><a href="#replication-policy-read-write">Replication Policy (Read-Write)</a></li>
        <li><a href="#restoration-policy-read-only">Restoration Policy (Read-Only)</a></li>
        <li><a href="#path-specific-policies">Path-Specific Policies</a></li>
      </ul>
    </li>
    <li><a href="#custom-endpoints-s3-compatible-services">Custom Endpoints (S3-Compatible Services)</a>
      <ul>
        <li><a href="#auto-detected-providers">Auto-Detected Providers</a></li>
        <li><a href="#services-requiring-configuration-files">Services Requiring Configuration Files</a></li>
        <li><a href="#minio-example">MinIO Example</a></li>
      </ul>
    </li>
    <li><a href="#see-also">See Also</a></li>
  </ul>
</nav>
  </div>

		</nav>
		<main class="docs-content col-lg-11 col-xl-9 mx-xl-auto">
		<h1>Replicating to Amazon S3</h1>
			<p class="lead"></p>
			<p>This guide will show you how to use Amazon S3 as a database replica path for
Litestream. You will need an <a href="https://aws.amazon.com/">Amazon AWS</a> account to
complete this guide.</p>
<h2 id="setup">Setup<a href="#setup" class="anchor" aria-hidden="true">#</a> </h2>
<h3 id="create-an-iam-user">Create an IAM user<a href="#create-an-iam-user" class="anchor" aria-hidden="true">#</a> </h3>
<p>You will need to set up a user with programmatic access to work with Amazon S3.
From the <a href="https://console.aws.amazon.com/">AWS Console</a>, go to the IAM service.
Next, click <em>Users</em> from the left-hand navigation and then click the <em>Create user</em>
button.</p>
<p>Enter a name for your user and click the <em>Next</em> button.</p>
<figure>
  <img src="iam_0.png" alt="Screenshot of creating an IAM user">
</figure>
<p>On the permissions screen, select <em>&ldquo;Attach policies directly&rdquo;</em>, then search for
&ldquo;S3&rdquo; and choose <code>AmazonS3FullAccess</code>. You can also specify a <a href="#restrictive-iam-policies">more restrictive
policy</a> as described later in this guide. Click <em>Next</em>
to continue.</p>
<figure>
  <img src="iam_1.png" alt="Screenshot of attaching policy to IAM user">
</figure>
<p>Review the user details and click <em>Create user</em>. After the user is created,
navigate to the user&rsquo;s <em>Security credentials</em> tab and click <em>Create access key</em>.
Select your use case, acknowledge the warning, and create the key. You will need
to save the <em>&ldquo;Access key ID&rdquo;</em> and <em>&ldquo;Secret access key&rdquo;</em> for later use in this
guide.</p>
<figure>
  <img src="iam_2.png" alt="Screenshot of AWS credentials for created user">
</figure>
<h3 id="create-a-bucket">Create a bucket<a href="#create-a-bucket" class="anchor" aria-hidden="true">#</a> </h3>
<p>Once you have a user created, go to the <a href="https://s3.console.aws.amazon.com/">S3 service</a>
in the AWS Console. Click the <em>&ldquo;Create bucket&rdquo;</em> button.</p>
<p>You&rsquo;ll need to choose a globally unique bucket name and choose a region to
store the bucket data.</p>
<figure>
  <img src="s3_0.png" alt="Screenshot of AWS S3 create bucket UI">
</figure>
<p>While Litestream files are immutable and don&rsquo;t require versioning, enabling S3
bucket versioning is a best practice that provides additional protection against
accidental deletions.</p>
<figure>
  <img src="s3_1.png" alt="Screenshot of AWS S3 bucket versioning setting">
</figure>
<p>It is also recommended to enable default encryption to protect your data at rest.
The default <em>&ldquo;Server-side encryption with Amazon S3 managed keys (SSE-S3)&rdquo;</em> option
is sufficient for most use cases.</p>
<figure>
  <img src="s3_2.png" alt="Screenshot of AWS S3 default encryption setting">
</figure>
<p>Then click the <em>&ldquo;Create bucket&rdquo;</em> button at the bottom of the screen. Your bucket
has now been created.</p>
<h2 id="usage">Usage<a href="#usage" class="anchor" aria-hidden="true">#</a> </h2>
<h3 id="command-line-usage">Command line usage<a href="#command-line-usage" class="anchor" aria-hidden="true">#</a> </h3>
<p>You can replicate to S3 from the command line by setting environment variables
with the credentials you obtained after creating your IAM user:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>AKIAxxxxxxxxxxxxxxxx
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/xxxxxxxxx
</span></span></code></pre></div><p>Then you can specify your bucket as a replica URL on the command line. For
example, you can replicate a database to your bucket with the following command.</p>
<p>Be sure to replace <code>/path/to/db</code> with the local file path of your database, replace
<code>BUCKETNAME</code> with the name of your bucket, and replace <code>PATHNAME</code> with the path
you want to store your replica within your bucket.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">litestream replicate /path/to/db s3://BUCKETNAME/PATHNAME
</span></span></code></pre></div><p>You can later restore your database from S3 to a local <code>my.db</code> path with the
following command.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">litestream restore -o my.db s3://BUCKETNAME/PATHNAME
</span></span></code></pre></div><div class="alert alert-warning d-flex" role="alert">
  <div class="flex-shrink-1 alert-icon">⚠️</div>
  <div class="w-100">The command line URL variant only supports AWS S3 and a limited set of S3-compatible providers that can be auto-detected from the URL hostname. For other S3-compatible services like MinIO or self-hosted solutions, you must use a configuration file with the `endpoint` parameter. See [Custom Endpoints](#custom-endpoints-s3-compatible-services) below.</div>
</div>
<h3 id="configuration-file-usage">Configuration file usage<a href="#configuration-file-usage" class="anchor" aria-hidden="true">#</a> </h3>
<p>Litestream is typically run as a background service which uses a configuration
file. You can configure a replica for your database using the <code>url</code> format:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">access-key-id</span><span class="p">:</span><span class="w"> </span><span class="l">AKIAxxxxxxxxxxxxxxxx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">secret-access-key</span><span class="p">:</span><span class="w"> </span><span class="l">xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/xxxxxxxxx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/local/db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://BUCKETNAME/PATHNAME</span><span class="w">
</span></span></span></code></pre></div><p>Or you can expand your configuration into multiple fields:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/local/db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">s3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">bucket</span><span class="p">:</span><span class="w"> </span><span class="l">BUCKETNAME</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w">   </span><span class="l">PATHNAME</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l">us-east-1  </span><span class="w"> </span><span class="c"># optional, set to your region</span><span class="w">
</span></span></span></code></pre></div><p>You may also specify your AWS credentials on a per-replica basis:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/local/db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://BUCKETNAME/PATHNAME</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">access-key-id</span><span class="p">:</span><span class="w"> </span><span class="l">AKIAxxxxxxxxxxxxxxxx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">secret-access-key</span><span class="p">:</span><span class="w"> </span><span class="l">xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/xxxxxxxxx</span><span class="w">
</span></span></span></code></pre></div><p><span class="badge badge-info litestream-version" title="This feature has been available since Litestream v0.5.0">
    v0.5.0
</span>
 Litestream v0.5.0+ uses AWS SDK v2, which maintains compatibility with existing authentication methods.</p>
<h2 id="using-s3-access-points">Using S3 Access Points<a href="#using-s3-access-points" class="anchor" aria-hidden="true">#</a> </h2>
<p><span class="badge badge-info litestream-version" title="This feature has been available since Litestream v0.5.0">
    v0.5.0
</span>
 Litestream supports <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-points.html">S3 Access Points</a>,
which provide dedicated endpoints for accessing shared datasets in S3. Access
points are useful for VPC-only configurations, simplified access control, and
improved network performance.</p>
<h3 id="benefits">Benefits<a href="#benefits" class="anchor" aria-hidden="true">#</a> </h3>
<ul>
<li><strong>VPC-only access</strong>: Route backup traffic through VPC endpoints instead of
NAT gateways for improved security and network isolation</li>
<li><strong>Reduced costs</strong>: Eliminate NAT gateway data transfer charges, which can be
significant for large databases</li>
<li><strong>Lower latency</strong>: Direct VPC connectivity provides better performance</li>
<li><strong>Simplified access control</strong>: Delegate permissions to access point policies
for multi-tenant scenarios</li>
</ul>
<h3 id="url-format">URL Format<a href="#url-format" class="anchor" aria-hidden="true">#</a> </h3>
<p>Specify access point ARNs using the <code>s3://</code> URL scheme followed by the ARN:</p>
<pre tabindex="0"><code>s3://arn:aws:s3:REGION:ACCOUNT-ID:accesspoint/ACCESS-POINT-NAME[/PATH]
</code></pre><p>The region is automatically extracted from the ARN but can be explicitly
overridden in the configuration.</p>
<h3 id="command-line-usage-1">Command Line Usage<a href="#command-line-usage-1" class="anchor" aria-hidden="true">#</a> </h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">litestream replicate /path/to/db <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  s3://arn:aws:s3:us-east-2:123456789012:accesspoint/my-access-point/backups
</span></span></code></pre></div><h3 id="configuration-file-usage-1">Configuration File Usage<a href="#configuration-file-usage-1" class="anchor" aria-hidden="true">#</a> </h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://arn:aws:s3:us-east-2:123456789012:accesspoint/my-access-point/backups/prod</span><span class="w">
</span></span></span></code></pre></div><p>If you need to override the region extracted from the ARN:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://arn:aws:s3:us-east-2:123456789012:accesspoint/my-access-point/backups</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l">us-east-2</span><span class="w">
</span></span></span></code></pre></div><h3 id="iam-policy-for-access-points">IAM Policy for Access Points<a href="#iam-policy-for-access-points" class="anchor" aria-hidden="true">#</a> </h3>
<p>Access points require IAM permissions on <strong>both</strong> the access point and the
underlying bucket. For an application to access objects through an access point,
both the access point policy and the bucket must permit the request.</p>
<p>There are two approaches to configure this:</p>
<h4 id="option-1-explicit-permissions-on-both-arns-recommended-for-restrictive-policies">Option 1: Explicit Permissions on Both ARNs (Recommended for Restrictive Policies)<a href="#option-1-explicit-permissions-on-both-arns-recommended-for-restrictive-policies" class="anchor" aria-hidden="true">#</a> </h4>
<p>The following IAM policy grants permissions on both the access point and the
underlying bucket ARNs. This approach is useful when you need fine-grained
control or when the bucket policy doesn&rsquo;t delegate to access points:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Version&#34;</span><span class="p">:</span> <span class="s2">&#34;2012-10-17&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Statement&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Effect&#34;</span><span class="p">:</span> <span class="s2">&#34;Allow&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Action&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;s3:GetBucketLocation&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;s3:ListBucket&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Resource&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;arn:aws:s3:us-east-2:123456789012:accesspoint/my-access-point&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;arn:aws:s3:::my-bucket&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Effect&#34;</span><span class="p">:</span> <span class="s2">&#34;Allow&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Action&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;s3:PutObject&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;s3:DeleteObject&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;s3:GetObject&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Resource&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;arn:aws:s3:us-east-2:123456789012:accesspoint/my-access-point/object/*&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;arn:aws:s3:::my-bucket/*&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Replace <code>123456789012</code> with your AWS account ID, <code>us-east-2</code> with your region,
<code>my-access-point</code> with your access point name, and <code>my-bucket</code> with your bucket name.</p>
<h4 id="option-2-delegate-access-control-to-access-points-recommended-for-simplified-management">Option 2: Delegate Access Control to Access Points (Recommended for Simplified Management)<a href="#option-2-delegate-access-control-to-access-points-recommended-for-simplified-management" class="anchor" aria-hidden="true">#</a> </h4>
<p>Add this bucket policy to delegate all access control to your access points:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Version&#34;</span><span class="p">:</span> <span class="s2">&#34;2012-10-17&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Statement&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Effect&#34;</span><span class="p">:</span> <span class="s2">&#34;Allow&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Principal&#34;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&#34;AWS&#34;</span><span class="p">:</span> <span class="s2">&#34;*&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Action&#34;</span><span class="p">:</span> <span class="s2">&#34;*&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Resource&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;arn:aws:s3:::my-bucket&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;arn:aws:s3:::my-bucket/*&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Condition&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;StringEquals&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;s3:DataAccessPointAccount&#34;</span><span class="p">:</span> <span class="s2">&#34;123456789012&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>With this bucket policy in place, you only need the access point ARN in your
IAM policy:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Version&#34;</span><span class="p">:</span> <span class="s2">&#34;2012-10-17&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Statement&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Effect&#34;</span><span class="p">:</span> <span class="s2">&#34;Allow&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Action&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;s3:GetBucketLocation&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;s3:ListBucket&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Resource&#34;</span><span class="p">:</span> <span class="s2">&#34;arn:aws:s3:us-east-2:123456789012:accesspoint/my-access-point&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Effect&#34;</span><span class="p">:</span> <span class="s2">&#34;Allow&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Action&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;s3:PutObject&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;s3:DeleteObject&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;s3:GetObject&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Resource&#34;</span><span class="p">:</span> <span class="s2">&#34;arn:aws:s3:us-east-2:123456789012:accesspoint/my-access-point/object/*&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>See the <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-points-policies.html">AWS documentation</a>
for more details on configuring access point and bucket policies.</p>
<h3 id="vpc-endpoint-configuration">VPC Endpoint Configuration<a href="#vpc-endpoint-configuration" class="anchor" aria-hidden="true">#</a> </h3>
<p>To use VPC-only access points, you must configure a VPC Gateway Endpoint for S3
in your VPC. Gateway endpoints are free and route traffic through the AWS
backbone network instead of the public internet, improving security and
reducing NAT gateway costs.</p>
<p>The access point&rsquo;s network origin must be set to &ldquo;VPC&rdquo; when creating it.</p>
<h4 id="terraform-example">Terraform Example<a href="#terraform-example" class="anchor" aria-hidden="true">#</a> </h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;aws_vpc_endpoint&#34; &#34;s3&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  vpc_id</span>            <span class="o">=</span> <span class="k">aws_vpc</span><span class="p">.</span><span class="k">main</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl"><span class="n">  service_name</span>      <span class="o">=</span> <span class="s2">&#34;com.amazonaws.${var.aws_region}.s3&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">  vpc_endpoint_type</span> <span class="o">=</span> <span class="s2">&#34;Gateway&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">  route_table_ids</span>   <span class="o">=</span> <span class="p">[</span><span class="k">aws_route_table</span><span class="p">.</span><span class="k">private</span><span class="p">.</span><span class="k">id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">  tags</span> <span class="o">=</span> {
</span></span><span class="line"><span class="cl"><span class="n">    Name</span> <span class="o">=</span> <span class="s2">&#34;s3-gateway-endpoint&#34;</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><h4 id="cloudformation-example">CloudFormation Example<a href="#cloudformation-example" class="anchor" aria-hidden="true">#</a> </h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">S3GatewayEndpoint</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l">AWS::EC2::VPCEndpoint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span>!<span class="l">Ref VPC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ServiceName</span><span class="p">:</span><span class="w"> </span>!<span class="l">Sub &#34;com.amazonaws.${AWS::Region}.s3&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">VpcEndpointType</span><span class="p">:</span><span class="w"> </span><span class="l">Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">RouteTableIds</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- !<span class="l">Ref PrivateRouteTable</span><span class="w">
</span></span></span></code></pre></div><p>After creating the VPC endpoint, ensure your access point&rsquo;s network origin is
set to &ldquo;VPC&rdquo; and specifies your VPC ID. See
<a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-points-vpc.html">Creating access points restricted to a VPC</a>
for detailed setup instructions.</p>
<h3 id="troubleshooting-access-points">Troubleshooting Access Points<a href="#troubleshooting-access-points" class="anchor" aria-hidden="true">#</a> </h3>
<p>Common errors when configuring S3 access points:</p>
<table>
<thead>
<tr>
<th>Error</th>
<th>Cause</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>no identity-based policy allows the s3:PutObject action</code></td>
<td>IAM policy not attached to user/role or missing required permissions</td>
<td>Verify the IAM policy is attached and includes both access point and bucket ARNs (see <a href="#iam-policy-for-access-points">IAM Policy for Access Points</a>)</td>
</tr>
<tr>
<td><code>explicit deny in a resource-based policy</code></td>
<td>Access point policy or bucket policy is blocking the request</td>
<td>Check both the access point policy and bucket policy; ensure the bucket delegates to access points or explicitly allows access</td>
</tr>
<tr>
<td><code>Access Denied</code> when using VPC access point</td>
<td>VPC endpoint not configured or route table not associated</td>
<td>Create a VPC Gateway Endpoint for S3 and associate it with your private subnet&rsquo;s route table</td>
</tr>
<tr>
<td><code>Could not connect to the endpoint URL</code></td>
<td>Network cannot reach the access point</td>
<td>For VPC-only access points, ensure your application runs within the VPC and the VPC endpoint is properly configured</td>
</tr>
</tbody>
</table>
<h2 id="restrictive-iam-policies">Restrictive IAM Policies<a href="#restrictive-iam-policies" class="anchor" aria-hidden="true">#</a> </h2>
<p>While specifying <code>AmazonS3FullAccess</code> is an easy way to get up and running, you
may want to specify a more restrictive policy in order to limit abuse if your
credentials are compromised.</p>
<h3 id="replication-policy-read-write">Replication Policy (Read-Write)<a href="#replication-policy-read-write" class="anchor" aria-hidden="true">#</a> </h3>
<p>The following policy provides the minimum permissions needed for Litestream to
replicate databases to S3. This includes creating, updating, and deleting
replica files. Please replace <code>&lt;BUCKET&gt;</code> with the name of your bucket.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Version&#34;</span><span class="p">:</span> <span class="s2">&#34;2012-10-17&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Statement&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Effect&#34;</span><span class="p">:</span> <span class="s2">&#34;Allow&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Action&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;s3:GetBucketLocation&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;s3:ListBucket&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Resource&#34;</span><span class="p">:</span> <span class="s2">&#34;arn:aws:s3:::&lt;BUCKET&gt;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Effect&#34;</span><span class="p">:</span> <span class="s2">&#34;Allow&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Action&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;s3:PutObject&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;s3:DeleteObject&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;s3:GetObject&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Resource&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;arn:aws:s3:::&lt;BUCKET&gt;/*&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="restoration-policy-read-only">Restoration Policy (Read-Only)<a href="#restoration-policy-read-only" class="anchor" aria-hidden="true">#</a> </h3>
<p>If you only need to restore databases from existing S3 replicas (without
creating new replicas), you can use this more restrictive read-only policy:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Version&#34;</span><span class="p">:</span> <span class="s2">&#34;2012-10-17&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Statement&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Effect&#34;</span><span class="p">:</span> <span class="s2">&#34;Allow&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Action&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;s3:GetBucketLocation&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;s3:ListBucket&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Resource&#34;</span><span class="p">:</span> <span class="s2">&#34;arn:aws:s3:::&lt;BUCKET&gt;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Effect&#34;</span><span class="p">:</span> <span class="s2">&#34;Allow&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Action&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;s3:GetObject&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Resource&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;arn:aws:s3:::&lt;BUCKET&gt;/*&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="path-specific-policies">Path-Specific Policies<a href="#path-specific-policies" class="anchor" aria-hidden="true">#</a> </h3>
<p>For additional security, you can restrict access to a specific path within your
bucket by modifying the resource ARNs. For example, to limit access to the
<code>litestream/</code> directory:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="s2">&#34;Resource&#34;</span><span class="err">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;arn:aws:s3:::&lt;BUCKET&gt;/litestream/*&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>Thanks to <a href="https://github.com/maluio">Martin</a> for contributing the original policy and
to <a href="https://github.com/benbjohnson/litestream/issues/76#issuecomment-783926359">cariaso</a>
for additional policy insights.</p>
<h2 id="custom-endpoints-s3-compatible-services">Custom Endpoints (S3-Compatible Services)<a href="#custom-endpoints-s3-compatible-services" class="anchor" aria-hidden="true">#</a> </h2>
<p>Litestream supports S3-compatible storage services such as MinIO, Backblaze B2,
DigitalOcean Spaces, and others. However, how you configure these services
depends on whether Litestream can auto-detect the endpoint from the URL.</p>
<h3 id="auto-detected-providers">Auto-Detected Providers<a href="#auto-detected-providers" class="anchor" aria-hidden="true">#</a> </h3>
<p>When using the command line URL variant (<code>s3://BUCKET/PATH</code>), Litestream can
automatically detect the correct endpoint for these providers based on the URL
hostname pattern:</p>
<ul>
<li><strong>AWS S3</strong>: Standard <code>s3://bucket/path</code> URLs</li>
<li><strong>Backblaze B2</strong>: URLs containing <code>.backblazeb2.com</code></li>
<li><strong>DigitalOcean Spaces</strong>: URLs containing <code>.digitaloceanspaces.com</code></li>
<li><strong>Linode Object Storage</strong>: URLs containing <code>.linodeobjects.com</code></li>
<li><strong>Scaleway</strong>: URLs containing <code>.scw.cloud</code></li>
</ul>
<p>For these providers, you can use both command line and configuration file approaches.</p>
<h3 id="services-requiring-configuration-files">Services Requiring Configuration Files<a href="#services-requiring-configuration-files" class="anchor" aria-hidden="true">#</a> </h3>
<p>For S3-compatible services that cannot be auto-detected from the URL hostname,
you <strong>must</strong> use a configuration file with the <code>endpoint</code> parameter. This includes:</p>
<ul>
<li>MinIO (self-hosted or remote)</li>
<li>Self-hosted S3-compatible storage</li>
<li>Other S3-compatible providers not in the auto-detected list</li>
</ul>
<p>Attempting to use the command line URL variant with these services will result
in Litestream connecting to AWS S3 instead of your intended endpoint, causing
authentication errors like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">cannot lookup bucket region: InvalidAccessKeyId: The AWS Access Key Id you
</span></span><span class="line"><span class="cl">provided does not exist in our records.
</span></span></code></pre></div><h3 id="minio-example">MinIO Example<a href="#minio-example" class="anchor" aria-hidden="true">#</a> </h3>
<p>For MinIO, always use a configuration file:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/local/db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">s3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">bucket</span><span class="p">:</span><span class="w"> </span><span class="l">mybucket</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">mydb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l">https://minio.example.com:9000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l">us-east-1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">access-key-id</span><span class="p">:</span><span class="w"> </span><span class="l">${MINIO_ACCESS_KEY}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">secret-access-key</span><span class="p">:</span><span class="w"> </span><span class="l">${MINIO_SECRET_KEY}</span><span class="w">
</span></span></span></code></pre></div><p>For detailed MinIO configuration options, see the
<a href="/reference/config#minio-configuration">MinIO Configuration</a> section in the
configuration reference.</p>
<h2 id="see-also">See Also<a href="#see-also" class="anchor" aria-hidden="true">#</a> </h2>
<ul>
<li><a href="/guides/s3-advanced">S3 Advanced Configuration</a> - Multipart uploads, storage classes, and more</li>
<li><a href="/guides/s3-compatible">S3-Compatible Services</a> - DigitalOcean, Backblaze, and other providers</li>
<li><a href="/docs/troubleshooting">Troubleshooting</a> - Common issues and solutions</li>
<li><a href="/reference/config">Configuration Reference</a> - Complete configuration options</li>
</ul>

			<div class="docs-navigation d-flex justify-content-between">
	
	<a href="https://litestream.io/guides/global-defaults/">
			<div class="card my-1">
				<div class="card-body py-2">
					&larr; Global Replica Defaults
				</div>
			</div>
		</a>
	<a class="ml-auto" href="https://litestream.io/guides/aws-sdk-v2/">
			<div class="card my-1">
				<div class="card-body py-2">
					AWS SDK v2 Migration &rarr;
				</div>
			</div>
		</a>
	</div>

		</main>
	</div>

      </div>
    </div>
    
    
    <footer>
</footer>
    
    <script src="https://litestream.io/main.f4006b8dd3163d19fa41adf9892089fe185101b404b96884ed2a22ec4e9cb0706759ecdb3f4520a1d37fc5ad7a90a8d90abfb30055a1ff67aefb5b2324355d12.js" integrity="sha512-9ABrjdMWPRn6Qa35iSCJ/hhRAbQEuWiE7Soi7E6csHBnWezbP0UgodN/xa16kKjZCr&#43;zAFWh/2eu&#43;1sjJDVdEg==" crossorigin="anonymous" defer></script>
  <script src="https://litestream.io/index.min.a67b8f446812a1d1daf83684457db96119988d4a81b6220b04ae1012c641b10bdb91cc3e97b0327f186cf8f412b65807268918a294cc1f15ae53f4c6c1fd7743.js" integrity="sha512-pnuPRGgSodHa&#43;DaERX25YRmYjUqBtiILBK4QEsZBsQvbkcw&#43;l7Ayfxhs&#43;PQStlgHJokYopTMHxWuU/TGwf13Qw==" crossorigin="anonymous" defer></script>

  </body>
</html>