<!doctype html>
<html lang="en-US">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <link rel="stylesheet" href="/main.211f27ab66d952d637fa741b575d7cfdf53f25b5ea7d6f38193f667a756f6b85f1e0e59a36a863834fb2e4ef66f1928cff1358b23bb8a5956101d4994514962f.css" integrity="sha512-IR8nq2bZUtY3&#43;nQbV118/fU/JbXqfW84GT9menVva4Xx4OWaNqhjg0&#43;y5O9m8ZKM/xNYsju4pZVhAdSZRRSWLw==" crossorigin="anonymous">
<noscript><style>img.lazyload { display: none; }</style></noscript>

<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;1,400;1,600&display=swap" rel="stylesheet">

  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <title>Directory Watcher - Litestream</title>
<meta name="description" content="Litestream replicates SQLite databases in real-time to S3.">
<link rel="canonical" href="https://litestream.io/guides/directory-watcher/">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://litestream.io/images/twitter-image.png">
<meta name="twitter:title" content="Directory Watcher">
<meta name="twitter:description" content="This guide will show you how to use the directory watcher feature for automatic database discovery. This is useful for multi-tenant applications where databases are dynamically created and removed at runtime.
v0.5.0 Overview Litestream supports two modes for managing multiple databases in a directory:
Static directory replication scans a directory at startup and replicates all matching databases. New databases require a restart to be picked up.
Directory watcher monitors a directory in real-time and automatically starts replication for new databases within seconds.">
<meta name="twitter:site" content="@litestreamio">
<meta name="twitter:creator" content="@benbjohnson">

<meta name="twitter:site" content="@litestreamio">
<meta name="twitter:creator" content="@benbjohnson">

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position":  1 ,
        "name": "Home",
        "item": "https:\/\/litestream.io\/"
    },{
        "@type": "ListItem",
        "position":  2 ,
        "name": "Guides",
        "item": "https:\/\/litestream.io\/guides\/"
    },{
        "@type": "ListItem",
        "position":  3 ,
        "name": "Directory Watcher",
        "item": "https:\/\/litestream.io\/guides\/directory-watcher\/"
    }]
}
</script>

  <meta name="theme-color" content="#fff">
<link rel="apple-touch-icon" sizes="180x180" href="https://litestream.io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://litestream.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://litestream.io/favicon-16x16.png">
<link rel="manifest" href="https://litestream.io/site.webmanifest">
  
</head>
  <body class="guides single">
    <header class="navbar fixed-top navbar-expand-md navbar-light">
  <div class="container align-items-baseline">
    <input class="menu-btn order-0" type="checkbox" id="menu-btn">

    <label class="menu-icon d-md-none" for="menu-btn"><span class="navicon"></span></label>

    <a class="navbar-brand order-1 order-md-0 mr-auto" href="https://litestream.io/">
      <img class="d-md-inline d-none" src="/images/logo.svg" />
      <span class="d-sm-inline d-md-none">Litestream</span>
    </a>

    <ul class="navbar-nav social-nav order-3 order-md-5">
      <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/litestreamio"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg><span class="ml-2 sr-only">Twitter</span></a>
        </li>
      <li class="nav-item">
          <a class="nav-link" href="https://github.com/benbjohnson/litestream"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="ml-2 sr-only">GitHub</span></a>
        </li>
      </ul>

    <div class="collapse navbar-collapse order-4 order-md-1">
      <ul class="navbar-nav main-nav mr-auto order-5 order-md-2"><li class="nav-item">
            <a class="nav-link" href="https://litestream.io/install">Install</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://litestream.io/guides">Guides</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://litestream.io/reference">Reference</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://github.com/benbjohnson/litestream">GitHub</a>
          </li>
        </ul>
      <div class="break order-6 d-md-none"></div>
    </div>
  </div>
</header>
    <div class="version-banner alert alert-warning text-center mb-0" role="alert" style="border-radius: 0;">
  <div class="container">
    <strong>v0.5.x</strong> - Latest - Actively maintained with new features and bug fixes| <a href="/v0.3/" class="alert-link">View v0.3.13 (Previous)</a></div>
</div>
    <div class="wrap container" role="document">
      <div class="content">
        
	<div class="row flex-xl-nowrap">
		<div class="col-lg-5 col-xl-4 docs-sidebar">
			<nav class="docs-links" aria-label="Main navigation">
				<h3>
    <a href="https://litestream.io/install">Install</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/install/mac/">macOS</a></li>
    <li><a class="docs-link" href="https://litestream.io/install/linux/">Linux</a></li>
    <li><a class="docs-link" href="https://litestream.io/install/source/">Build from Source</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/">General</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/getting-started/">Getting Started</a></li>
    <li><a class="docs-link" href="https://litestream.io/tips/">Tips &amp; Caveats</a></li>
    <li><a class="docs-link" href="https://litestream.io/how-it-works/">How it works</a></li>
    <li><a class="docs-link" href="https://litestream.io/how-it-works/vfs/">Read Replicas with VFS</a></li>
    <li><a class="docs-link" href="https://litestream.io/alternatives/">Alternatives</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/guides/">Infrastructure Guides</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/guides/docker/">Running in a Docker container</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/kubernetes/">Running in a Kubernetes cluster</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/systemd/">Running as a Systemd service</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/windows/">Running as a Windows Service</a></li>
    <li><a class="docs-link active" href="https://litestream.io/guides/directory-watcher/">Directory Watcher</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/guides/">Replica Guides</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/guides/global-defaults/">Global Replica Defaults</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/s3/">Replicating to Amazon S3</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/aws-sdk-v2/">AWS SDK v2 Migration</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/alibaba-oss/">Replicating to Alibaba Cloud OSS</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/s3-advanced/">S3 Advanced Configuration</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/vfs/">VFS Read Replicas</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/go-library/">Using Litestream as a Go Library</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/vfs-write-mode/">VFS Write Mode</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/vfs-hydration/">VFS Hydration</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/azure/">Replicating to Azure Blob Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/s3-compatible/">Replicating to S3-Compatible Services</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/backblaze/">Replicating to Backblaze B2</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/digitalocean/">Replicating to DigitalOcean Spaces</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/scaleway/">Replicating to Scaleway Object Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/tigris/">Replicating to Tigris (Fly.io)</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/gcs/">Replicating to Google Cloud Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/linode/">Replicating to Linode Object Storage</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/sftp/">Replicating to an SFTP Server</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/file/">Replicating to a Local File Path</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/nats/">Replicating to NATS JetStream</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/directory/">Replicating Directories</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/webdav/">Replicating to a WebDAV Server</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/docs/">Help</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/docs/migration/">Migration Guide</a></li>
    <li><a class="docs-link" href="https://litestream.io/guides/wal-truncate-threshold/">WAL Truncate Threshold Configuration</a></li>
    <li><a class="docs-link" href="https://litestream.io/docs/troubleshooting/">Troubleshooting</a></li>
    </ul>
  <h3>
    <a href="https://litestream.io/reference/">Reference</a>
  </h3>
  <ul class="list-unstyled">
    <li><a class="docs-link" href="https://litestream.io/reference/config/">Configuration File</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/vfs/">VFS Extension</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/metrics/">Prometheus Metrics</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/databases/">Command: databases</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/mcp/">Command: mcp</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/replicate/">Command: replicate</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/ltx/">Command: ltx</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/restore/">Command: restore</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/reset/">Command: reset</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/ipc/">IPC Endpoints</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/version/">Command: version</a></li>
    <li><a class="docs-link" href="https://litestream.io/reference/wal/">Command: wal</a></li>
    </ul>
  
			</nav>        
		</div>
		<nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation">
			<div class="page-links">
    <h3>On this page</h3>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#configuration">Configuration</a>
      <ul>
        <li><a href="#configuration-options">Configuration options</a></li>
        <li><a href="#pattern-matching">Pattern matching</a></li>
      </ul>
    </li>
    <li><a href="#example-configurations">Example configurations</a>
      <ul>
        <li><a href="#flat-directory-structure">Flat directory structure</a></li>
        <li><a href="#nested-directory-structure">Nested directory structure</a></li>
        <li><a href="#multiple-patterns">Multiple patterns</a></li>
      </ul>
    </li>
    <li><a href="#behavior">Behavior</a>
      <ul>
        <li><a href="#database-discovery">Database discovery</a></li>
        <li><a href="#database-removal">Database removal</a></li>
        <li><a href="#directory-removal">Directory removal</a></li>
        <li><a href="#restart-behavior">Restart behavior</a></li>
      </ul>
    </li>
    <li><a href="#restoring-databases">Restoring databases</a>
      <ul>
        <li><a href="#restoring-a-single-database">Restoring a single database</a></li>
        <li><a href="#restore-path-structure">Restore path structure</a></li>
        <li><a href="#listing-available-databases">Listing available databases</a></li>
        <li><a href="#restoring-multiple-databases">Restoring multiple databases</a></li>
        <li><a href="#point-in-time-restore">Point-in-time restore</a></li>
      </ul>
    </li>
    <li><a href="#differences-from-static-directory-replication">Differences from static directory replication</a></li>
    <li><a href="#troubleshooting">Troubleshooting</a>
      <ul>
        <li><a href="#verifying-database-discovery">Verifying database discovery</a></li>
        <li><a href="#debugging-pattern-matching">Debugging pattern matching</a></li>
        <li><a href="#common-issues">Common issues</a></li>
      </ul>
    </li>
    <li><a href="#performance-considerations">Performance considerations</a></li>
    <li><a href="#limitations">Limitations</a></li>
    <li><a href="#see-also">See Also</a></li>
  </ul>
</nav>
  </div>

		</nav>
		<main class="docs-content col-lg-11 col-xl-9 mx-xl-auto">
		<h1>Directory Watcher</h1>
			<p class="lead"></p>
			<p>This guide will show you how to use the directory watcher feature for automatic
database discovery. This is useful for multi-tenant applications where databases
are dynamically created and removed at runtime.</p>
<span class="badge badge-info litestream-version" title="This feature has been available since Litestream v0.5.0">
    v0.5.0
</span>

<h2 id="overview">Overview<a href="#overview" class="anchor" aria-hidden="true">#</a> </h2>
<p>Litestream supports two modes for managing multiple databases in a directory:</p>
<ol>
<li>
<p><strong><a href="/guides/directory">Static directory replication</a></strong> scans a directory at
startup and replicates all matching databases. New databases require a
restart to be picked up.</p>
</li>
<li>
<p><strong>Directory watcher</strong> monitors a directory in real-time and automatically
starts replication for new databases within seconds. Deleted databases are
cleanly removed from replication.</p>
</li>
</ol>
<p>The directory watcher is ideal for:</p>
<ul>
<li>Multi-tenant SaaS applications with per-tenant databases</li>
<li>Dynamic provisioning scenarios where databases are created on demand</li>
<li>High-concurrency environments with rapid database creation</li>
</ul>
<h2 id="configuration">Configuration<a href="#configuration" class="anchor" aria-hidden="true">#</a> </h2>
<p>Enable directory watching by adding <code>watch: true</code> to your directory configuration:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">dir</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app/tenants</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;*.db&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">watch</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">s3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">bucket</span><span class="p">:</span><span class="w"> </span><span class="l">my-backup-bucket</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">tenants</span><span class="w">
</span></span></span></code></pre></div><h3 id="configuration-options">Configuration options<a href="#configuration-options" class="anchor" aria-hidden="true">#</a> </h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dir</code></td>
<td>Directory path to monitor</td>
<td>Required</td>
</tr>
<tr>
<td><code>pattern</code></td>
<td>Glob pattern for database files (e.g., <code>*.db</code>, <code>*.sqlite</code>)</td>
<td>Required</td>
</tr>
<tr>
<td><code>recursive</code></td>
<td>Monitor subdirectories</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>watch</code></td>
<td>Enable real-time monitoring</td>
<td><code>false</code></td>
</tr>
</tbody>
</table>
<h3 id="pattern-matching">Pattern matching<a href="#pattern-matching" class="anchor" aria-hidden="true">#</a> </h3>
<p>The <code>pattern</code> field uses standard glob patterns to match database files:</p>
<ul>
<li><code>*.db</code> matches all files ending in <code>.db</code></li>
<li><code>*.sqlite</code> matches all files ending in <code>.sqlite</code></li>
<li><code>tenant-*.db</code> matches files like <code>tenant-001.db</code>, <code>tenant-abc.db</code></li>
</ul>
<h2 id="example-configurations">Example configurations<a href="#example-configurations" class="anchor" aria-hidden="true">#</a> </h2>
<h3 id="flat-directory-structure">Flat directory structure<a href="#flat-directory-structure" class="anchor" aria-hidden="true">#</a> </h3>
<p>For applications that store all tenant databases in a single directory:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">dir</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app/databases</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;*.db&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">watch</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://mybucket/databases</span><span class="w">
</span></span></span></code></pre></div><p>Directory structure:</p>
<pre tabindex="0"><code>/var/lib/app/databases/
├── tenant-001.db
├── tenant-002.db
└── tenant-003.db
</code></pre><p>Replica structure:</p>
<pre tabindex="0"><code>s3://mybucket/databases/
├── tenant-001.db/
├── tenant-002.db/
└── tenant-003.db/
</code></pre><h3 id="nested-directory-structure">Nested directory structure<a href="#nested-directory-structure" class="anchor" aria-hidden="true">#</a> </h3>
<p>For applications that isolate tenants in subdirectories, enable <code>recursive</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">dir</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app/tenants</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;*.db&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">recursive</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">watch</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://mybucket/tenants</span><span class="w">
</span></span></span></code></pre></div><p>Directory structure:</p>
<pre tabindex="0"><code>/var/lib/app/tenants/
├── acme-corp/
│   └── data.db
├── globex/
│   └── data.db
└── initech/
    └── data.db
</code></pre><p>Replica structure:</p>
<pre tabindex="0"><code>s3://mybucket/tenants/
├── acme-corp/data.db/
├── globex/data.db/
└── initech/data.db/
</code></pre><h3 id="multiple-patterns">Multiple patterns<a href="#multiple-patterns" class="anchor" aria-hidden="true">#</a> </h3>
<p>To replicate different database types with different configurations, use
separate directory entries:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">dir</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app/tenants</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;*.db&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">watch</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://mybucket/primary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">sync-interval</span><span class="p">:</span><span class="w"> </span><span class="l">1s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">dir</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/app/analytics</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;*.sqlite&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">watch</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">replica</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">s3://mybucket/analytics</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">sync-interval</span><span class="p">:</span><span class="w"> </span><span class="l">10s</span><span class="w">
</span></span></span></code></pre></div><h2 id="behavior">Behavior<a href="#behavior" class="anchor" aria-hidden="true">#</a> </h2>
<h3 id="database-discovery">Database discovery<a href="#database-discovery" class="anchor" aria-hidden="true">#</a> </h3>
<p>When a new SQLite database file is created that matches the configured pattern:</p>
<ol>
<li>The directory watcher detects the file creation event</li>
<li>Litestream validates that the file is a valid SQLite database</li>
<li>Replication begins automatically within seconds</li>
<li>The database appears in logs and metrics</li>
</ol>
<p>Files that do not pass SQLite validation are ignored, preventing non-database
files from being picked up.</p>
<h3 id="database-removal">Database removal<a href="#database-removal" class="anchor" aria-hidden="true">#</a> </h3>
<p>When a database file is deleted:</p>
<ol>
<li>The directory watcher detects the file removal event</li>
<li>Litestream stops replication for that database</li>
<li>Resources are cleaned up</li>
<li>The replica data remains in storage (not deleted)</li>
</ol>
<p>Replica data is preserved to allow recovery if needed. See
<a href="#restoring-databases">Restoring databases</a> for recovery instructions. Use your
storage provider&rsquo;s lifecycle policies to manage old replica cleanup.</p>
<h3 id="directory-removal">Directory removal<a href="#directory-removal" class="anchor" aria-hidden="true">#</a> </h3>
<p>When an entire directory is removed (in recursive mode):</p>
<ol>
<li>All databases within that directory are removed from replication</li>
<li>Directory watches are cleaned up</li>
<li>Replica data remains in storage</li>
</ol>
<h3 id="restart-behavior">Restart behavior<a href="#restart-behavior" class="anchor" aria-hidden="true">#</a> </h3>
<p>On Litestream restart:</p>
<ol>
<li>The directory is scanned for existing databases</li>
<li>All matching databases begin replication</li>
<li>Directory watching resumes for new files</li>
<li>Previously replicated databases that no longer exist are not cleaned up
from storage</li>
</ol>
<h2 id="restoring-databases">Restoring databases<a href="#restoring-databases" class="anchor" aria-hidden="true">#</a> </h2>
<p>When using directory watcher mode, databases are not individually specified in
the configuration file. This means the standard <code>litestream restore &lt;db-path&gt;</code>
command won&rsquo;t work because Litestream can&rsquo;t find the database definition.</p>
<h3 id="restoring-a-single-database">Restoring a single database<a href="#restoring-a-single-database" class="anchor" aria-hidden="true">#</a> </h3>
<p>To restore a database from a directory watcher replica, use the replica URL
directly instead of the database path:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">litestream restore -o /path/to/database.sqlite s3://mybucket/databases/database.sqlite
</span></span></code></pre></div><p>If your replica requires credentials, set them via environment variables first:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LITESTREAM_ACCESS_KEY_ID</span><span class="o">=</span>your-access-key
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LITESTREAM_SECRET_ACCESS_KEY</span><span class="o">=</span>your-secret-key
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">litestream restore -o /var/lib/app/databases/tenant-001.db <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  s3://mybucket/databases/tenant-001.db
</span></span></code></pre></div><h3 id="restore-path-structure">Restore path structure<a href="#restore-path-structure" class="anchor" aria-hidden="true">#</a> </h3>
<p>The replica path follows your configuration. For a flat directory structure:</p>
<table>
<thead>
<tr>
<th>Configuration</th>
<th>Database Path</th>
<th>Replica URL</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>url: s3://mybucket/databases</code></td>
<td><code>/var/lib/app/databases/tenant-001.db</code></td>
<td><code>s3://mybucket/databases/tenant-001.db</code></td>
</tr>
</tbody>
</table>
<p>For a nested directory structure with <code>recursive: true</code>:</p>
<table>
<thead>
<tr>
<th>Configuration</th>
<th>Database Path</th>
<th>Replica URL</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>url: s3://mybucket/tenants</code></td>
<td><code>/var/lib/app/tenants/acme/data.db</code></td>
<td><code>s3://mybucket/tenants/acme/data.db</code></td>
</tr>
</tbody>
</table>
<h3 id="listing-available-databases">Listing available databases<a href="#listing-available-databases" class="anchor" aria-hidden="true">#</a> </h3>
<p>To see what databases are available for restore, list the replica storage:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># For S3</span>
</span></span><span class="line"><span class="cl">aws s3 ls s3://mybucket/databases/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># For GCS</span>
</span></span><span class="line"><span class="cl">gsutil ls gs://mybucket/databases/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># For Azure Blob Storage</span>
</span></span><span class="line"><span class="cl">az storage blob list --container-name mycontainer --prefix databases/
</span></span></code></pre></div><h3 id="restoring-multiple-databases">Restoring multiple databases<a href="#restoring-multiple-databases" class="anchor" aria-hidden="true">#</a> </h3>
<p>There is no built-in command to restore all databases at once. To restore
multiple databases, iterate over your replica storage and restore each one:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nb">export</span> <span class="nv">LITESTREAM_ACCESS_KEY_ID</span><span class="o">=</span>your-access-key
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LITESTREAM_SECRET_ACCESS_KEY</span><span class="o">=</span>your-secret-key
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># List and restore all databases from S3</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> db in <span class="k">$(</span>aws s3 ls s3://mybucket/databases/ <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s/\/$//&#39;</span><span class="k">)</span><span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;Restoring </span><span class="nv">$db</span><span class="s2">...&#34;</span>
</span></span><span class="line"><span class="cl">  litestream restore -o <span class="s2">&#34;/var/lib/app/databases/</span><span class="nv">$db</span><span class="s2">&#34;</span> <span class="s2">&#34;s3://mybucket/databases/</span><span class="nv">$db</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span></code></pre></div><h3 id="point-in-time-restore">Point-in-time restore<a href="#point-in-time-restore" class="anchor" aria-hidden="true">#</a> </h3>
<p>Point-in-time restore works the same way, using the replica URL:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">litestream restore <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -timestamp 2026-01-01T12:00:00Z <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -o /var/lib/app/databases/tenant-001.db <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  s3://mybucket/databases/tenant-001.db
</span></span></code></pre></div><h2 id="differences-from-static-directory-replication">Differences from static directory replication<a href="#differences-from-static-directory-replication" class="anchor" aria-hidden="true">#</a> </h2>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Static (<code>watch: false</code>)</th>
<th>Watcher (<code>watch: true</code>)</th>
</tr>
</thead>
<tbody>
<tr>
<td>New database detection</td>
<td>Requires restart</td>
<td>Automatic</td>
</tr>
<tr>
<td>Database removal</td>
<td>Requires restart</td>
<td>Automatic</td>
</tr>
<tr>
<td>Empty directory on startup</td>
<td>Error</td>
<td>Allowed</td>
</tr>
<tr>
<td>Resource usage</td>
<td>Lower</td>
<td>Slightly higher</td>
</tr>
<tr>
<td>Use case</td>
<td>Fixed set of databases</td>
<td>Dynamic provisioning</td>
</tr>
</tbody>
</table>
<h2 id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="anchor" aria-hidden="true">#</a> </h2>
<h3 id="verifying-database-discovery">Verifying database discovery<a href="#verifying-database-discovery" class="anchor" aria-hidden="true">#</a> </h3>
<p>Check Litestream logs for database discovery messages:</p>
<pre tabindex="0"><code>INFO added database to replication path=/var/lib/app/tenants/tenant-001.db
</code></pre><h3 id="debugging-pattern-matching">Debugging pattern matching<a href="#debugging-pattern-matching" class="anchor" aria-hidden="true">#</a> </h3>
<p>If databases are not being discovered, verify:</p>
<ol>
<li>The <code>pattern</code> matches your file extensions</li>
<li>The <code>dir</code> path is correct and accessible</li>
<li>For nested structures, <code>recursive: true</code> is set</li>
<li>Files are valid SQLite databases (not empty or corrupted)</li>
</ol>
<h3 id="common-issues">Common issues<a href="#common-issues" class="anchor" aria-hidden="true">#</a> </h3>
<table>
<thead>
<tr>
<th>Issue</th>
<th>Cause</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td>Database not detected</td>
<td>Pattern mismatch</td>
<td>Verify glob pattern matches file extension</td>
</tr>
<tr>
<td>Subdirectory databases missing</td>
<td>Recursive disabled</td>
<td>Set <code>recursive: true</code></td>
</tr>
<tr>
<td>Permission denied</td>
<td>Insufficient access</td>
<td>Verify Litestream has read access to directory</td>
</tr>
<tr>
<td>File not a SQLite database</td>
<td>Invalid file</td>
<td>Ensure files have valid SQLite headers</td>
</tr>
</tbody>
</table>
<h2 id="performance-considerations">Performance considerations<a href="#performance-considerations" class="anchor" aria-hidden="true">#</a> </h2>
<p>The directory watcher adds minimal overhead:</p>
<ul>
<li>Uses filesystem events (fsnotify) rather than polling</li>
<li>Only validates files that match the configured pattern</li>
<li>SQLite validation reads only the file header</li>
</ul>
<p>For high-volume provisioning scenarios (many databases created simultaneously),
the watcher has been tested with 20+ concurrent database creations.</p>
<h2 id="limitations">Limitations<a href="#limitations" class="anchor" aria-hidden="true">#</a> </h2>
<ul>
<li>The <code>watch</code> option requires a <code>dir</code> configuration; it cannot be used with
single database <code>path</code> configurations</li>
<li>Pattern matching uses glob syntax, not regular expressions</li>
<li>Directory watching is not available on all platforms (requires fsnotify
support)</li>
</ul>
<h2 id="see-also">See Also<a href="#see-also" class="anchor" aria-hidden="true">#</a> </h2>
<ul>
<li><a href="/guides/directory">Directory Replication</a> - Static directory replication</li>
<li><a href="/reference/config">Configuration Reference</a> - Complete configuration options</li>
<li><a href="/docs/troubleshooting">Troubleshooting</a> - Common issues and solutions</li>
</ul>

			<div class="docs-navigation d-flex justify-content-between">
	
	<a href="https://litestream.io/guides/windows/">
			<div class="card my-1">
				<div class="card-body py-2">
					&larr; Running as a Windows Service
				</div>
			</div>
		</a>
	<a class="ml-auto" href="https://litestream.io/guides/global-defaults/">
			<div class="card my-1">
				<div class="card-body py-2">
					Global Replica Defaults &rarr;
				</div>
			</div>
		</a>
	</div>

		</main>
	</div>

      </div>
    </div>
    
    
    <footer>
</footer>
    
    <script src="https://litestream.io/main.f4006b8dd3163d19fa41adf9892089fe185101b404b96884ed2a22ec4e9cb0706759ecdb3f4520a1d37fc5ad7a90a8d90abfb30055a1ff67aefb5b2324355d12.js" integrity="sha512-9ABrjdMWPRn6Qa35iSCJ/hhRAbQEuWiE7Soi7E6csHBnWezbP0UgodN/xa16kKjZCr&#43;zAFWh/2eu&#43;1sjJDVdEg==" crossorigin="anonymous" defer></script>
  <script src="https://litestream.io/index.min.5beff9d6cba0b18c64b1674eba9a6b8983a3cd906955d56ad9f6707f06b1abb96051140b33426fe576f12b16509a2eab239d01919d1023706fcdc6d1eb4fc8eb.js" integrity="sha512-W&#43;/51sugsYxksWdOuppriYOjzZBpVdVq2fZwfwaxq7lgURQLM0Jv5XbxKxZQmi6rI50BkZ0QI3BvzcbR60/I6w==" crossorigin="anonymous" defer></script>

  </body>
</html>